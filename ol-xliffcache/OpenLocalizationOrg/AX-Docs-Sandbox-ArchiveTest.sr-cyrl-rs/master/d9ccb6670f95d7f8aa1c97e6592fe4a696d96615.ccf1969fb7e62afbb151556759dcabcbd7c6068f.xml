{"content":"---\n# required metadata\n\ntitle: Cross-company behavior\ndescription: This topic provides information about how data entities interact with the cross-company concept. To understand this aspect of data entities, you must understand how tables and views apply the cross-company concept. Therefore, this topic begins with a brief review of tables and views, and then explains how data entities are related.\nauthor: RobinARH\nmanager: AnnBe\nms.date: 06/20/2017\nms.topic: article\nms.prod: \nms.service: dynamics-ax-platform\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \nms.reviewer: kfend\nms.search.scope: AX 7.0.0, Operations, UnifiedOperations\n# ms.tgt_pltfrm: \nms.custom: 25371\nms.assetid: f293d97a-9f70-4c45-91d4-574731892353\nms.search.region: Global\n# ms.search.industry: \nms.author: kuntalme\nms.search.validFrom: 2016-02-28\nms.dyn365.ops.version: AX 7.0.0\n\n---\n\n# Cross-company behavior\n\n[!include[banner](../includes/banner.md)]\n\n\nThis topic provides information about how data entities interact with the cross-company concept. To understand this aspect of data entities, you must understand how tables and views apply the cross-company concept. Therefore, this topic begins with a brief review of tables and views, and then explains how data entities are related.\n\nReview of tables and views for cross-company\n--------------------------------------------\n\nEach table has a **SaveDataPerCompany** property, and each view has a **AllowCrossCompany** property. The following table describes these two properties.\n\n|                        | Table                                                                                                                                                                                                                                                                                                                                                                                           | View                                                                                                                                                                                                                                                                                                                                 |\n|------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| Property name          | SaveDataPerCompany                                                                                                                                                                                                                                                                                                                                                                              | AllowCrossCompany                                                                                                                                                                                                                                                                                                                    |\n| Relevant CRUD mode     | CUD                                                                                                                                                                                                                                                                                                                                                                                             | R                                                                                                                                                                                                                                                                                                                                    |\n| Timing of effect       | Run time, Design time                                                                                                                                                                                                                                                                                                                                                                           | Run time, mostly. At design time, this setting causes the view to have **dataAreaId** in its list of selected fields. However, the filter for a specific **dataAreaId** value is added later, at run time.                                                                                                                           |\n| Meaning of value = Yes | At design time, the system automatically *adds* a **dataAreaId** field to the table, even though the field isn't displayed in the Application Object Tree (AOT). Every record in the table is tagged with the company (or legal entity) that it belongs to. The system automatically *adds* a filter to the SQL **Where** clause to limit the returned set of rows to one **dataAreaId** value. | At run time, the system does *not* automatically add a filter for **dataAreaId** on the **Where** clause of the SQL **Select** statement that it sends to the underlying Microsoft SQL Server system. Therefore, SQL **Select** statements from the view can return a set of records that contains records for *multiple* companies. |\n| Meaning of value = No  | The system does *not* add a **dataAreaId** field to the table. The table is said to be a shared table, because none of its records contain any formal company-specific data.                                                                                                                                                                                                                    | The system automatically *adds* a filter to the SQL **Where** clause to limit the returned set of rows to one **dataAreaId** value. However, the **AllowCrossCompany** property is ignored if the *root* data source of the view is a shared table.                                                                                  |\n\n## Comparisons within AllowCrossCompany = No\nIn the following screen shot, the **CustomerList** view has two data sources:\n\n-   **Root** – CustTable, which has its **SaveDataPerCompany** property set to **Yes**.\n-   **Non-root** – DirPartyTable, which has its **SaveDataPerCompany** property set to **No**.\n\n[![root](./media/root.png)](./media/root.png) \nThe **CustomerList** view has its **AllowCrossCompany** property set to **No**, as shown in the following screen shot. \n[![crosscomp](./media/crosscomp.png)](./media/crosscomp.png) \nGiven the preceding information about the **CustomerList** view, the system creates the view in the underlying SQL Server system by generating and then running the following SQL **Create View** statement.\n\n    CREATE VIEW [dbo].[CUSTOMERLIST] \n    AS \n      SELECT T1.accountnum AS ACCOUNTNUM, \n             T1.dataareaid AS DATAAREAID,  -- AllowCrossCompany =No caused this line.\n             T1.partition  AS PARTITION, \n             T1.recid      AS RECID, \n             T2.partition  AS PARTITION#2, \n             T2.name       AS NAME \n      FROM   custtable T1 \n             CROSS JOIN dirpartytable T2 \n      WHERE  ( T1.party = T2.recid \n               AND ( T1.partition = T2.partition ) ) \n\n### Making DirPartyTable the root data source\n\n[![dirpar](./media/dirpar.png)](./media/dirpar.png) \nBy swapping the positions of the two data source tables in the **CustomerList** view, you make the DirPartyTable table the root data source.\n\n    CREATE VIEW [dbo].[CUSTOMERLISTPARTY] \n    AS \n      SELECT T1.name       AS NAME, \n             T1.partition  AS PARTITION, \n             T1.recid      AS RECID, \n             T2.partition  AS PARTITION#2, \n             T2.accountnum AS ACCOUNTNUM \n      FROM   dirpartytable T1 \n             CROSS JOIN custtable T2 \n      WHERE  ( T2.party = T1.recid \n               AND ( T2.partition = T1.partition ) ) \n\n    go \n\nIn this case, the SQL **Create View** statement is the same, except for the following two differences:\n\n-   The **FROM** clause mentions DirPartyTable first and CustTable second.\n-   The **SELECT** column list does *not* include the line for **dataAreaId** (because DirPartyTable has its **SaveDataPerCompany** property set to **No**.)\n\n## Limitations of tables and views\nIn some cases, the cross-company control features of tables and views aren't as granular control as you might require. Here are the limitations:\n\n-   Company or legal entity fields other than the system **dataAreaId** field can’t be recognized or treated automatically in the that way **dataAreaId** can.\n-   The cross-company behavior for views is too restricted to the properties of the root data source, even when non-root data sources have a **dataAreaId** field.\n\nFor example, this might happen if the legal entity information is in **LegalEntityRecId**, or if shared tables don't have a **dataAreaId** column.\n\n## Design time: Setting the PrimaryCompanyContext property\nData entities help you overcome the limitations of tables and view where cross-company functionality is concerned. Data entities have a **PrimaryCompanyContext** property, where you can specify the entity field to use for company identification. This property provides flexibility and granular control in the following ways:\n\n-   The field can be from any data source of the entity and isn't limited to fields of the root data source.\n-   The field can be any field that is extended from the **DataAreaId** extended data type (EDT), and isn't limited to an underlying system **dataAreaId** field.\n-   You can use the **PrimaryCompanyContext** property even when the entity has only shared tables as its data sources, if this makes sense for your specific situation.\n\nThe following screen shot shows the value set for the **PrimaryCompanyContext** property on the **FMCustGroupEntity** entity. \n[![prim1](./media/prim1.png)](./media/prim1.png) \nWhen the **PrimaryCompanyContext** value is set to a non-empty value, the entity can't behave as a shared entity. The **dataAreaId** field is added to the SQL **Create View** statement.\n\n    CREATE VIEW [dbo].[FMCUSTGROUPENTITY] \n    AS \n      SELECT T1.custgroup   AS GROUPNAME, \n             T1.description AS DESCRIPTION, \n             T1.dataareaid  AS DATAAREAID,   -- dataAreaId is added. \n             T1.recversion  AS RECVERSION, \n             T1.partition   AS PARTITION, \n             T1.recid       AS RECID \n      FROM   fmcustgroup T1 \n\n## Run time: The behavior of data entities for crosscompany\nIn the context of X++ code, the cross-company behavior of data entities resembles the behavior of tables. If the **PrimaryCompanyContext** property for an entity has no value and is empty, the entity behaves like a shared table.\n\n### X++ when PrimaryCompanyContext is set\n\nThe following table describes the behavior of a data entity under CRUD access when the **PrimaryCompanyContext** property is set to a field value. Both X++ and OData accesses are described.\n\n|             | X++                                                                                                                                                                          | OData                                                                                                                                                                                                                 |\n|-------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| Read (R)    | By default, results are *always* filtered by **dataAreaId** = current company, and cross-company data can be fetched by using the **crosscompany** option.                   | Results are *not* filtered by **dataAreaId**. The consumer must filter explicitly.                                                                                                                                    |\n| Write (CUD) | CUD access to the data entity always occurs in the context of the current company. If cross-company CUD access to the entity is required, use the **changeCompany** keyword. | CUD access to the entity can be accomplished by the consumer for any company by setting the value of the **PrimaryCompanyContext(myDataAreaId)** field. The framework handles the necessary **ChangeCompany** action. |\n\nThe following X++ code example accesses **FMCustGroupEntity**, which has its **PrimaryCompanyContext** property set to **dataAreaId**. [![FMCust](./media/fmcust.png)](./media/fmcust.png) [![Snip](./media/snip-550x1024.png)](./media/snip.png)\n\n### X++ when PrimaryCompanyContext is empty\n\nWhen the **PrimaryCompanyContext** property is set on the data entity, a **dataAreaId** field is created in the view schema and mapped to the **PrimaryCompanyContext** field. The following table describes the behavior of a data entity under CRUD access when the **PrimaryCompanyContext** property is empty. Both X++ and OData accesses are described.\n\n|             | X++                                                                                                                              | OData                          |\n|-------------|----------------------------------------------------------------------------------------------------------------------------------|--------------------------------|\n| Read (R)    | Results aren't filtered, because no system **dataAreaId** field is created on the view schema.                                   | (The same as for R with X++)   |\n| Write (CUD) | There is no primary company context to set. Therefore, CUD access to the entity is always in the context of the current company. | (The same as for CUD with X++) |\n\nIn the current example, the **FMCustomerGroupGlobalEntity** entity has no value assigned to its **PrimaryCompanyContext** property. \n[![ent1](./media/ent1.png)](./media/ent1.png) \nHowever, a **dataAreaId** field from the FMCustGroup table is mapped to the **FMCustomerGroupGlobalEntity** entity as a regular field that is named **LegalEntity**. In this example, the FMCustGroup table is the root data source for **FMCustomerGroupGlobalEntity**. However, we are using this **dataAreaId** field in an informal way that bypasses the automatic mechanisms of the system. All these details are shown in the following screen shot of the **LegalEntity** field.\n[![ent2](./media/ent2.png)](./media/ent2.png)\n**Note:** Although the terms *legal entity* and *data entity* both use the word *entity*, don't confuse them. Legal entities and data entities are two entirely different concepts. When the **PrimaryCompanyContext** property is empty, the SQL **Create View** statement usually contains no mention of a system **dataAreaId** column. However, in the current example, **dataAreaId** is \"half-mentioned\" because of the **LegalEntity** regular field on the data entity. This field is shown in the following SQL statement.\n\n    CREATE VIEW [dbo].[FMCUSTOMERGROUPGLOBALENTITY] \n    AS \n      SELECT T1.custgroup   AS NAME, \n             T1.description AS DESCRIPTION, \n             T1.dataareaid  AS LEGALENTITY,   -- dataAreadId is named LegalEntity. \n             T1.recversion  AS RECVERSION, \n             T1.partition   AS PARTITION, \n             T1.recid       AS RECID \n      FROM   fmcustgroup T1 \n\n### Purpose of this example\n\nThis example has two purposes:\n\n-   Show shared data by default, even though the backing table might be company-specific.\n-   Enable the consumer of the data entity to filter on or apply **dataAreaId** if this is required, by using the regular field that is named **LegalEntity**.\n\n### Test data\n\nThe following screen shot of the **Table browser** page shows the test data that is in the **FMCustomerGroupGlobalEntity** entity before the X++ test code is run. \n[![ent3](./media/ent3.png)](./media/ent3.png)\n\n### X++ code\n\nHere's how the X++ test code works with the shared entity:\n\n-   It accesses the data entity in shared mode for reads.\n-   It accesses the data entity with one specific company when a new record is created.\n\n[![snip2](./media/snip2.png)](./media/snip2.png)\n\n\n\n","nodes":[{"pos":[4,910],"embed":true,"restype":"x-metadata","content":"# required metadata\n\ntitle: Cross-company behavior\ndescription: This topic provides information about how data entities interact with the cross-company concept. To understand this aspect of data entities, you must understand how tables and views apply the cross-company concept. Therefore, this topic begins with a brief review of tables and views, and then explains how data entities are related.\nauthor: RobinARH\nmanager: AnnBe\nms.date: 06/20/2017\nms.topic: article\nms.prod: \nms.service: dynamics-ax-platform\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \nms.reviewer: kfend\nms.search.scope: AX 7.0.0, Operations, UnifiedOperations\n# ms.tgt_pltfrm: \nms.custom: 25371\nms.assetid: f293d97a-9f70-4c45-91d4-574731892353\nms.search.region: Global\n# ms.search.industry: \nms.author: kuntalme\nms.search.validFrom: 2016-02-28\nms.dyn365.ops.version: AX 7.0.0\n","nodes":[{"content":"Cross-company behavior","nodes":[{"pos":[0,22],"content":"Cross-company behavior","nodes":[{"content":"Cross-company behavior","pos":[0,22]}]}],"path":["title"],"extradata":"MT"},{"content":"This topic provides information about how data entities interact with the cross-company concept. To understand this aspect of data entities, you must understand how tables and views apply the cross-company concept. Therefore, this topic begins with a brief review of tables and views, and then explains how data entities are related.","nodes":[{"pos":[0,333],"content":"This topic provides information about how data entities interact with the cross-company concept. To understand this aspect of data entities, you must understand how tables and views apply the cross-company concept. Therefore, this topic begins with a brief review of tables and views, and then explains how data entities are related.","nodes":[{"content":"This topic provides information about how data entities interact with the cross-company concept. To understand this aspect of data entities, you must understand how tables and views apply the cross-company concept. Therefore, this topic begins with a brief review of tables and views, and then explains how data entities are related.","pos":[0,333],"nodes":[{"content":"This topic provides information about how data entities interact with the cross-company concept.","pos":[0,96]},{"content":"To understand this aspect of data entities, you must understand how tables and views apply the cross-company concept.","pos":[97,214]},{"content":"Therefore, this topic begins with a brief review of tables and views, and then explains how data entities are related.","pos":[215,333]}]}]}],"path":["description"],"extradata":"MT"}],"header":"# required metadata\n","yml":true},{"pos":[918,940],"content":"Cross-company behavior","linkify":"Cross-company behavior","nodes":[{"content":"Cross-company behavior","pos":[0,22]}]},{"content":"This topic provides information about how data entities interact with the cross-company concept.","pos":[986,1082]},{"content":"To understand this aspect of data entities, you must understand how tables and views apply the cross-company concept.","pos":[1083,1200]},{"content":"Therefore, this topic begins with a brief review of tables and views, and then explains how data entities are related.","pos":[1201,1319]},{"pos":[1321,1365],"content":"Review of tables and views for cross-company","linkify":"Review of tables and views for cross-company","nodes":[{"content":"Review of tables and views for cross-company","pos":[0,44]}]},{"content":"Each table has a <bpt id=\"p1\">**</bpt>SaveDataPerCompany<ept id=\"p1\">**</ept> property, and each view has a <bpt id=\"p2\">**</bpt>AllowCrossCompany<ept id=\"p2\">**</ept> property.","pos":[1412,1513],"source":"Each table has a **SaveDataPerCompany** property, and each view has a **AllowCrossCompany** property."},{"content":"The following table describes these two properties.","pos":[1514,1565]},{"content":"Table","pos":[1594,1599]},{"content":"View","pos":[1980,1984]},{"content":"Property name","pos":[3049,3062]},{"content":"SaveDataPerCompany","pos":[3074,3092]},{"content":"AllowCrossCompany","pos":[3460,3477]},{"content":"Relevant CRUD mode","pos":[3789,3807]},{"content":"CUD","pos":[3814,3817]},{"content":"R","pos":[4200,4201]},{"content":"Timing of effect","pos":[4529,4545]},{"content":"Run time, Design time","pos":[4554,4575]},{"content":"Run time, mostly.","pos":[4940,4957]},{"content":"At design time, this setting causes the view to have <bpt id=\"p1\">**</bpt>dataAreaId<ept id=\"p1\">**</ept> in its list of selected fields.","pos":[4958,5057],"source":" At design time, this setting causes the view to have **dataAreaId** in its list of selected fields."},{"content":"However, the filter for a specific <bpt id=\"p1\">**</bpt>dataAreaId<ept id=\"p1\">**</ept> value is added later, at run time.","pos":[5058,5142],"source":" However, the filter for a specific **dataAreaId** value is added later, at run time."},{"content":"Meaning of value = Yes","pos":[5269,5291]},{"content":"At design time, the system automatically <bpt id=\"p1\">*</bpt>adds<ept id=\"p1\">*</ept> a <bpt id=\"p2\">**</bpt>dataAreaId<ept id=\"p2\">**</ept> field to the table, even though the field isn't displayed in the Application Object Tree (AOT).","pos":[5294,5454],"source":"At design time, the system automatically *adds* a **dataAreaId** field to the table, even though the field isn't displayed in the Application Object Tree (AOT)."},{"content":"Every record in the table is tagged with the company (or legal entity) that it belongs to.","pos":[5455,5545]},{"content":"The system automatically <bpt id=\"p1\">*</bpt>adds<ept id=\"p1\">*</ept> a filter to the SQL <bpt id=\"p2\">**</bpt>Where<ept id=\"p2\">**</ept> clause to limit the returned set of rows to one <bpt id=\"p3\">**</bpt>dataAreaId<ept id=\"p3\">**</ept> value.","pos":[5546,5677],"source":" The system automatically *adds* a filter to the SQL **Where** clause to limit the returned set of rows to one **dataAreaId** value."},{"content":"At run time, the system does <bpt id=\"p1\">*</bpt>not<ept id=\"p1\">*</ept> automatically add a filter for <bpt id=\"p2\">**</bpt>dataAreaId<ept id=\"p2\">**</ept> on the <bpt id=\"p3\">**</bpt>Where<ept id=\"p3\">**</ept> clause of the SQL <bpt id=\"p4\">**</bpt>Select<ept id=\"p4\">**</ept> statement that it sends to the underlying Microsoft SQL Server system.","pos":[5680,5877],"source":"At run time, the system does *not* automatically add a filter for **dataAreaId** on the **Where** clause of the SQL **Select** statement that it sends to the underlying Microsoft SQL Server system."},{"content":"Therefore, SQL <bpt id=\"p1\">**</bpt>Select<ept id=\"p1\">**</ept> statements from the view can return a set of records that contains records for <bpt id=\"p2\">*</bpt>multiple<ept id=\"p2\">*</ept> companies.","pos":[5878,6004],"source":" Therefore, SQL **Select** statements from the view can return a set of records that contains records for *multiple* companies."},{"content":"Meaning of value = No","pos":[6009,6030]},{"content":"The system does <bpt id=\"p1\">*</bpt>not<ept id=\"p1\">*</ept> add a <bpt id=\"p2\">**</bpt>dataAreaId<ept id=\"p2\">**</ept> field to the table.","pos":[6034,6096],"source":"The system does *not* add a **dataAreaId** field to the table."},{"content":"The table is said to be a shared table, because none of its records contain any formal company-specific data.","pos":[6097,6206]},{"content":"The system automatically <bpt id=\"p1\">*</bpt>adds<ept id=\"p1\">*</ept> a filter to the SQL <bpt id=\"p2\">**</bpt>Where<ept id=\"p2\">**</ept> clause to limit the returned set of rows to one <bpt id=\"p3\">**</bpt>dataAreaId<ept id=\"p3\">**</ept> value.","pos":[6420,6551],"source":"The system automatically *adds* a filter to the SQL **Where** clause to limit the returned set of rows to one **dataAreaId** value."},{"content":"However, the <bpt id=\"p1\">**</bpt>AllowCrossCompany<ept id=\"p1\">**</ept> property is ignored if the <bpt id=\"p2\">*</bpt>root<ept id=\"p2\">*</ept> data source of the view is a shared table.","pos":[6552,6663],"source":" However, the **AllowCrossCompany** property is ignored if the *root* data source of the view is a shared table."},{"pos":[6751,6792],"content":"Comparisons within AllowCrossCompany = No","linkify":"Comparisons within AllowCrossCompany = No","nodes":[{"content":"Comparisons within AllowCrossCompany = No","pos":[0,41]}]},{"pos":[6793,6870],"content":"In the following screen shot, the <bpt id=\"p1\">**</bpt>CustomerList<ept id=\"p1\">**</ept> view has two data sources:","source":"In the following screen shot, the **CustomerList** view has two data sources:"},{"pos":[6876,6959],"content":"<bpt id=\"p1\">**</bpt>Root<ept id=\"p1\">**</ept> – CustTable, which has its <bpt id=\"p2\">**</bpt>SaveDataPerCompany<ept id=\"p2\">**</ept> property set to <bpt id=\"p3\">**</bpt>Yes<ept id=\"p3\">**</ept>.","source":"**Root** – CustTable, which has its **SaveDataPerCompany** property set to **Yes**."},{"pos":[6964,7054],"content":"<bpt id=\"p1\">**</bpt>Non-root<ept id=\"p1\">**</ept> – DirPartyTable, which has its <bpt id=\"p2\">**</bpt>SaveDataPerCompany<ept id=\"p2\">**</ept> property set to <bpt id=\"p3\">**</bpt>No<ept id=\"p3\">**</ept>.","source":"**Non-root** – DirPartyTable, which has its **SaveDataPerCompany** property set to **No**."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>root<ept id=\"p1\">](./media/root.png)](./media/root.png)</ept> The <bpt id=\"p2\">**</bpt>CustomerList<ept id=\"p2\">**</ept> view has its <bpt id=\"p3\">**</bpt>AllowCrossCompany<ept id=\"p3\">**</ept> property set to <bpt id=\"p4\">**</bpt>No<ept id=\"p4\">**</ept>, as shown in the following screen shot.","pos":[7056,7221],"source":"[![root](./media/root.png)](./media/root.png) \nThe **CustomerList** view has its **AllowCrossCompany** property set to **No**, as shown in the following screen shot."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>crosscomp<ept id=\"p1\">](./media/crosscomp.png)](./media/crosscomp.png)</ept> Given the preceding information about the <bpt id=\"p2\">**</bpt>CustomerList<ept id=\"p2\">**</ept> view, the system creates the view in the underlying SQL Server system by generating and then running the following SQL <bpt id=\"p3\">**</bpt>Create View<ept id=\"p3\">**</ept> statement.","pos":[7223,7489],"source":"[![crosscomp](./media/crosscomp.png)](./media/crosscomp.png) \nGiven the preceding information about the **CustomerList** view, the system creates the view in the underlying SQL Server system by generating and then running the following SQL **Create View** statement."},{"pos":[7990,8031],"content":"Making DirPartyTable the root data source","linkify":"Making DirPartyTable the root data source","nodes":[{"content":"Making DirPartyTable the root data source","pos":[0,41]}]},{"pos":[8033,8226],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>dirpar<ept id=\"p1\">](./media/dirpar.png)](./media/dirpar.png)</ept> By swapping the positions of the two data source tables in the <bpt id=\"p2\">**</bpt>CustomerList<ept id=\"p2\">**</ept> view, you make the DirPartyTable table the root data source.","source":"[![dirpar](./media/dirpar.png)](./media/dirpar.png) \nBy swapping the positions of the two data source tables in the **CustomerList** view, you make the DirPartyTable table the root data source."},{"pos":[8651,8753],"content":"In this case, the SQL <bpt id=\"p1\">**</bpt>Create View<ept id=\"p1\">**</ept> statement is the same, except for the following two differences:","source":"In this case, the SQL **Create View** statement is the same, except for the following two differences:"},{"pos":[8759,8829],"content":"The <bpt id=\"p1\">**</bpt>FROM<ept id=\"p1\">**</ept> clause mentions DirPartyTable first and CustTable second.","source":"The **FROM** clause mentions DirPartyTable first and CustTable second."},{"pos":[8834,8986],"content":"The <bpt id=\"p1\">**</bpt>SELECT<ept id=\"p1\">**</ept> column list does <bpt id=\"p2\">*</bpt>not<ept id=\"p2\">*</ept> include the line for <bpt id=\"p3\">**</bpt>dataAreaId<ept id=\"p3\">**</ept> (because DirPartyTable has its <bpt id=\"p4\">**</bpt>SaveDataPerCompany<ept id=\"p4\">**</ept> property set to <bpt id=\"p5\">**</bpt>No<ept id=\"p5\">**</ept>.)","source":"The **SELECT** column list does *not* include the line for **dataAreaId** (because DirPartyTable has its **SaveDataPerCompany** property set to **No**.)"},{"pos":[8991,9022],"content":"Limitations of tables and views","linkify":"Limitations of tables and views","nodes":[{"content":"Limitations of tables and views","pos":[0,31]}]},{"content":"In some cases, the cross-company control features of tables and views aren't as granular control as you might require.","pos":[9023,9141]},{"content":"Here are the limitations:","pos":[9142,9167]},{"pos":[9173,9327],"content":"Company or legal entity fields other than the system <bpt id=\"p1\">**</bpt>dataAreaId<ept id=\"p1\">**</ept> field can’t be recognized or treated automatically in the that way <bpt id=\"p2\">**</bpt>dataAreaId<ept id=\"p2\">**</ept> can.","source":"Company or legal entity fields other than the system **dataAreaId** field can’t be recognized or treated automatically in the that way **dataAreaId** can."},{"pos":[9332,9490],"content":"The cross-company behavior for views is too restricted to the properties of the root data source, even when non-root data sources have a <bpt id=\"p1\">**</bpt>dataAreaId<ept id=\"p1\">**</ept> field.","source":"The cross-company behavior for views is too restricted to the properties of the root data source, even when non-root data sources have a **dataAreaId** field."},{"pos":[9492,9638],"content":"For example, this might happen if the legal entity information is in <bpt id=\"p1\">**</bpt>LegalEntityRecId<ept id=\"p1\">**</ept>, or if shared tables don't have a <bpt id=\"p2\">**</bpt>dataAreaId<ept id=\"p2\">**</ept> column.","source":"For example, this might happen if the legal entity information is in **LegalEntityRecId**, or if shared tables don't have a **dataAreaId** column."},{"pos":[9643,9698],"content":"Design time: Setting the PrimaryCompanyContext property","linkify":"Design time: Setting the PrimaryCompanyContext property","nodes":[{"content":"Design time: Setting the PrimaryCompanyContext property","pos":[0,55]}]},{"content":"Data entities help you overcome the limitations of tables and view where cross-company functionality is concerned.","pos":[9699,9813]},{"content":"Data entities have a <bpt id=\"p1\">**</bpt>PrimaryCompanyContext<ept id=\"p1\">**</ept> property, where you can specify the entity field to use for company identification.","pos":[9814,9944],"source":" Data entities have a **PrimaryCompanyContext** property, where you can specify the entity field to use for company identification."},{"content":"This property provides flexibility and granular control in the following ways:","pos":[9945,10023]},{"content":"The field can be from any data source of the entity and isn't limited to fields of the root data source.","pos":[10029,10133]},{"pos":[10138,10295],"content":"The field can be any field that is extended from the <bpt id=\"p1\">**</bpt>DataAreaId<ept id=\"p1\">**</ept> extended data type (EDT), and isn't limited to an underlying system <bpt id=\"p2\">**</bpt>dataAreaId<ept id=\"p2\">**</ept> field.","source":"The field can be any field that is extended from the **DataAreaId** extended data type (EDT), and isn't limited to an underlying system **dataAreaId** field."},{"pos":[10300,10464],"content":"You can use the <bpt id=\"p1\">**</bpt>PrimaryCompanyContext<ept id=\"p1\">**</ept> property even when the entity has only shared tables as its data sources, if this makes sense for your specific situation.","source":"You can use the **PrimaryCompanyContext** property even when the entity has only shared tables as its data sources, if this makes sense for your specific situation."},{"content":"The following screen shot shows the value set for the <bpt id=\"p1\">**</bpt>PrimaryCompanyContext<ept id=\"p1\">**</ept> property on the <bpt id=\"p2\">**</bpt>FMCustGroupEntity<ept id=\"p2\">**</ept> entity.","pos":[10466,10591],"source":"The following screen shot shows the value set for the **PrimaryCompanyContext** property on the **FMCustGroupEntity** entity."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>prim1<ept id=\"p1\">](./media/prim1.png)](./media/prim1.png)</ept> When the <bpt id=\"p2\">**</bpt>PrimaryCompanyContext<ept id=\"p2\">**</ept> value is set to a non-empty value, the entity can't behave as a shared entity.","pos":[10593,10756],"source":"[![prim1](./media/prim1.png)](./media/prim1.png) \nWhen the **PrimaryCompanyContext** value is set to a non-empty value, the entity can't behave as a shared entity."},{"content":"The <bpt id=\"p1\">**</bpt>dataAreaId<ept id=\"p1\">**</ept> field is added to the SQL <bpt id=\"p2\">**</bpt>Create View<ept id=\"p2\">**</ept> statement.","pos":[10757,10828],"source":" The **dataAreaId** field is added to the SQL **Create View** statement."},{"pos":[11197,11253],"content":"Run time: The behavior of data entities for crosscompany","linkify":"Run time: The behavior of data entities for crosscompany","nodes":[{"content":"Run time: The behavior of data entities for crosscompany","pos":[0,56]}]},{"content":"In the context of X++ code, the cross-company behavior of data entities resembles the behavior of tables.","pos":[11254,11359]},{"content":"If the <bpt id=\"p1\">**</bpt>PrimaryCompanyContext<ept id=\"p1\">**</ept> property for an entity has no value and is empty, the entity behaves like a shared table.","pos":[11360,11482],"source":" If the **PrimaryCompanyContext** property for an entity has no value and is empty, the entity behaves like a shared table."},{"pos":[11488,11525],"content":"X++ when PrimaryCompanyContext is set","linkify":"X++ when PrimaryCompanyContext is set","nodes":[{"content":"X++ when PrimaryCompanyContext is set","pos":[0,37]}]},{"content":"The following table describes the behavior of a data entity under CRUD access when the <bpt id=\"p1\">**</bpt>PrimaryCompanyContext<ept id=\"p1\">**</ept> property is set to a field value.","pos":[11527,11673],"source":"The following table describes the behavior of a data entity under CRUD access when the **PrimaryCompanyContext** property is set to a field value."},{"content":"Both X++ and OData accesses are described.","pos":[11674,11716]},{"content":"X++","pos":[11734,11737]},{"content":"OData","pos":[11909,11914]},{"content":"Read (R)","pos":[12534,12542]},{"pos":[12548,12702],"content":"By default, results are <bpt id=\"p1\">*</bpt>always<ept id=\"p1\">*</ept> filtered by <bpt id=\"p2\">**</bpt>dataAreaId<ept id=\"p2\">**</ept> = current company, and cross-company data can be fetched by using the <bpt id=\"p3\">**</bpt>crosscompany<ept id=\"p3\">**</ept> option.","source":"By default, results are *always* filtered by **dataAreaId** = current company, and cross-company data can be fetched by using the **crosscompany** option."},{"content":"Results are <bpt id=\"p1\">*</bpt>not<ept id=\"p1\">*</ept> filtered by <bpt id=\"p2\">**</bpt>dataAreaId<ept id=\"p2\">**</ept>.","pos":[12723,12768],"source":"Results are *not* filtered by **dataAreaId**."},{"content":"The consumer must filter explicitly.","pos":[12769,12805]},{"content":"Write (CUD)","pos":[12941,12952]},{"content":"CUD access to the data entity always occurs in the context of the current company.","pos":[12955,13037]},{"content":"If cross-company CUD access to the entity is required, use the <bpt id=\"p1\">**</bpt>changeCompany<ept id=\"p1\">**</ept> keyword.","pos":[13038,13127],"source":" If cross-company CUD access to the entity is required, use the **changeCompany** keyword."},{"content":"CUD access to the entity can be accomplished by the consumer for any company by setting the value of the <bpt id=\"p1\">**</bpt>PrimaryCompanyContext(myDataAreaId)<ept id=\"p1\">**</ept> field.","pos":[13130,13281],"source":"CUD access to the entity can be accomplished by the consumer for any company by setting the value of the **PrimaryCompanyContext(myDataAreaId)** field."},{"content":"The framework handles the necessary <bpt id=\"p1\">**</bpt>ChangeCompany<ept id=\"p1\">**</ept> action.","pos":[13282,13343],"source":" The framework handles the necessary **ChangeCompany** action."},{"content":"The following X++ code example accesses <bpt id=\"p1\">**</bpt>FMCustGroupEntity<ept id=\"p1\">**</ept>, which has its <bpt id=\"p2\">**</bpt>PrimaryCompanyContext<ept id=\"p2\">**</ept> property set to <bpt id=\"p3\">**</bpt>dataAreaId<ept id=\"p3\">**</ept>.","pos":[13347,13481],"source":"The following X++ code example accesses **FMCustGroupEntity**, which has its **PrimaryCompanyContext** property set to **dataAreaId**."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>FMCust<ept id=\"p1\">](./media/fmcust.png)](./media/fmcust.png)</ept> <bpt id=\"p2\">[</bpt><ph id=\"ph2\">![</ph>Snip<ept id=\"p2\">](./media/snip-550x1024.png)](./media/snip.png)</ept>","pos":[13482,13588],"source":"[![FMCust](./media/fmcust.png)](./media/fmcust.png) [![Snip](./media/snip-550x1024.png)](./media/snip.png)"},{"pos":[13594,13633],"content":"X++ when PrimaryCompanyContext is empty","linkify":"X++ when PrimaryCompanyContext is empty","nodes":[{"content":"X++ when PrimaryCompanyContext is empty","pos":[0,39]}]},{"content":"When the <bpt id=\"p1\">**</bpt>PrimaryCompanyContext<ept id=\"p1\">**</ept> property is set on the data entity, a <bpt id=\"p2\">**</bpt>dataAreaId<ept id=\"p2\">**</ept> field is created in the view schema and mapped to the <bpt id=\"p3\">**</bpt>PrimaryCompanyContext<ept id=\"p3\">**</ept> field.","pos":[13635,13809],"source":"When the **PrimaryCompanyContext** property is set on the data entity, a **dataAreaId** field is created in the view schema and mapped to the **PrimaryCompanyContext** field."},{"content":"The following table describes the behavior of a data entity under CRUD access when the <bpt id=\"p1\">**</bpt>PrimaryCompanyContext<ept id=\"p1\">**</ept> property is empty.","pos":[13810,13941],"source":" The following table describes the behavior of a data entity under CRUD access when the **PrimaryCompanyContext** property is empty."},{"content":"Both X++ and OData accesses are described.","pos":[13942,13984]},{"content":"X++","pos":[14002,14005]},{"content":"OData","pos":[14133,14138]},{"content":"Read (R)","pos":[14348,14356]},{"pos":[14362,14456],"content":"Results aren't filtered, because no system <bpt id=\"p1\">**</bpt>dataAreaId<ept id=\"p1\">**</ept> field is created on the view schema.","source":"Results aren't filtered, because no system **dataAreaId** field is created on the view schema."},{"content":"(The same as for R with X++)","pos":[14493,14521]},{"content":"Write (CUD)","pos":[14528,14539]},{"content":"There is no primary company context to set.","pos":[14542,14585]},{"content":"Therefore, CUD access to the entity is always in the context of the current company.","pos":[14586,14670]},{"content":"(The same as for CUD with X++)","pos":[14673,14703]},{"content":"In the current example, the <bpt id=\"p1\">**</bpt>FMCustomerGroupGlobalEntity<ept id=\"p1\">**</ept> entity has no value assigned to its <bpt id=\"p2\">**</bpt>PrimaryCompanyContext<ept id=\"p2\">**</ept> property.","pos":[14707,14838],"source":"In the current example, the **FMCustomerGroupGlobalEntity** entity has no value assigned to its **PrimaryCompanyContext** property."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>ent1<ept id=\"p1\">](./media/ent1.png)](./media/ent1.png)</ept> However, a <bpt id=\"p2\">**</bpt>dataAreaId<ept id=\"p2\">**</ept> field from the FMCustGroup table is mapped to the <bpt id=\"p3\">**</bpt>FMCustomerGroupGlobalEntity<ept id=\"p3\">**</ept> entity as a regular field that is named <bpt id=\"p4\">**</bpt>LegalEntity<ept id=\"p4\">**</ept>.","pos":[14840,15051],"source":"[![ent1](./media/ent1.png)](./media/ent1.png) \nHowever, a **dataAreaId** field from the FMCustGroup table is mapped to the **FMCustomerGroupGlobalEntity** entity as a regular field that is named **LegalEntity**."},{"content":"In this example, the FMCustGroup table is the root data source for <bpt id=\"p1\">**</bpt>FMCustomerGroupGlobalEntity<ept id=\"p1\">**</ept>.","pos":[15052,15151],"source":" In this example, the FMCustGroup table is the root data source for **FMCustomerGroupGlobalEntity**."},{"content":"However, we are using this <bpt id=\"p1\">**</bpt>dataAreaId<ept id=\"p1\">**</ept> field in an informal way that bypasses the automatic mechanisms of the system.","pos":[15152,15272],"source":" However, we are using this **dataAreaId** field in an informal way that bypasses the automatic mechanisms of the system."},{"content":"All these details are shown in the following screen shot of the <bpt id=\"p1\">**</bpt>LegalEntity<ept id=\"p1\">**</ept> field.","pos":[15273,15359],"source":" All these details are shown in the following screen shot of the **LegalEntity** field."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>ent2<ept id=\"p1\">](./media/ent2.png)](./media/ent2.png)</ept><ph id=\"ph2\">\n</ph><bpt id=\"p2\">**</bpt>Note:<ept id=\"p2\">**</ept> Although the terms <bpt id=\"p3\">*</bpt>legal entity<ept id=\"p3\">*</ept> and <bpt id=\"p4\">*</bpt>data entity<ept id=\"p4\">*</ept> both use the word <bpt id=\"p5\">*</bpt>entity<ept id=\"p5\">*</ept>, don't confuse them.","pos":[15360,15515],"source":"[![ent2](./media/ent2.png)](./media/ent2.png)\n**Note:** Although the terms *legal entity* and *data entity* both use the word *entity*, don't confuse them."},{"content":"Legal entities and data entities are two entirely different concepts.","pos":[15516,15585]},{"content":"When the <bpt id=\"p1\">**</bpt>PrimaryCompanyContext<ept id=\"p1\">**</ept> property is empty, the SQL <bpt id=\"p2\">**</bpt>Create View<ept id=\"p2\">**</ept> statement usually contains no mention of a system <bpt id=\"p3\">**</bpt>dataAreaId<ept id=\"p3\">**</ept> column.","pos":[15586,15736],"source":" When the **PrimaryCompanyContext** property is empty, the SQL **Create View** statement usually contains no mention of a system **dataAreaId** column."},{"content":"However, in the current example, <bpt id=\"p1\">**</bpt>dataAreaId<ept id=\"p1\">**</ept> is \"half-mentioned\" because of the <bpt id=\"p2\">**</bpt>LegalEntity<ept id=\"p2\">**</ept> regular field on the data entity.","pos":[15737,15869],"source":" However, in the current example, **dataAreaId** is \"half-mentioned\" because of the **LegalEntity** regular field on the data entity."},{"content":"This field is shown in the following SQL statement.","pos":[15870,15921]},{"pos":[16310,16333],"content":"Purpose of this example","linkify":"Purpose of this example","nodes":[{"content":"Purpose of this example","pos":[0,23]}]},{"content":"This example has two purposes:","pos":[16335,16365]},{"content":"Show shared data by default, even though the backing table might be company-specific.","pos":[16371,16456]},{"pos":[16461,16615],"content":"Enable the consumer of the data entity to filter on or apply <bpt id=\"p1\">**</bpt>dataAreaId<ept id=\"p1\">**</ept> if this is required, by using the regular field that is named <bpt id=\"p2\">**</bpt>LegalEntity<ept id=\"p2\">**</ept>.","source":"Enable the consumer of the data entity to filter on or apply **dataAreaId** if this is required, by using the regular field that is named **LegalEntity**."},{"pos":[16621,16630],"content":"Test data","linkify":"Test data","nodes":[{"content":"Test data","pos":[0,9]}]},{"content":"The following screen shot of the <bpt id=\"p1\">**</bpt>Table browser<ept id=\"p1\">**</ept> page shows the test data that is in the <bpt id=\"p2\">**</bpt>FMCustomerGroupGlobalEntity<ept id=\"p2\">**</ept> entity before the X++ test code is run.","pos":[16632,16794],"source":"The following screen shot of the **Table browser** page shows the test data that is in the **FMCustomerGroupGlobalEntity** entity before the X++ test code is run."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>ent3<ept id=\"p1\">](./media/ent3.png)](./media/ent3.png)</ept>","pos":[16796,16841],"source":"[![ent3](./media/ent3.png)](./media/ent3.png)"},{"pos":[16847,16855],"content":"X++ code","linkify":"X++ code","nodes":[{"content":"X++ code","pos":[0,8]}]},{"content":"Here's how the X++ test code works with the shared entity:","pos":[16857,16915]},{"content":"It accesses the data entity in shared mode for reads.","pos":[16921,16974]},{"content":"It accesses the data entity with one specific company when a new record is created.","pos":[16979,17062]},{"pos":[17064,17112],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>snip2<ept id=\"p1\">](./media/snip2.png)](./media/snip2.png)</ept>","source":"[![snip2](./media/snip2.png)](./media/snip2.png)"}]}