{"content":"---\n# required metadata\n\ntitle: Upgrade data in development, demo, or sandbox environments\ndescription: This topic provides instructions for upgrading your Microsoft Dynamics 365 for Finance and Operations database to the latest update.\nauthor: tariqbell\nmanager: AnnBe\nms.date: 07/10/2017\nms.topic: article\nms.prod: \nms.service: dynamics-ax-platform\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \nms.reviewer: margoc\nms.search.scope: Operations, Platform, UnifiedOperations, AX Platform\n# ms.tgt_pltfrm: \nms.custom: 106163\nms.assetid: 0c78b7a9-a360-4ef8-92ef-e4e9ff70cee7\nms.search.region: Global\n# ms.search.industry: \nms.author: tabell\nms.search.validFrom: 2016-05-31\nms.dyn365.ops.version: Platform update 1\n\n---\n\n# Upgrade data in development, demo, or sandbox environments\n\n[!include[banner](../includes/banner.md)]\n\n\nThis topic provides instructions for upgrading your Microsoft Dynamics 365 for Finance and Operations database in a Tier 1 environment (also know as a development box, one-box, or demo environment) to the latest update.\n\nIn some Tier 2 or higher environments the Microsoft Service Engineering Team (DSE) will execute the data upgrade for you. For more information, see the end to end upgrade process here: [Overview of moving to the latest update of Microsoft Dynamics 365 for Finance and Operations](upgrade-latest-update.md#scenario-3-upgrade-to-the-most-current-application-update).\n\nThis topic describes how to upgrade an older source database to the latest Finance and Operations update. To copy a database from a production environment back to a one-box demo or development environment, follow the steps in [Copy a Microsoft Dynamics 365 for Finance and Operations database from Azure SQL Database to a Microsoft SQL Server Environment](..\\database\\copy-database-from-azure-sql-to-sql-server.md). \n\n> [!IMPORTANT]\n> You do NOT need to upgrade your database if you are updating to the latest platform of Microsoft Dynamics 365 for Finance and Operations. Platform updates are backward compatible. This article only applies to the process of upgrading between releases of Finance and Operations applications, for example, upgrading from Release 1611 (November 2016) to the July 2017 release.\n> This process does not apply to the upgrade of data in Management Reporter database. It also does not apply to the upgrade of document attachments that are stored in Microsoft Azure blob storage.\n\n## Before you begin\n1.  You must have a functional one-box demo or development environment that is already successfully running with the latest Finance and Operations update.\n2.  If you are upgrading from the Dynamics AX February 2016 release (also known as RTW) and upgrading to the May 2016 release, then the following hotfixes must be installed. These fixes must be installed in the destination environment. If you are upgrading to a newer version than the May 2016 release, you **do not** need these fixes, they are already included.\n    -   Hotfix KB number 3170386, \"Upgrade script error: ReleaseUpdateDB70\\_DMF. updateIntegrationActivityExecutionMessageIdPreSync\".\n    -   Hotfix KB number 3180871, \"Data upgrade from RTW to Update 1 causes errors when synchronizing views involving disabled configuration keys\". This is a binary hotfix which will cause the database synchronize process to fail.\n\n3.  In your source environment you must be install the appropriate fix below for your version. These fixes will correct a bug in the SysSetupLog logic so that the upgrade understands correctly which version you are upgrading from:\n    - If upgrading from the February 2016 release (also known as RTW or 7.0) 7.0.1265.3015: Hotfix KB number 4023685 \"Could not find source system version information\" error when you upgrade to the latest Application Release \n    - If upgrading from the November 2016 release (also known as 1611 or 7.1) 7.1.1541.3036: Hotfix KB number 4023686 \"Could not find source system version information\" error when you upgrade to the latest Application Release \n    - If upgrading from the July 2017 release (also known as 7.2) 7.2.11792.56024: No additional fix is needed for this issue.\n\n > [!IMPORTANT]\n > If you have a golden database environment, and you have installed the application fixes from Step 3 and checked them into Visual Studio Team Services, ensure that the latest code is synchronized to your golden database environment and that a full database synchronization has been run. A full database synchronization is required because this step populates a new table that is used when upgrading the golden database.\n\n4.  If you're upgrading a database that began as a standard demo data database, you must also run the following script. This step is required because the demo data contains bad records for some kernel X++ classes.\n\n    delete from classidtable where id >= 0xf000 and id <= 0xffff\n5.  You must also apply the following KBs before proceeding.\n    - KB 4036156\n    - KB 4035399\n    - KB 4036157\n\n\n## Download the MinorVersionDataUpgradeWithRetail.zip script\nTo obtain the latest MinorVersionDataUpgradeWithRetail.zip package from your target environment that is running the latest Finance and Operations update, download the latest binary updates from Lifecycle Services (LCS).\n\n> [!NOTE]\n> The name of the data upgrade deployable package varies depending on what version you are upgrading from and to:\n> - If you are upgrading from AX 2012 the data upgrade package is called MajorVersionDataUpgradeWithRetail.zip. Download the latest binary updates for your Platform update 8 (or higher) environment to find this package.\n> - In earlier versions (prior to Platform update 4), the package was named DataUpgrade.zip. \n> - In later versions (from Platform update 8 onwards) the package is named MinorVersionDataUpgradeWithRetail.zip. Download the latest binary updates for your Platform update 8 (or higher) environment to find this package.\n\n1.  In LCS, in the **Environments** section, click your target Finance and Operations environment, scroll to the bottom of the page, and then click the **All binary updates** tile. \n\n> [!NOTE]\n> If the All binary updates tile shows zero updates available then use the MinorVersionDataUpgradeWithRetail.zip from the latest platform update package available in the **Shared Asset Library** in LCS within the **Software deployable package** section. For example, if upgrading to Dynamics 365 for Operations version 1611 with platform update 3 and the **All binary updates** tile shows zero updates, then use the \"D365 for Operations Platform Update 3\" package from the shared asset library. When using this package from the shared asset library, the path required in step 3 below changes to ..\\\\CustomDeployablePackage\n\n2.  On the **Add hotfixes** page, click **Select all**, click **Add**, and then click **Download package**.\n3.  On the next page, click **Download**.\n\n4.  After the package is downloaded, extract the contents, and go to the following directory to find the MinorVersionDataUpgradeWithRetail.zip file: ..\\\\CustomDeployablePackage\n\n\n> [!NOTE]\n> Computers that are deployed from LCS will already have a MinorVersionDataUpgradeWithRetail.zip file. However, that file is out of date and includes issues that have been resolved in later fixes. Always download the latest version of the file from LCS.\n\n## Remove encryption certification rotation\n1.  Extract the MinorVersionDataUpgradeWithRetail.zip deployable package to C:\\\\Temp or a location of your choice.\n2.  Open the following file in a text editor: C:\\\\Temp\\\\DataUpgrade\\\\RotateConfigData\\\\ServicingRotations.json file. Modify the file as shown here, and save it. This step is required only for one-box environments. Because you're removing the need for encryption certificate rotations, old data in encrypted fields in your database will no longer be readable. This is a technical limitation for a one-box data upgrade. New data that goes into those fields after the upgrade is completed is unaffected. For details about the affected fields, see the [\"Encrypted fields in demo data\"](#encrypted-fields-in-demo-data) section later in this topic.\n\n>       {\n>             \"AosService\": {\n>                              \"EncryptionThumbprint\": null,\n>                              \"SigningThumbprint\": null,\n>                              \"Certificates\": [\n>                                               ],\n>                               \"CertificateThumbprints\": [\n>                                              ],\n>                               \"KeyValues\": [\n>                                              ]\n>                           }\n>        }\n\n3.  Run the Windows PowerShell Integrated Scripting Environment (ISE) as an administrator.\n4.  Open C:\\\\Temp\\\\DataUpgrade\\\\RotateConfigData\\\\Scripts\\\\EncryptRotationConfigData.ps1.\n5.  Press F5 to run the script.\n\n### Fix the duplicate key issue (February 2016 release only)\n\nThis step is required if you're upgrading a database from the February 2016 release (also known as RTW).\n\n1.  Open the following file in a text editor: C:\\\\Temp\\\\DataUpgrade\\\\AOSService\\\\Scripts\\\\AutoDataUpgradePreReqs.ps1.\n2.  Comment out or remove the following line.\n\n>        Invoke-SQL -sqlCommand:$adjustsqlseq\n\n3.  Save the file.\n\n## Upgrade the database\n1.  Install the deployable package from the C:\\\\Temp\\\\DataUpgrade folder (the location that you extracted to earlier). Use the instructions in [Install a deployable package](../deployment/install-deployable-package.md).\n2.  Restore a backup of the source database to your one-box demo or development environment that is already running the latest Finance and Operations update that you want to upgrade to. **Note:** For better upload/download speed between Azure virtual machines (VMs), we recommend that you use AzCopy. For details about how to download and use AzCopy to copy to or from an Azure blob store, see [Transfer data with the AzCopy Command-Line Utility](https://azure.microsoft.com/en-us/documentation/articles/storage-use-azcopy/).\n3.  Run the runbook file until Step 4: GlobalBackup.\n4.  Rename the existing Update 1 database, and replace it with the source database that you want to upgrade.\n\n        ALTER DATABASE <Update1_AX_DATABASENAME> MODIFY NAME = <Update1_AX_DATABASENAME>_ORIG\n        ALTER DATABASE <Source_AX_DATABASENAME> MODIFY NAME = <Update1_AX_DATABASENAME>\n\n5.  Create a backup of the source database, in case you need to revert to it, because the following steps will modify the source database.\n6.  Mark step 4 of the runbook as completed, and continue to run the runbook until it's completed. \n\n**Notes:**\n    -   The steps after step 4 of the runbook run the upgrade scripts.\n    -   If there is data in any staging tables that is used by data management, this step fails, and you receive the following error message.\n\n        > Staging tables should be empty in order to proceed with the data upgrade. Please run the DeleteScriptForStagingTables.sql by carefully reviewing the script in order to remove the data from the staging tables.\n\n        In this case, run DeleteScriptForStagingTables.sql to clean up the staging tables. You can find this script under AOSServiceScripts in your data upgrade folder. After the script has finished running, re-run this step.\n\n## Re-enable SQL change tracking\nExecute the following SQL against the upgraded database to ensure that change tracking is enabled at the database level. You must insert the name of your database within the alter database command.\n\n        ALTER DATABASE [<your AX database name>] SET CHANGE_TRACKING = ON (CHANGE_RETENTION = 6 DAYS, AUTO_CLEANUP = ON)\n\n## Additional steps for Management Reporter\n\nReset the management reporter database by following the steps in this topic [Resetting the financial reporting data mart after restoring a database](../analytics/reset-financial-reporting-datamart-after-restore.md) and then reimport the building block groups you exported in an earlier step.\n\n## Troubleshoot upgrade script errors\n### How to re-run the runbook after a data upgrade script failure\n\nA data upgrade deployable package allows more granular re-running than a typical deployable package. The step at which the data upgrade scripts begin executing is Step 5. If you experience a failure during Step 5, check the output in the command window to identify which sub-step you reached. For example it may be 5.3, the issue the command follows to re-run from that sub-step. This is to allow you to keep re-running a particular failing script during debugging, without having to re-run the entire data upgrade piece (including database synchronization).\n\n    AXUpdateInstaller.exe execute -runbookid=upgrade -rerunstep=5.3\n\n### How to view more detail about a script error\n\nUpgrade scripts are running in X++ using a batch process that the runbook installer is starting. There are classes you can view in the Application Explorer in Visual Studio, they are prefixed with *ReleaseUpdate*. If an upgrade script fails during the runbook process you can discover more detail about the reason for the error by opening SQL Management Studio and querying the ReleaseUpdateScriptsErrorLog as follows.\n\n    select \\* from RELEASEUPDATESCRIPTSERRORLOG\n\nIt is possible to take that code, add it to a new runnable class in Visual Studio, and directly observe, debug, and rework it’s behavior.\n\n### How to skip failed scripts\n\n> [!IMPORTANT]\n> This process is only designed to be used in a development scenario. \n\nSkipping failed scripts is an aid to the troubleshooting process and lets you skip all scripts that have failed a certain number of times and move to the next viable scripts. The process is intentionally very manual, to reduce the likelihood that you skip scripts without realizing that they were skipped. \n\nIn the table **ReleaseUpdateConfiguration** there is a new field called **ScriptRetryCount**. The value in this field controls how many times the runbook process will re-run a script before it ignores it. When the runbook executes, the system updates the field ReleaseUpdateScriptsErrorLog.ErrorCount each time a specific script fails (creating a new row for each distinct script). \nIn the DataUpgrade package folder, under ..\\\\AosServices\\\\Scripts\\\\ is a script named IgnoreBlockingScripts.ps1. Execute this from an Administrator PowerShell window to skip all scripts where the ScriptRetryCount=ErrorCount. \nThen re-run the failed runbook step so that scripts will be ignored. The field **ReleaseUpdateScriptsErrorLog.Ignored** will also be set for each skipped script so that they can be identified later.\n\n### How to monitor duration of executed scripts\n\nEach successfully executed script records the amount of time that it took to process (in minutes) in the **ReleaseUpdateScriptsLog.DurationMins** column. This is intended as a simple way to identify the longest running scripts when working on performance tuning the data upgrade process. It is important to understand that the timing is the duration each script takes to run, however multiple scripts will run in parallel, so the sum of the **DurationMins** column is greater than the overall duration of the upgrade process.\n\n## Known issues\n### Duplicate key was found for the object name 'dbo.RESOURCESETUP' \nWhen upgrading a database, you may experience the following error during the database synchronize phase of the runbook process.\n\n> Database execution failed: The CREATE UNIQUE INDEX statement terminated because a duplicate key was found for the object name 'dbo.RESOURCESETUP' and the index name 'I_6716AK'\n\n\nThis is a known issue that will be resolved in a future hotfix. The workaround is to delete the duplicate rows from this table by executing the following SQL script against the database from SQL Server Management Studio.\n\n    delete RS from ResourceSetup as RS\n    join ResResourceIdentifier as RRI on RRI.RecId = RS.Resource_\n    join WrkCtrTable as WCT on WCT.RecId = RRI.RefRecId\n    join DirPartyTable as DPT on DPT.DataArea = WCT.DataAreaId\n    where DPT.DataArea != '' and RS.LegalEntity != DPT.RecId\n\n\n### Cannot select a record in Dimension hierarchy nodes (CAMDataDimensionHierarchyNode). \nWhen upgrading a database, you may experience the following error during the database synchronize phase of the runbook process.\n\n>  Cannot select a record in Dimension hierarchy nodes (CAMDataDimensionHierarchyNode). Dimension hierarchy: 0. The SQL database has issued an error. Object Server DynamicsAXBatchManagement:  [Microsoft][ODBC Driver 13 for SQL Server][SQL Server]Invalid column name 'RELATIONTYPE'. \n\n\nThis is a known issue that will be resolved in a future release. The workaround is to create a missing field in several tables by executing the following SQL script against the database from SQL Server Management Studio.\n\n    SET ANSI_NULLS ON\n    GO\n    SET QUOTED_IDENTIFIER ON\n    GO\n    DROP PROCEDURE IF EXISTS [DBO].PATCHRELATIONTYPE\n    GO \n\n    CREATE PROCEDURE [DBO].PATCHRELATIONTYPE\n            @TABLENAME SYSNAME\n        AS\n        BEGIN\n            DECLARE @TABLEID        INT ;\n            DECLARE @FIELDID        INT ;\n            DECLARE @FIELDNAME      SYSNAME;\n            DECLARE @SQLTATEMENT NVARCHAR(1024);\n            DECLARE @TOTALRECORDS   INT;\n            DECLARE @ParmDefinition         NVARCHAR(150);\n\n            SET NOCOUNT ON;\n\n            SELECT @FIELDNAME = 'RELATIONTYPE';\n            SELECT @FIELDID = 61453; --Hardcoded in code DBFIELD_DISCRIMINATOR\n            IF OBJECT_ID(@TABLENAME, 'U') IS NULL \n            BEGIN\n                PRINT @TABLENAME + ' table does not exists. Please provide a base table';\n                RETURN;\n            END\n\n            IF EXISTS(SELECT 1 FROM SYS.COLUMNS\n              WHERE NAME = @FIELDNAME\n              AND OBJECT_ID = OBJECT_ID(@TABLENAME))\n            BEGIN\n                PRINT @TABLENAME + ' table contains RelationType. No patching needed.';\n                RETURN;\n            END\n            PRINT @TABLENAME + ' table does not contain RelationType.';\n            SELECT @TABLEID = ID FROM TABLEIDTABLE WHERE NAME = @TABLENAME;\n            IF @@ROWCOUNT <> 1\n            BEGIN\n                PRINT @TABLENAME + ' was not present in TABLEIDTABLE. Cannot proceed!!';\n                RETURN;\n            END \n\n            -- Ensure that instancerelationtype is added. We don't want to randomly add relationtype to any table.\n            IF NOT EXISTS (SELECT \\* FROM SQLDICTIONARY WHERE TABLEID = @TABLEID AND NAME = 'InstanceRelationType')     \n            BEGIN\n                PRINT @TABLENAME + ' table does not exists. Please provide a base table';\n                RETURN;\n            END\n\n            -- Ensure SQLDictionary is populated\n            IF NOT EXISTS (SELECT \\* FROM SQLDICTIONARY WHERE TABLEID = @TABLEID AND FIELDID = @FIELDID)\n            BEGIN\n                INSERT INTO SQLDICTIONARY (TABLEID, FIELDID, ARRAY, NAME, SQLNAME, FIELDTYPE, STRSIZE, SHADOW, RIGHTJUSTIFY, NULLABLE, FLAGS, RECVERSION)\n                VALUES (@TABLEID,@FIELDID,1, @FIELDNAME, @FIELDNAME, 49, 0, 0, 0, 0, 0, 1);\n                PRINT 'Inserted into SqlDictionary';\n            END\n\n            -- Actual alter statement\n            SELECT @SQLTATEMENT = 'ALTER TABLE ' + @TABLENAME +  ' ADD ' + @FIELDNAME + ' BIGINT NOT NULL DEFAULT 0';\n            PRINT 'Issuing ' + @SQLTATEMENT;\n            EXEC (@SQLTATEMENT);\n\n            SELECT @SQLTATEMENT = 'UPDATE ' + @TABLENAME +  ' SET RELATIONTYPE = 0';\n            PRINT 'Issuing ' + @SQLTATEMENT;\n            EXEC (@SQLTATEMENT);\n        END;\n    GO\n    exec PatchRelationType  'CAMDATADIMENSIONHIERARCHYNODE'\n    exec PatchRelationType  'CAMDataJournal'\n    exec PatchRelationType  'CAMDataCostAccountingLedgerSourceEntryProvider'\n    exec PatchRelationType  'CAMDataImportedDimensionMember'\n\n### Cannot create index on InventDistinctProduct\n\nWhen upgrading a database, you may experience the following error during the database synchronize phase of the runbook process.\n\n> Cannot create index on InventDistinctProduct a duplicate key exists on column Product.\n\n\nThis is a known issue that will be resolved in a future release. The workaround is to delete all records in the **InventDistinctProduct** table and then resume the runbook from the current step. The records contained in this table are disposable and will be regenerated either the first time Microsoft Dynamics 365 for Finance and Operations is launched, when an item is created, or when MRP is run. To drop all records in **InventDistinctProduct**, execute the following query against the current database from SQL Management Studio.\n\n    truncate table InventDistinctProduct\n\nTo resume the runbook from the current operation, use the following command.\n\n    axupdateinstaller execute -runbookid=<your runbook name> -rerunstep=<the last step number>\n\nFor example, you can use this command.\n\n    axupdateinstaller execute -runbookid=dataupgrade -rerunstep=5.4\n\n### An exchange rate cannot be found when upgrading demo data\n\nWhen upgrading a demo database, you may receive the following error when deploying the DataUpgrade package.\n\n> An exchange rate cannot be found for exchange rate type Default between currencies INR and BRL on exchange date 12/1/2014.\n\nAs you're upgrading demo data, look in table **TrvUnreconciledExpenseTransaction**, which is where the offending expense line is, and change the currency to USD (because it's demo data, we don't need to be careful to preserve this expense line).\n\n    update TrvUnreconciledExpenseTransaction\n    set transactioncurrencycode = 'USD'\n    where transactioncurrencycode = 'INR'\n\nAlternatively, you can go to the original environment the data came from (such as the old version) and add the missing exchange rate in **General Ledger** &gt; **Currencies** &gt; **Currency exchange rates**. You need to add a record for INR and BRL that covers 2014, then take that database and bring it into your new environment and start the upgrade against that database.\n\n### Error: The interpreter evaluation stack has grown during a call to the kernel\n\nThis error can occur if you have enabled database logging on a kernel table such as UserInfo. The solution is to review the database log setup in **System administration** &gt; **Setup** &gt; **Database log setup** and remove records for kernel tables as necessary. The full error is as follows.\n\n    Executing step: 5.1\n    prereq for data upgrade\n    prereq for data upgrade\n    Unhandled exception More Information: The interpreter evaluation stack has grown during a call to the kernel method xRecord::Delete(), height before call: 0, height after call: 3. Unhandled exception More Information: KernelInstance: Kernel is accessing deleted memory\n    The step failed\n\n### The batch process fails to start\n\nThe batch process can fail if the environment has been left in [maintenance mode](../sysadmin/maintenance-mode.md) following a change to configuration keys. To resolve, turn maintenance mode off and resume the runbook process.\n\n### The system fails to locate or generate a user GUID\n\nYou might receive the following error message.\n\n> …Unhandled exception More Information: System failed to locate or generate a user GUID…\n\nIn this case, rerun the runbook step that failed. You will then be able to continue.\n\n### Pre-sync or post-sync errors on ReleaseUpdateDB71\\_LedgerPeriodClose\n\nYou might receive one of the following error messages on either preSyncLedgerPeriodCloseTemplateTask, updateMenuItemTypeForCurrencyReval, updateLedgerPeriodCloseTemplateTask methods in the ReleaseUpdateDB71\\_LedgerPeriodClose class.\n\n> Cannot execute the required database operation. The SQL database has issued an error. Object Server DynamicsAXBatchManagement: \\[Microsoft\\]\\[SQL Server Native Client 11.0\\]\\[SQL Server\\]Invalid column name 'TEMPLATE'. INSERT INTO LedgerPeriodCloseTemplateTaskTmp ( TEMPLATE, AREA, NAME, MENUITEM, MENUITEMTYPE, TARGETDAYSFROMPROJECTCOMPLETE, DUETIME, LEGALENTITYSELECTION, RECVERSION, PARTITION, RECID, CLOSINGROLE, LINENUM) SELECT T1.TEMPLATE, T1.AREA, T1.NAME, T1.MENUITEM, T1.MENUITEMTYPE, T1.TARGETDAYSFROMPROJECTCOMPLETE, T1.DUETIME, T1.LEGALENTITYSELECTION, T1.RECVERSION, T1.PARTITION, T1.RECID, T1.CLOSINGROLE, 0 FROM LedgerPeriodCloseTemplateTask T1 session 1013 (Admin) Microsoft.Dynamics.Ax.Xpp.ErrorException: Cannot execute the required database operation. The SQL database has issued an error.\n\n> Cannot execute the required database operation. The SQL database has issued an error. Object Server DynamicsAXBatchManagement: \\[Microsoft\\]\\[SQL Server Native Client 11.0\\]\\[SQL Server\\]Invalid column name 'MENUITEMTYPE'. UPDATE LedgerPeriodCloseTemplateTaskTmp SET MENUITEMTYPE = 0 WHERE MENUITEMTYPE = 2 AND MENUITEM = 'LedgerExchAdj' AND PARTITION = 5637144576 session 1013 (Admin) Microsoft.Dynamics.Ax.Xpp.ErrorException: Cannot execute the required database operation. The SQL database has issued an error.\n\n> Cannot execute the required database operation. The SQL database has issued an error. Object Server DynamicsAXBatchManagement: \\[Microsoft\\]\\[SQL Server Native Client 11.0\\]\\[SQL Server\\]Invalid column name 'TEMPLATE'. INSERT INTO LedgerPeriodCloseTemplateTask ( TEMPLATE, AREA, NAME, MENUITEM, MENUITEMTYPE, TARGETDAYSFROMPROJECTCOMPLETE, DUETIME, LEGALENTITYSELECTION, RECVERSION, PARTITION, RECID, CLOSINGROLE, LINENUM) SELECT T1.TEMPLATE, T1.AREA, T1.NAME, T1.MENUITEM, T1.MENUITEMTYPE, T1.TARGETDAYSFROMPROJECTCOMPLETE, T1.DUETIME, T1.LEGALENTITYSELECTION, T1.RECVERSION, T1.PARTITION, T1.RECID, T1.CLOSINGROLE, T1.LINENUM FROM LedgerPeriodCloseTemplateTaskTmp T1 session 1013 (Admin)\n\nIn this case, manually drop the table **LedgerPeriodCloseTemplateTaskTmp** from the database via SQL Management Studio, and then re-run the runbook step. This issue will be fixed in a future hotfix.\n\n### KB number 3170386\n\nIf KB number 3170386 isn't installed, you will receive the following error message.\n\n> *GlobalUpdate script for service model: AOSService on machine …. Etc …. UpgradeServiceHelper::WaitForDataUpgradeToComplete(Object\\[\\]… The step failed*\n\nThis error is caused by a failure in the pre-sync or the post-sync substep of the data upgrade. You can use the following steps to determine which substep failed and the details of the failure. **Note:** You can't rerun the failed runbook step until the pre-sync or post-sync substep has been manually completed and the AutoDataUpgrade.config file has been updated to skip the substeps that have already been run.\n\n1.  In File Explorer, in the …DataUpgradeAosServiceScripts folder, sort by descending order of date modified, and then look at the file at the top of the list to determine which substep failed.\n    -   If the top file is named dbUpgrade*PreSync*Monitor.error.log, the pre-sync substep failed.\n    -   If the top file is named dbUpgrade*PostSync*Monitor.error.log, the post-sync substep failed.\n\n2.  In Management Studio, run the following **SELECT** statement.\n\n        SELECT * FROM RELEASEUPDATELOG\n\n    The second-to-last record in the result set will have the errors and call stacks for all the failures.\n\n### DMF errors\n\nIf you receive either of the following Data Migration Framework (DMF) errors, download Hotfix KB number 3170386, and restart the upgrade process.\n\n#### DMF pre-sync\n\n> Batch error: initial.DAT.ReleaseUpdateDB70\\_DMF.updateIntegrationActivityExecutionMessageIdPreSync (Batch:AOS-F01B9F0CCC8, 9, Info, Error, ):\\[\\[1\\]\\[3,Cannot execute the required database operation. The SQL database has issued an error.\\]\\[3,Object Server DynamicsAXBatchManagement: \\]\\[3,\\[Microsoft\\]\\[SQL Server Native Client 11.0\\]\\[SQL Server\\]Incorrect syntax near 'GO'.\\]\\[3,\n\n#### DMF post-sync\n\n> Batch error: initial.DAT.ReleaseUpdateDB70\\_DMF.updateIntegrationActivityExecutionMessageIdPostSync (Batch:AOS-F01B9F0CCC8, 9, Info, Error, ):\\[\\[1\\]\\[3,Cannot execute the required database operation.The SQL database has issued an error.\\]\\[3,Object Server DynamicsAXBatchManagement: \\]\\[3,\\[Microsoft\\]\\[SQL Server Native Client 11.0\\]\\[SQL Server\\]Incorrect syntax near 'GO'.\\]\\[3,\n\n## Encrypted fields in demo data\nAfter upgrade, values in encrypted fields in the database will be unreadable. However, new values that are entered in these fields after upgrade will be readable. This behavior occurs because of a technical limitation that is related to the certificate that is used for data encryption. The following table shows the fields that are affected.\n\n| Table.Field                                                      | Data exists in demo data |\n|------------------------------------------------------------------|--------------------------|\n| CreditCardAccountSetup.SecureMerchantProperties                  | Yes                      |\n| ExchangeRateProviderConfigurationDetails.Value                   | Yes                      |\n| RetailChannelPaymentConnectorLine.SecureMerchantProperties       | Yes                      |\n| RetailConnDatabaseProfile.ConnectionString                       | Yes                      |\n| RetailHardwareProfile.SecureMerchantProperties                   | Yes                      |\n| RetailHardwareProfileMerchantInfoEntity.SecureMerchantProperties | Yes                      |\n| FiscalEstablishment\\_BR.ConsumerEFDocCsc                         | No                       |\n| FiscalEstablishmentEntity.CSC                                    | No                       |\n| FiscalEstablishmentStaging.CSC                                   | No                       |\n| HcmPersonIdentificationNumber.PersonIdentificationNumber         | No                       |\n| HcmWorkerActionHire.PersonIdentificationNumber                   | No                       |\n| SysEmailSMPTPassword.Password                                    | No                       |\n| SysOAuthUserTokens.EncryptedAccessToken                          | No                       |\n| SysOAuthUserTokens.EncryptedRefreshToken                         | No                       |\n\n\n\nSee also\n--------\n\n[Overview of moving to the latest update of Microsoft Dynamics 365 for Finance and Operations](upgrade-latest-update.md)\n\n","nodes":[{"pos":[4,768],"embed":true,"restype":"x-metadata","content":"# required metadata\n\ntitle: Upgrade data in development, demo, or sandbox environments\ndescription: This topic provides instructions for upgrading your Microsoft Dynamics 365 for Finance and Operations database to the latest update.\nauthor: tariqbell\nmanager: AnnBe\nms.date: 07/10/2017\nms.topic: article\nms.prod: \nms.service: dynamics-ax-platform\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \nms.reviewer: margoc\nms.search.scope: Operations, Platform, UnifiedOperations, AX Platform\n# ms.tgt_pltfrm: \nms.custom: 106163\nms.assetid: 0c78b7a9-a360-4ef8-92ef-e4e9ff70cee7\nms.search.region: Global\n# ms.search.industry: \nms.author: tabell\nms.search.validFrom: 2016-05-31\nms.dyn365.ops.version: Platform update 1\n","nodes":[{"content":"Upgrade data in development, demo, or sandbox environments","nodes":[{"pos":[0,58],"content":"Upgrade data in development, demo, or sandbox environments","nodes":[{"content":"Upgrade data in development, demo, or sandbox environments","pos":[0,58]}]}],"path":["title"],"extradata":"MT"},{"content":"This topic provides instructions for upgrading your Microsoft Dynamics 365 for Finance and Operations database to the latest update.","nodes":[{"pos":[0,132],"content":"This topic provides instructions for upgrading your Microsoft Dynamics 365 for Finance and Operations database to the latest update.","nodes":[{"content":"This topic provides instructions for upgrading your Microsoft Dynamics 365 for Finance and Operations database to the latest update.","pos":[0,132]}]}],"path":["description"],"extradata":"MT"}],"header":"# required metadata\n","yml":true},{"pos":[776,834],"content":"Upgrade data in development, demo, or sandbox environments","linkify":"Upgrade data in development, demo, or sandbox environments","nodes":[{"content":"Upgrade data in development, demo, or sandbox environments","pos":[0,58]}]},{"content":"This topic provides instructions for upgrading your Microsoft Dynamics 365 for Finance and Operations database in a Tier 1 environment (also know as a development box, one-box, or demo environment) to the latest update.","pos":[880,1099]},{"content":"In some Tier 2 or higher environments the Microsoft Service Engineering Team (DSE) will execute the data upgrade for you.","pos":[1101,1222]},{"content":"For more information, see the end to end upgrade process here: <bpt id=\"p1\">[</bpt>Overview of moving to the latest update of Microsoft Dynamics 365 for Finance and Operations<ept id=\"p1\">](upgrade-latest-update.md#scenario-3-upgrade-to-the-most-current-application-update)</ept>.","pos":[1223,1465],"source":" For more information, see the end to end upgrade process here: [Overview of moving to the latest update of Microsoft Dynamics 365 for Finance and Operations](upgrade-latest-update.md#scenario-3-upgrade-to-the-most-current-application-update)."},{"content":"This topic describes how to upgrade an older source database to the latest Finance and Operations update.","pos":[1467,1572]},{"content":"To copy a database from a production environment back to a one-box demo or development environment, follow the steps in <bpt id=\"p1\">[</bpt>Copy a Microsoft Dynamics 365 for Finance and Operations database from Azure SQL Database to a Microsoft SQL Server Environment<ept id=\"p1\">](..\\database\\copy-database-from-azure-sql-to-sql-server.md)</ept>.","pos":[1573,1882],"source":" To copy a database from a production environment back to a one-box demo or development environment, follow the steps in [Copy a Microsoft Dynamics 365 for Finance and Operations database from Azure SQL Database to a Microsoft SQL Server Environment](..\\database\\copy-database-from-azure-sql-to-sql-server.md)."},{"pos":[1887,2472],"content":"[!IMPORTANT]\nYou do NOT need to upgrade your database if you are updating to the latest platform of Microsoft Dynamics 365 for Finance and Operations. Platform updates are backward compatible. This article only applies to the process of upgrading between releases of Finance and Operations applications, for example, upgrading from Release 1611 (November 2016) to the July 2017 release.\nThis process does not apply to the upgrade of data in Management Reporter database. It also does not apply to the upgrade of document attachments that are stored in Microsoft Azure blob storage.","leadings":["","> ","> "],"nodes":[{"content":"You do NOT need to upgrade your database if you are updating to the latest platform of Microsoft Dynamics 365 for Finance and Operations. Platform updates are backward compatible. This article only applies to the process of upgrading between releases of Finance and Operations applications, for example, upgrading from Release 1611 (November 2016) to the July 2017 release.\nThis process does not apply to the upgrade of data in Management Reporter database. It also does not apply to the upgrade of document attachments that are stored in Microsoft Azure blob storage.","pos":[13,581],"nodes":[{"content":"You do NOT need to upgrade your database if you are updating to the latest platform of Microsoft Dynamics 365 for Finance and Operations.","pos":[0,137]},{"content":"Platform updates are backward compatible.","pos":[138,179]},{"content":"This article only applies to the process of upgrading between releases of Finance and Operations applications, for example, upgrading from Release 1611 (November 2016) to the July 2017 release.","pos":[180,373]},{"content":"This process does not apply to the upgrade of data in Management Reporter database.","pos":[374,457],"source":"\nThis process does not apply to the upgrade of data in Management Reporter database."},{"content":"It also does not apply to the upgrade of document attachments that are stored in Microsoft Azure blob storage.","pos":[458,568]}]}]},{"pos":[2477,2493],"content":"Before you begin","linkify":"Before you begin","nodes":[{"content":"Before you begin","pos":[0,16]}]},{"content":"You must have a functional one-box demo or development environment that is already successfully running with the latest Finance and Operations update.","pos":[2498,2648]},{"content":"If you are upgrading from the Dynamics AX February 2016 release (also known as RTW) and upgrading to the May 2016 release, then the following hotfixes must be installed.","pos":[2653,2822]},{"content":"These fixes must be installed in the destination environment.","pos":[2823,2884]},{"content":"If you are upgrading to a newer version than the May 2016 release, you <bpt id=\"p1\">**</bpt>do not<ept id=\"p1\">**</ept> need these fixes, they are already included.","pos":[2885,3011],"source":" If you are upgrading to a newer version than the May 2016 release, you **do not** need these fixes, they are already included."},{"content":"Hotfix KB number 3170386, \"Upgrade script error: ReleaseUpdateDB70<ph id=\"ph1\">\\_</ph>DMF.","pos":[3020,3092],"source":"Hotfix KB number 3170386, \"Upgrade script error: ReleaseUpdateDB70\\_DMF."},{"content":"updateIntegrationActivityExecutionMessageIdPreSync\".","pos":[3093,3145]},{"content":"Hotfix KB number 3180871, \"Data upgrade from RTW to Update 1 causes errors when synchronizing views involving disabled configuration keys\".","pos":[3154,3293]},{"content":"This is a binary hotfix which will cause the database synchronize process to fail.","pos":[3294,3376]},{"content":"In your source environment you must be install the appropriate fix below for your version.","pos":[3382,3472]},{"content":"These fixes will correct a bug in the SysSetupLog logic so that the upgrade understands correctly which version you are upgrading from:","pos":[3473,3608]},{"content":"If upgrading from the February 2016 release (also known as RTW or 7.0) 7.0.1265.3015: Hotfix KB number 4023685 \"Could not find source system version information\" error when you upgrade to the latest Application Release","pos":[3615,3833]},{"content":"If upgrading from the November 2016 release (also known as 1611 or 7.1) 7.1.1541.3036: Hotfix KB number 4023686 \"Could not find source system version information\" error when you upgrade to the latest Application Release","pos":[3841,4060]},{"content":"If upgrading from the July 2017 release (also known as 7.2) 7.2.11792.56024: No additional fix is needed for this issue.","pos":[4068,4188]},{"pos":[4193,4627],"content":"[!IMPORTANT]\nIf you have a golden database environment, and you have installed the application fixes from Step 3 and checked them into Visual Studio Team Services, ensure that the latest code is synchronized to your golden database environment and that a full database synchronization has been run. A full database synchronization is required because this step populates a new table that is used when upgrading the golden database.","leadings":[""," > "],"nodes":[{"content":"If you have a golden database environment, and you have installed the application fixes from Step 3 and checked them into Visual Studio Team Services, ensure that the latest code is synchronized to your golden database environment and that a full database synchronization has been run. A full database synchronization is required because this step populates a new table that is used when upgrading the golden database.","pos":[13,431],"nodes":[{"content":"If you have a golden database environment, and you have installed the application fixes from Step 3 and checked them into Visual Studio Team Services, ensure that the latest code is synchronized to your golden database environment and that a full database synchronization has been run.","pos":[0,285]},{"content":"A full database synchronization is required because this step populates a new table that is used when upgrading the golden database.","pos":[286,418]}]}]},{"content":"If you're upgrading a database that began as a standard demo data database, you must also run the following script.","pos":[4633,4748]},{"content":"This step is required because the demo data contains bad records for some kernel X++ classes.","pos":[4749,4842]},{"content":"delete from classidtable where id &gt;= 0xf000 and id &lt;= 0xffff","pos":[4848,4908],"source":"delete from classidtable where id >= 0xf000 and id <= 0xffff"},{"content":"You must also apply the following KBs before proceeding.","pos":[4913,4969]},{"content":"KB 4036156","pos":[4976,4986]},{"content":"KB 4035399","pos":[4993,5003]},{"content":"KB 4036157","pos":[5010,5020]},{"pos":[5026,5083],"content":"Download the MinorVersionDataUpgradeWithRetail.zip script","linkify":"Download the MinorVersionDataUpgradeWithRetail.zip script","nodes":[{"content":"Download the MinorVersionDataUpgradeWithRetail.zip script","pos":[0,57]}]},{"content":"To obtain the latest MinorVersionDataUpgradeWithRetail.zip package from your target environment that is running the latest Finance and Operations update, download the latest binary updates from Lifecycle Services (LCS).","pos":[5084,5303]},{"pos":[5307,5428],"content":"[!NOTE]\nThe name of the data upgrade deployable package varies depending on what version you are upgrading from and to:","leadings":["","> "],"nodes":[{"content":"The name of the data upgrade deployable package varies depending on what version you are upgrading from and to:","pos":[8,119]}]},{"content":"If you are upgrading from AX 2012 the data upgrade package is called MajorVersionDataUpgradeWithRetail.zip.","pos":[5433,5540]},{"content":"Download the latest binary updates for your Platform update 8 (or higher) environment to find this package.","pos":[5541,5648]},{"content":"In earlier versions (prior to Platform update 4), the package was named DataUpgrade.zip.","pos":[5653,5741]},{"content":"In later versions (from Platform update 8 onwards) the package is named MinorVersionDataUpgradeWithRetail.zip.","pos":[5747,5857]},{"content":"Download the latest binary updates for your Platform update 8 (or higher) environment to find this package.","pos":[5858,5965]},{"pos":[5971,6147],"content":"In LCS, in the <bpt id=\"p1\">**</bpt>Environments<ept id=\"p1\">**</ept> section, click your target Finance and Operations environment, scroll to the bottom of the page, and then click the <bpt id=\"p2\">**</bpt>All binary updates<ept id=\"p2\">**</ept> tile.","source":"In LCS, in the **Environments** section, click your target Finance and Operations environment, scroll to the bottom of the page, and then click the **All binary updates** tile."},{"pos":[6152,6782],"content":"[!NOTE]\nIf the All binary updates tile shows zero updates available then use the MinorVersionDataUpgradeWithRetail.zip from the latest platform update package available in the **Shared Asset Library** in LCS within the **Software deployable package** section. For example, if upgrading to Dynamics 365 for Operations version 1611 with platform update 3 and the **All binary updates** tile shows zero updates, then use the \"D365 for Operations Platform Update 3\" package from the shared asset library. When using this package from the shared asset library, the path required in step 3 below changes to ..\\\\CustomDeployablePackage","leadings":["","> "],"nodes":[{"content":"If the All binary updates tile shows zero updates available then use the MinorVersionDataUpgradeWithRetail.zip from the latest platform update package available in the **Shared Asset Library** in LCS within the **Software deployable package** section. For example, if upgrading to Dynamics 365 for Operations version 1611 with platform update 3 and the **All binary updates** tile shows zero updates, then use the \"D365 for Operations Platform Update 3\" package from the shared asset library. When using this package from the shared asset library, the path required in step 3 below changes to ..\\\\CustomDeployablePackage","pos":[8,628],"nodes":[{"content":"If the All binary updates tile shows zero updates available then use the MinorVersionDataUpgradeWithRetail.zip from the latest platform update package available in the <bpt id=\"p1\">**</bpt>Shared Asset Library<ept id=\"p1\">**</ept> in LCS within the <bpt id=\"p2\">**</bpt>Software deployable package<ept id=\"p2\">**</ept> section.","pos":[0,251],"source":"If the All binary updates tile shows zero updates available then use the MinorVersionDataUpgradeWithRetail.zip from the latest platform update package available in the **Shared Asset Library** in LCS within the **Software deployable package** section."},{"content":"For example, if upgrading to Dynamics 365 for Operations version 1611 with platform update 3 and the <bpt id=\"p1\">**</bpt>All binary updates<ept id=\"p1\">**</ept> tile shows zero updates, then use the \"D365 for Operations Platform Update 3\" package from the shared asset library.","pos":[252,492],"source":" For example, if upgrading to Dynamics 365 for Operations version 1611 with platform update 3 and the **All binary updates** tile shows zero updates, then use the \"D365 for Operations Platform Update 3\" package from the shared asset library."},{"content":"When using this package from the shared asset library, the path required in step 3 below changes to ..<ph id=\"ph1\">\\\\</ph>CustomDeployablePackage","pos":[493,620],"source":" When using this package from the shared asset library, the path required in step 3 below changes to ..\\\\CustomDeployablePackage"}]}]},{"pos":[6788,6891],"content":"On the <bpt id=\"p1\">**</bpt>Add hotfixes<ept id=\"p1\">**</ept> page, click <bpt id=\"p2\">**</bpt>Select all<ept id=\"p2\">**</ept>, click <bpt id=\"p3\">**</bpt>Add<ept id=\"p3\">**</ept>, and then click <bpt id=\"p4\">**</bpt>Download package<ept id=\"p4\">**</ept>.","source":"On the **Add hotfixes** page, click **Select all**, click **Add**, and then click **Download package**."},{"pos":[6896,6933],"content":"On the next page, click <bpt id=\"p1\">**</bpt>Download<ept id=\"p1\">**</ept>.","source":"On the next page, click **Download**."},{"content":"After the package is downloaded, extract the contents, and go to the following directory to find the MinorVersionDataUpgradeWithRetail.zip file: ..<ph id=\"ph1\">\\\\</ph>CustomDeployablePackage","pos":[6939,7111],"source":"After the package is downloaded, extract the contents, and go to the following directory to find the MinorVersionDataUpgradeWithRetail.zip file: ..\\\\CustomDeployablePackage"},{"pos":[7116,7377],"content":"[!NOTE]\nComputers that are deployed from LCS will already have a MinorVersionDataUpgradeWithRetail.zip file. However, that file is out of date and includes issues that have been resolved in later fixes. Always download the latest version of the file from LCS.","leadings":["","> "],"nodes":[{"content":"Computers that are deployed from LCS will already have a MinorVersionDataUpgradeWithRetail.zip file. However, that file is out of date and includes issues that have been resolved in later fixes. Always download the latest version of the file from LCS.","pos":[8,259],"nodes":[{"content":"Computers that are deployed from LCS will already have a MinorVersionDataUpgradeWithRetail.zip file.","pos":[0,100]},{"content":"However, that file is out of date and includes issues that have been resolved in later fixes.","pos":[101,194]},{"content":"Always download the latest version of the file from LCS.","pos":[195,251]}]}]},{"pos":[7382,7422],"content":"Remove encryption certification rotation","linkify":"Remove encryption certification rotation","nodes":[{"content":"Remove encryption certification rotation","pos":[0,40]}]},{"content":"Extract the MinorVersionDataUpgradeWithRetail.zip deployable package to C:<ph id=\"ph1\">\\\\</ph>Temp or a location of your choice.","pos":[7427,7537],"source":"Extract the MinorVersionDataUpgradeWithRetail.zip deployable package to C:\\\\Temp or a location of your choice."},{"content":"Open the following file in a text editor: C:<ph id=\"ph1\">\\\\</ph>Temp<ph id=\"ph2\">\\\\</ph>DataUpgrade<ph id=\"ph3\">\\\\</ph>RotateConfigData<ph id=\"ph4\">\\\\</ph>ServicingRotations.json file.","pos":[7542,7654],"source":"Open the following file in a text editor: C:\\\\Temp\\\\DataUpgrade\\\\RotateConfigData\\\\ServicingRotations.json file."},{"content":"Modify the file as shown here, and save it.","pos":[7655,7698]},{"content":"This step is required only for one-box environments.","pos":[7699,7751]},{"content":"Because you're removing the need for encryption certificate rotations, old data in encrypted fields in your database will no longer be readable.","pos":[7752,7896]},{"content":"This is a technical limitation for a one-box data upgrade.","pos":[7897,7955]},{"content":"New data that goes into those fields after the upgrade is completed is unaffected.","pos":[7956,8038]},{"content":"For details about the affected fields, see the <bpt id=\"p1\">[</bpt>\"Encrypted fields in demo data\"<ept id=\"p1\">](#encrypted-fields-in-demo-data)</ept> section later in this topic.","pos":[8039,8180],"source":" For details about the affected fields, see the [\"Encrypted fields in demo data\"](#encrypted-fields-in-demo-data) section later in this topic."},{"content":"Run the Windows PowerShell Integrated Scripting Environment (ISE) as an administrator.","pos":[8693,8779]},{"content":"Open C:<ph id=\"ph1\">\\\\</ph>Temp<ph id=\"ph2\">\\\\</ph>DataUpgrade<ph id=\"ph3\">\\\\</ph>RotateConfigData<ph id=\"ph4\">\\\\</ph>Scripts<ph id=\"ph5\">\\\\</ph>EncryptRotationConfigData.ps1.","pos":[8784,8869],"source":"Open C:\\\\Temp\\\\DataUpgrade\\\\RotateConfigData\\\\Scripts\\\\EncryptRotationConfigData.ps1."},{"content":"Press F5 to run the script.","pos":[8874,8901]},{"pos":[8907,8963],"content":"Fix the duplicate key issue (February 2016 release only)","linkify":"Fix the duplicate key issue (February 2016 release only)","nodes":[{"content":"Fix the duplicate key issue (February 2016 release only)","pos":[0,56]}]},{"content":"This step is required if you're upgrading a database from the February 2016 release (also known as RTW).","pos":[8965,9069]},{"content":"Open the following file in a text editor: C:<ph id=\"ph1\">\\\\</ph>Temp<ph id=\"ph2\">\\\\</ph>DataUpgrade<ph id=\"ph3\">\\\\</ph>AOSService<ph id=\"ph4\">\\\\</ph>Scripts<ph id=\"ph5\">\\\\</ph>AutoDataUpgradePreReqs.ps1.","pos":[9075,9188],"source":"Open the following file in a text editor: C:\\\\Temp\\\\DataUpgrade\\\\AOSService\\\\Scripts\\\\AutoDataUpgradePreReqs.ps1."},{"content":"Comment out or remove the following line.","pos":[9193,9234]},{"content":"Save the file.","pos":[9287,9301]},{"pos":[9306,9326],"content":"Upgrade the database","linkify":"Upgrade the database","nodes":[{"content":"Upgrade the database","pos":[0,20]}]},{"content":"Install the deployable package from the C:<ph id=\"ph1\">\\\\</ph>Temp<ph id=\"ph2\">\\\\</ph>DataUpgrade folder (the location that you extracted to earlier).","pos":[9331,9445],"source":"Install the deployable package from the C:\\\\Temp\\\\DataUpgrade folder (the location that you extracted to earlier)."},{"content":"Use the instructions in <bpt id=\"p1\">[</bpt>Install a deployable package<ept id=\"p1\">](../deployment/install-deployable-package.md)</ept>.","pos":[9446,9546],"source":" Use the instructions in [Install a deployable package](../deployment/install-deployable-package.md)."},{"content":"Restore a backup of the source database to your one-box demo or development environment that is already running the latest Finance and Operations update that you want to upgrade to.","pos":[9551,9732]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> For better upload/download speed between Azure virtual machines (VMs), we recommend that you use AzCopy.","pos":[9733,9847],"source":"**Note:** For better upload/download speed between Azure virtual machines (VMs), we recommend that you use AzCopy."},{"content":"For details about how to download and use AzCopy to copy to or from an Azure blob store, see <bpt id=\"p1\">[</bpt>Transfer data with the AzCopy Command-Line Utility<ept id=\"p1\">](https://azure.microsoft.com/en-us/documentation/articles/storage-use-azcopy/)</ept>.","pos":[9848,10072],"source":" For details about how to download and use AzCopy to copy to or from an Azure blob store, see [Transfer data with the AzCopy Command-Line Utility](https://azure.microsoft.com/en-us/documentation/articles/storage-use-azcopy/)."},{"content":"Run the runbook file until Step 4: GlobalBackup.","pos":[10077,10125]},{"content":"Rename the existing Update 1 database, and replace it with the source database that you want to upgrade.","pos":[10130,10234]},{"content":"Create a backup of the source database, in case you need to revert to it, because the following steps will modify the source database.","pos":[10423,10557]},{"content":"Mark step 4 of the runbook as completed, and continue to run the runbook until it's completed.","pos":[10562,10656]},{"pos":[10659,10669],"content":"<bpt id=\"p1\">**</bpt>Notes:<ept id=\"p1\">**</ept>","source":"**Notes:**"},{"content":"The steps after step 4 of the runbook run the upgrade scripts.","pos":[10678,10740]},{"content":"If there is data in any staging tables that is used by data management, this step fails, and you receive the following error message.","pos":[10749,10882]},{"content":"Staging tables should be empty in order to proceed with the data upgrade.","pos":[10894,10967]},{"content":"Please run the DeleteScriptForStagingTables.sql by carefully reviewing the script in order to remove the data from the staging tables.","pos":[10968,11102]},{"content":"In this case, run DeleteScriptForStagingTables.sql to clean up the staging tables.","pos":[11112,11194]},{"content":"You can find this script under AOSServiceScripts in your data upgrade folder.","pos":[11195,11272]},{"content":"After the script has finished running, re-run this step.","pos":[11273,11329]},{"pos":[11334,11363],"content":"Re-enable SQL change tracking","linkify":"Re-enable SQL change tracking","nodes":[{"content":"Re-enable SQL change tracking","pos":[0,29]}]},{"content":"Execute the following SQL against the upgraded database to ensure that change tracking is enabled at the database level.","pos":[11364,11484]},{"content":"You must insert the name of your database within the alter database command.","pos":[11485,11561]},{"pos":[11688,11728],"content":"Additional steps for Management Reporter","linkify":"Additional steps for Management Reporter","nodes":[{"content":"Additional steps for Management Reporter","pos":[0,40]}]},{"pos":[11730,12021],"content":"Reset the management reporter database by following the steps in this topic <bpt id=\"p1\">[</bpt>Resetting the financial reporting data mart after restoring a database<ept id=\"p1\">](../analytics/reset-financial-reporting-datamart-after-restore.md)</ept> and then reimport the building block groups you exported in an earlier step.","source":"Reset the management reporter database by following the steps in this topic [Resetting the financial reporting data mart after restoring a database](../analytics/reset-financial-reporting-datamart-after-restore.md) and then reimport the building block groups you exported in an earlier step."},{"pos":[12026,12060],"content":"Troubleshoot upgrade script errors","linkify":"Troubleshoot upgrade script errors","nodes":[{"content":"Troubleshoot upgrade script errors","pos":[0,34]}]},{"pos":[12065,12126],"content":"How to re-run the runbook after a data upgrade script failure","linkify":"How to re-run the runbook after a data upgrade script failure","nodes":[{"content":"How to re-run the runbook after a data upgrade script failure","pos":[0,61]}]},{"content":"A data upgrade deployable package allows more granular re-running than a typical deployable package.","pos":[12128,12228]},{"content":"The step at which the data upgrade scripts begin executing is Step 5.","pos":[12229,12298]},{"content":"If you experience a failure during Step 5, check the output in the command window to identify which sub-step you reached.","pos":[12299,12420]},{"content":"For example it may be 5.3, the issue the command follows to re-run from that sub-step.","pos":[12421,12507]},{"content":"This is to allow you to keep re-running a particular failing script during debugging, without having to re-run the entire data upgrade piece (including database synchronization).","pos":[12508,12686]},{"pos":[12761,12805],"content":"How to view more detail about a script error","linkify":"How to view more detail about a script error","nodes":[{"content":"How to view more detail about a script error","pos":[0,44]}]},{"content":"Upgrade scripts are running in X++ using a batch process that the runbook installer is starting.","pos":[12807,12903]},{"content":"There are classes you can view in the Application Explorer in Visual Studio, they are prefixed with <bpt id=\"p1\">*</bpt>ReleaseUpdate<ept id=\"p1\">*</ept>.","pos":[12904,13020],"source":" There are classes you can view in the Application Explorer in Visual Studio, they are prefixed with *ReleaseUpdate*."},{"content":"If an upgrade script fails during the runbook process you can discover more detail about the reason for the error by opening SQL Management Studio and querying the ReleaseUpdateScriptsErrorLog as follows.","pos":[13021,13225]},{"content":"It is possible to take that code, add it to a new runnable class in Visual Studio, and directly observe, debug, and rework it’s behavior.","pos":[13276,13413]},{"pos":[13419,13445],"content":"How to skip failed scripts","linkify":"How to skip failed scripts","nodes":[{"content":"How to skip failed scripts","pos":[0,26]}]},{"pos":[13449,13531],"content":"[!IMPORTANT]\nThis process is only designed to be used in a development scenario.","leadings":["","> "],"nodes":[{"content":"This process is only designed to be used in a development scenario.","pos":[13,80]}]},{"content":"Skipping failed scripts is an aid to the troubleshooting process and lets you skip all scripts that have failed a certain number of times and move to the next viable scripts.","pos":[13534,13708]},{"content":"The process is intentionally very manual, to reduce the likelihood that you skip scripts without realizing that they were skipped.","pos":[13709,13839]},{"content":"In the table <bpt id=\"p1\">**</bpt>ReleaseUpdateConfiguration<ept id=\"p1\">**</ept> there is a new field called <bpt id=\"p2\">**</bpt>ScriptRetryCount<ept id=\"p2\">**</ept>.","pos":[13842,13935],"source":"In the table **ReleaseUpdateConfiguration** there is a new field called **ScriptRetryCount**."},{"content":"The value in this field controls how many times the runbook process will re-run a script before it ignores it.","pos":[13936,14046]},{"content":"When the runbook executes, the system updates the field ReleaseUpdateScriptsErrorLog.ErrorCount each time a specific script fails (creating a new row for each distinct script).","pos":[14047,14223]},{"content":"In the DataUpgrade package folder, under ..<ph id=\"ph1\">\\\\</ph>AosServices<ph id=\"ph2\">\\\\</ph>Scripts<ph id=\"ph3\">\\\\</ph> is a script named IgnoreBlockingScripts.ps1.","pos":[14224,14337],"source":" \nIn the DataUpgrade package folder, under ..\\\\AosServices\\\\Scripts\\\\ is a script named IgnoreBlockingScripts.ps1."},{"content":"Execute this from an Administrator PowerShell window to skip all scripts where the ScriptRetryCount=ErrorCount.","pos":[14338,14449]},{"content":"Then re-run the failed runbook step so that scripts will be ignored.","pos":[14450,14519],"source":" \nThen re-run the failed runbook step so that scripts will be ignored."},{"content":"The field <bpt id=\"p1\">**</bpt>ReleaseUpdateScriptsErrorLog.Ignored<ept id=\"p1\">**</ept> will also be set for each skipped script so that they can be identified later.","pos":[14520,14649],"source":" The field **ReleaseUpdateScriptsErrorLog.Ignored** will also be set for each skipped script so that they can be identified later."},{"pos":[14655,14698],"content":"How to monitor duration of executed scripts","linkify":"How to monitor duration of executed scripts","nodes":[{"content":"How to monitor duration of executed scripts","pos":[0,43]}]},{"content":"Each successfully executed script records the amount of time that it took to process (in minutes) in the <bpt id=\"p1\">**</bpt>ReleaseUpdateScriptsLog.DurationMins<ept id=\"p1\">**</ept> column.","pos":[14700,14853],"source":"Each successfully executed script records the amount of time that it took to process (in minutes) in the **ReleaseUpdateScriptsLog.DurationMins** column."},{"content":"This is intended as a simple way to identify the longest running scripts when working on performance tuning the data upgrade process.","pos":[14854,14987]},{"content":"It is important to understand that the timing is the duration each script takes to run, however multiple scripts will run in parallel, so the sum of the <bpt id=\"p1\">**</bpt>DurationMins<ept id=\"p1\">**</ept> column is greater than the overall duration of the upgrade process.","pos":[14988,15225],"source":" It is important to understand that the timing is the duration each script takes to run, however multiple scripts will run in parallel, so the sum of the **DurationMins** column is greater than the overall duration of the upgrade process."},{"pos":[15230,15242],"content":"Known issues","linkify":"Known issues","nodes":[{"content":"Known issues","pos":[0,12]}]},{"pos":[15247,15310],"content":"Duplicate key was found for the object name 'dbo.RESOURCESETUP'","linkify":"Duplicate key was found for the object name 'dbo.RESOURCESETUP'","nodes":[{"content":"Duplicate key was found for the object name 'dbo.RESOURCESETUP'","pos":[0,63]}]},{"content":"When upgrading a database, you may experience the following error during the database synchronize phase of the runbook process.","pos":[15312,15439]},{"content":"Database execution failed: The CREATE UNIQUE INDEX statement terminated because a duplicate key was found for the object name 'dbo.RESOURCESETUP' and the index name 'I_6716AK'","pos":[15443,15618]},{"content":"This is a known issue that will be resolved in a future hotfix.","pos":[15621,15684]},{"content":"The workaround is to delete the duplicate rows from this table by executing the following SQL script against the database from SQL Server Management Studio.","pos":[15685,15841]},{"pos":[16134,16218],"content":"Cannot select a record in Dimension hierarchy nodes (CAMDataDimensionHierarchyNode).","linkify":"Cannot select a record in Dimension hierarchy nodes (CAMDataDimensionHierarchyNode).","nodes":[{"content":"Cannot select a record in Dimension hierarchy nodes (CAMDataDimensionHierarchyNode).","pos":[0,84]}]},{"content":"When upgrading a database, you may experience the following error during the database synchronize phase of the runbook process.","pos":[16220,16347]},{"content":"Cannot select a record in Dimension hierarchy nodes (CAMDataDimensionHierarchyNode).","pos":[16352,16436]},{"content":"Dimension hierarchy: 0.","pos":[16437,16460]},{"content":"The SQL database has issued an error.","pos":[16461,16498]},{"content":"Object Server DynamicsAXBatchManagement:  [Microsoft][ODBC Driver 13 for SQL Server][SQL Server]Invalid column name 'RELATIONTYPE'.","pos":[16499,16630]},{"content":"This is a known issue that will be resolved in a future release.","pos":[16634,16698]},{"content":"The workaround is to create a missing field in several tables by executing the following SQL script against the database from SQL Server Management Studio.","pos":[16699,16854]},{"pos":[19871,19915],"content":"Cannot create index on InventDistinctProduct","linkify":"Cannot create index on InventDistinctProduct","nodes":[{"content":"Cannot create index on InventDistinctProduct","pos":[0,44]}]},{"content":"When upgrading a database, you may experience the following error during the database synchronize phase of the runbook process.","pos":[19917,20044]},{"content":"Cannot create index on InventDistinctProduct a duplicate key exists on column Product.","pos":[20048,20134]},{"content":"This is a known issue that will be resolved in a future release.","pos":[20137,20201]},{"content":"The workaround is to delete all records in the <bpt id=\"p1\">**</bpt>InventDistinctProduct<ept id=\"p1\">**</ept> table and then resume the runbook from the current step.","pos":[20202,20331],"source":" The workaround is to delete all records in the **InventDistinctProduct** table and then resume the runbook from the current step."},{"content":"The records contained in this table are disposable and will be regenerated either the first time Microsoft Dynamics 365 for Finance and Operations is launched, when an item is created, or when MRP is run.","pos":[20332,20536]},{"content":"To drop all records in <bpt id=\"p1\">**</bpt>InventDistinctProduct<ept id=\"p1\">**</ept>, execute the following query against the current database from SQL Management Studio.","pos":[20537,20671],"source":" To drop all records in **InventDistinctProduct**, execute the following query against the current database from SQL Management Studio."},{"content":"To resume the runbook from the current operation, use the following command.","pos":[20715,20791]},{"content":"For example, you can use this command.","pos":[20889,20927]},{"pos":[21002,21059],"content":"An exchange rate cannot be found when upgrading demo data","linkify":"An exchange rate cannot be found when upgrading demo data","nodes":[{"content":"An exchange rate cannot be found when upgrading demo data","pos":[0,57]}]},{"content":"When upgrading a demo database, you may receive the following error when deploying the DataUpgrade package.","pos":[21061,21168]},{"content":"An exchange rate cannot be found for exchange rate type Default between currencies INR and BRL on exchange date 12/1/2014.","pos":[21172,21294]},{"pos":[21296,21541],"content":"As you're upgrading demo data, look in table <bpt id=\"p1\">**</bpt>TrvUnreconciledExpenseTransaction<ept id=\"p1\">**</ept>, which is where the offending expense line is, and change the currency to USD (because it's demo data, we don't need to be careful to preserve this expense line).","source":"As you're upgrading demo data, look in table **TrvUnreconciledExpenseTransaction**, which is where the offending expense line is, and change the currency to USD (because it's demo data, we don't need to be careful to preserve this expense line)."},{"content":"Alternatively, you can go to the original environment the data came from (such as the old version) and add the missing exchange rate in <bpt id=\"p1\">**</bpt>General Ledger<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Currencies<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Currency exchange rates<ept id=\"p3\">**</ept>.","pos":[21671,21879],"source":"Alternatively, you can go to the original environment the data came from (such as the old version) and add the missing exchange rate in **General Ledger** &gt; **Currencies** &gt; **Currency exchange rates**."},{"content":"You need to add a record for INR and BRL that covers 2014, then take that database and bring it into your new environment and start the upgrade against that database.","pos":[21880,22046]},{"pos":[22052,22129],"content":"Error: The interpreter evaluation stack has grown during a call to the kernel","linkify":"Error: The interpreter evaluation stack has grown during a call to the kernel","nodes":[{"content":"Error: The interpreter evaluation stack has grown during a call to the kernel","pos":[0,77]}]},{"content":"This error can occur if you have enabled database logging on a kernel table such as UserInfo.","pos":[22131,22224]},{"content":"The solution is to review the database log setup in <bpt id=\"p1\">**</bpt>System administration<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Setup<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Database log setup<ept id=\"p3\">**</ept> and remove records for kernel tables as necessary.","pos":[22225,22396],"source":" The solution is to review the database log setup in **System administration** &gt; **Setup** &gt; **Database log setup** and remove records for kernel tables as necessary."},{"content":"The full error is as follows.","pos":[22397,22426]},{"pos":[22806,22838],"content":"The batch process fails to start","linkify":"The batch process fails to start","nodes":[{"content":"The batch process fails to start","pos":[0,32]}]},{"content":"The batch process can fail if the environment has been left in <bpt id=\"p1\">[</bpt>maintenance mode<ept id=\"p1\">](../sysadmin/maintenance-mode.md)</ept> following a change to configuration keys.","pos":[22840,22996],"source":"The batch process can fail if the environment has been left in [maintenance mode](../sysadmin/maintenance-mode.md) following a change to configuration keys."},{"content":"To resolve, turn maintenance mode off and resume the runbook process.","pos":[22997,23066]},{"pos":[23072,23122],"content":"The system fails to locate or generate a user GUID","linkify":"The system fails to locate or generate a user GUID","nodes":[{"content":"The system fails to locate or generate a user GUID","pos":[0,50]}]},{"content":"You might receive the following error message.","pos":[23124,23170]},{"content":"…Unhandled exception More Information: System failed to locate or generate a user GUID…","pos":[23174,23261]},{"content":"In this case, rerun the runbook step that failed.","pos":[23263,23312]},{"content":"You will then be able to continue.","pos":[23313,23347]},{"pos":[23353,23421],"content":"Pre-sync or post-sync errors on ReleaseUpdateDB71\\_LedgerPeriodClose","linkify":"Pre-sync or post-sync errors on ReleaseUpdateDB71\\_LedgerPeriodClose","nodes":[{"content":"Pre-sync or post-sync errors on ReleaseUpdateDB71<ph id=\"ph1\">\\_</ph>LedgerPeriodClose","pos":[0,68],"source":"Pre-sync or post-sync errors on ReleaseUpdateDB71\\_LedgerPeriodClose"}]},{"content":"You might receive one of the following error messages on either preSyncLedgerPeriodCloseTemplateTask, updateMenuItemTypeForCurrencyReval, updateLedgerPeriodCloseTemplateTask methods in the ReleaseUpdateDB71<ph id=\"ph1\">\\_</ph>LedgerPeriodClose class.","pos":[23423,23655],"source":"You might receive one of the following error messages on either preSyncLedgerPeriodCloseTemplateTask, updateMenuItemTypeForCurrencyReval, updateLedgerPeriodCloseTemplateTask methods in the ReleaseUpdateDB71\\_LedgerPeriodClose class."},{"content":"Cannot execute the required database operation.","pos":[23659,23706]},{"content":"The SQL database has issued an error.","pos":[23707,23744]},{"content":"Object Server DynamicsAXBatchManagement: <ph id=\"ph1\">\\[</ph>Microsoft<ph id=\"ph2\">\\]</ph><ph id=\"ph3\">\\[</ph>SQL Server Native Client 11.0<ph id=\"ph4\">\\]</ph><ph id=\"ph5\">\\[</ph>SQL Server<ph id=\"ph6\">\\]</ph>Invalid column name 'TEMPLATE'.","pos":[23745,23877],"source":" Object Server DynamicsAXBatchManagement: \\[Microsoft\\]\\[SQL Server Native Client 11.0\\]\\[SQL Server\\]Invalid column name 'TEMPLATE'."},{"content":"INSERT INTO LedgerPeriodCloseTemplateTaskTmp ( TEMPLATE, AREA, NAME, MENUITEM, MENUITEMTYPE, TARGETDAYSFROMPROJECTCOMPLETE, DUETIME, LEGALENTITYSELECTION, RECVERSION, PARTITION, RECID, CLOSINGROLE, LINENUM) SELECT T1.TEMPLATE, T1.AREA, T1.NAME, T1.MENUITEM, T1.MENUITEMTYPE, T1.TARGETDAYSFROMPROJECTCOMPLETE, T1.DUETIME, T1.LEGALENTITYSELECTION, T1.RECVERSION, T1.PARTITION, T1.RECID, T1.CLOSINGROLE, 0 FROM LedgerPeriodCloseTemplateTask T1 session 1013 (Admin) Microsoft.Dynamics.Ax.Xpp.ErrorException: Cannot execute the required database operation.","pos":[23878,24429]},{"content":"The SQL database has issued an error.","pos":[24430,24467]},{"content":"Cannot execute the required database operation.","pos":[24471,24518]},{"content":"The SQL database has issued an error.","pos":[24519,24556]},{"content":"Object Server DynamicsAXBatchManagement: <ph id=\"ph1\">\\[</ph>Microsoft<ph id=\"ph2\">\\]</ph><ph id=\"ph3\">\\[</ph>SQL Server Native Client 11.0<ph id=\"ph4\">\\]</ph><ph id=\"ph5\">\\[</ph>SQL Server<ph id=\"ph6\">\\]</ph>Invalid column name 'MENUITEMTYPE'.","pos":[24557,24693],"source":" Object Server DynamicsAXBatchManagement: \\[Microsoft\\]\\[SQL Server Native Client 11.0\\]\\[SQL Server\\]Invalid column name 'MENUITEMTYPE'."},{"content":"UPDATE LedgerPeriodCloseTemplateTaskTmp SET MENUITEMTYPE = 0 WHERE MENUITEMTYPE = 2 AND MENUITEM = 'LedgerExchAdj' AND PARTITION = 5637144576 session 1013 (Admin) Microsoft.Dynamics.Ax.Xpp.ErrorException: Cannot execute the required database operation.","pos":[24694,24946]},{"content":"The SQL database has issued an error.","pos":[24947,24984]},{"content":"Cannot execute the required database operation.","pos":[24988,25035]},{"content":"The SQL database has issued an error.","pos":[25036,25073]},{"content":"Object Server DynamicsAXBatchManagement: <ph id=\"ph1\">\\[</ph>Microsoft<ph id=\"ph2\">\\]</ph><ph id=\"ph3\">\\[</ph>SQL Server Native Client 11.0<ph id=\"ph4\">\\]</ph><ph id=\"ph5\">\\[</ph>SQL Server<ph id=\"ph6\">\\]</ph>Invalid column name 'TEMPLATE'.","pos":[25074,25206],"source":" Object Server DynamicsAXBatchManagement: \\[Microsoft\\]\\[SQL Server Native Client 11.0\\]\\[SQL Server\\]Invalid column name 'TEMPLATE'."},{"content":"INSERT INTO LedgerPeriodCloseTemplateTask ( TEMPLATE, AREA, NAME, MENUITEM, MENUITEMTYPE, TARGETDAYSFROMPROJECTCOMPLETE, DUETIME, LEGALENTITYSELECTION, RECVERSION, PARTITION, RECID, CLOSINGROLE, LINENUM) SELECT T1.TEMPLATE, T1.AREA, T1.NAME, T1.MENUITEM, T1.MENUITEMTYPE, T1.TARGETDAYSFROMPROJECTCOMPLETE, T1.DUETIME, T1.LEGALENTITYSELECTION, T1.RECVERSION, T1.PARTITION, T1.RECID, T1.CLOSINGROLE, T1.LINENUM FROM LedgerPeriodCloseTemplateTaskTmp T1 session 1013 (Admin)","pos":[25207,25677]},{"content":"In this case, manually drop the table <bpt id=\"p1\">**</bpt>LedgerPeriodCloseTemplateTaskTmp<ept id=\"p1\">**</ept> from the database via SQL Management Studio, and then re-run the runbook step.","pos":[25679,25832],"source":"In this case, manually drop the table **LedgerPeriodCloseTemplateTaskTmp** from the database via SQL Management Studio, and then re-run the runbook step."},{"content":"This issue will be fixed in a future hotfix.","pos":[25833,25877]},{"pos":[25883,25900],"content":"KB number 3170386","linkify":"KB number 3170386","nodes":[{"content":"KB number 3170386","pos":[0,17]}]},{"content":"If KB number 3170386 isn't installed, you will receive the following error message.","pos":[25902,25985]},{"pos":[25989,26140],"content":"<bpt id=\"p1\">*</bpt>GlobalUpdate script for service model: AOSService on machine …. Etc …. UpgradeServiceHelper::WaitForDataUpgradeToComplete(Object<ph id=\"ph1\">\\[</ph><ph id=\"ph2\">\\]</ph>… The step failed<ept id=\"p1\">*</ept>","source":"*GlobalUpdate script for service model: AOSService on machine …. Etc …. UpgradeServiceHelper::WaitForDataUpgradeToComplete(Object\\[\\]… The step failed*"},{"content":"This error is caused by a failure in the pre-sync or the post-sync substep of the data upgrade.","pos":[26142,26237]},{"content":"You can use the following steps to determine which substep failed and the details of the failure.","pos":[26238,26335]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> You can't rerun the failed runbook step until the pre-sync or post-sync substep has been manually completed and the AutoDataUpgrade.config file has been updated to skip the substeps that have already been run.","pos":[26336,26555],"source":"**Note:** You can't rerun the failed runbook step until the pre-sync or post-sync substep has been manually completed and the AutoDataUpgrade.config file has been updated to skip the substeps that have already been run."},{"content":"In File Explorer, in the …DataUpgradeAosServiceScripts folder, sort by descending order of date modified, and then look at the file at the top of the list to determine which substep failed.","pos":[26561,26750]},{"pos":[26759,26849],"content":"If the top file is named dbUpgrade<bpt id=\"p1\">*</bpt>PreSync<ept id=\"p1\">*</ept>Monitor.error.log, the pre-sync substep failed.","source":"If the top file is named dbUpgrade*PreSync*Monitor.error.log, the pre-sync substep failed."},{"pos":[26858,26950],"content":"If the top file is named dbUpgrade<bpt id=\"p1\">*</bpt>PostSync<ept id=\"p1\">*</ept>Monitor.error.log, the post-sync substep failed.","source":"If the top file is named dbUpgrade*PostSync*Monitor.error.log, the post-sync substep failed."},{"pos":[26956,27017],"content":"In Management Studio, run the following <bpt id=\"p1\">**</bpt>SELECT<ept id=\"p1\">**</ept> statement.","source":"In Management Studio, run the following **SELECT** statement."},{"content":"The second-to-last record in the result set will have the errors and call stacks for all the failures.","pos":[27063,27165]},{"pos":[27171,27181],"content":"DMF errors","linkify":"DMF errors","nodes":[{"content":"DMF errors","pos":[0,10]}]},{"content":"If you receive either of the following Data Migration Framework (DMF) errors, download Hotfix KB number 3170386, and restart the upgrade process.","pos":[27183,27328]},{"pos":[27335,27347],"content":"DMF pre-sync","linkify":"DMF pre-sync","nodes":[{"content":"DMF pre-sync","pos":[0,12]}]},{"content":"Batch error: initial.DAT.ReleaseUpdateDB70<ph id=\"ph1\">\\_</ph>DMF.updateIntegrationActivityExecutionMessageIdPreSync (Batch:AOS-F01B9F0CCC8, 9, Info, Error, ):<ph id=\"ph2\">\\[</ph><ph id=\"ph3\">\\[</ph>1<ph id=\"ph4\">\\]</ph><ph id=\"ph5\">\\[</ph>3,Cannot execute the required database operation.","pos":[27351,27550],"source":"Batch error: initial.DAT.ReleaseUpdateDB70\\_DMF.updateIntegrationActivityExecutionMessageIdPreSync (Batch:AOS-F01B9F0CCC8, 9, Info, Error, ):\\[\\[1\\]\\[3,Cannot execute the required database operation."},{"content":"The SQL database has issued an error.<ph id=\"ph1\">\\]</ph><ph id=\"ph2\">\\[</ph>3,Object Server DynamicsAXBatchManagement: <ph id=\"ph3\">\\]</ph><ph id=\"ph4\">\\[</ph>3,<ph id=\"ph5\">\\[</ph>Microsoft<ph id=\"ph6\">\\]</ph><ph id=\"ph7\">\\[</ph>SQL Server Native Client 11.0<ph id=\"ph8\">\\]</ph><ph id=\"ph9\">\\[</ph>SQL Server<ph id=\"ph10\">\\]</ph>Incorrect syntax near 'GO'.<ph id=\"ph11\">\\]</ph><ph id=\"ph12\">\\[</ph>3,","pos":[27551,27734],"source":" The SQL database has issued an error.\\]\\[3,Object Server DynamicsAXBatchManagement: \\]\\[3,\\[Microsoft\\]\\[SQL Server Native Client 11.0\\]\\[SQL Server\\]Incorrect syntax near 'GO'.\\]\\[3,"},{"pos":[27741,27754],"content":"DMF post-sync","linkify":"DMF post-sync","nodes":[{"content":"DMF post-sync","pos":[0,13]}]},{"content":"Batch error: initial.DAT.ReleaseUpdateDB70<ph id=\"ph1\">\\_</ph>DMF.updateIntegrationActivityExecutionMessageIdPostSync (Batch:AOS-F01B9F0CCC8, 9, Info, Error, ):<ph id=\"ph2\">\\[</ph><ph id=\"ph3\">\\[</ph>1<ph id=\"ph4\">\\]</ph><ph id=\"ph5\">\\[</ph>3,Cannot execute the required database operation.The SQL database has issued an error.<ph id=\"ph6\">\\]</ph><ph id=\"ph7\">\\[</ph>3,Object Server DynamicsAXBatchManagement: <ph id=\"ph8\">\\]</ph><ph id=\"ph9\">\\[</ph>3,<ph id=\"ph10\">\\[</ph>Microsoft<ph id=\"ph11\">\\]</ph><ph id=\"ph12\">\\[</ph>SQL Server Native Client 11.0<ph id=\"ph13\">\\]</ph><ph id=\"ph14\">\\[</ph>SQL Server<ph id=\"ph15\">\\]</ph>Incorrect syntax near 'GO'.<ph id=\"ph16\">\\]</ph><ph id=\"ph17\">\\[</ph>3,","pos":[27758,28141],"source":"Batch error: initial.DAT.ReleaseUpdateDB70\\_DMF.updateIntegrationActivityExecutionMessageIdPostSync (Batch:AOS-F01B9F0CCC8, 9, Info, Error, ):\\[\\[1\\]\\[3,Cannot execute the required database operation.The SQL database has issued an error.\\]\\[3,Object Server DynamicsAXBatchManagement: \\]\\[3,\\[Microsoft\\]\\[SQL Server Native Client 11.0\\]\\[SQL Server\\]Incorrect syntax near 'GO'.\\]\\[3,"},{"pos":[28146,28175],"content":"Encrypted fields in demo data","linkify":"Encrypted fields in demo data","nodes":[{"content":"Encrypted fields in demo data","pos":[0,29]}]},{"content":"After upgrade, values in encrypted fields in the database will be unreadable.","pos":[28176,28253]},{"content":"However, new values that are entered in these fields after upgrade will be readable.","pos":[28254,28338]},{"content":"This behavior occurs because of a technical limitation that is related to the certificate that is used for data encryption.","pos":[28339,28462]},{"content":"The following table shows the fields that are affected.","pos":[28463,28518]},{"content":"Table.Field","pos":[28522,28533]},{"content":"Data exists in demo data","pos":[28589,28613]},{"content":"CreditCardAccountSetup.SecureMerchantProperties","pos":[28714,28761]},{"content":"Yes","pos":[28781,28784]},{"content":"ExchangeRateProviderConfigurationDetails.Value","pos":[28810,28856]},{"content":"Yes","pos":[28877,28880]},{"content":"RetailChannelPaymentConnectorLine.SecureMerchantProperties","pos":[28906,28964]},{"content":"Yes","pos":[28973,28976]},{"content":"RetailConnDatabaseProfile.ConnectionString","pos":[29002,29044]},{"content":"Yes","pos":[29069,29072]},{"content":"RetailHardwareProfile.SecureMerchantProperties","pos":[29098,29144]},{"content":"Yes","pos":[29165,29168]},{"content":"RetailHardwareProfileMerchantInfoEntity.SecureMerchantProperties","pos":[29194,29258]},{"content":"Yes","pos":[29261,29264]},{"content":"FiscalEstablishment<ph id=\"ph1\">\\_</ph>BR.ConsumerEFDocCsc","pos":[29290,29330],"source":"FiscalEstablishment\\_BR.ConsumerEFDocCsc"},{"content":"No","pos":[29357,29359]},{"content":"FiscalEstablishmentEntity.CSC","pos":[29386,29415]},{"content":"No","pos":[29453,29455]},{"content":"FiscalEstablishmentStaging.CSC","pos":[29482,29512]},{"content":"No","pos":[29549,29551]},{"content":"HcmPersonIdentificationNumber.PersonIdentificationNumber","pos":[29578,29634]},{"content":"No","pos":[29645,29647]},{"content":"HcmWorkerActionHire.PersonIdentificationNumber","pos":[29674,29720]},{"content":"No","pos":[29741,29743]},{"content":"SysEmailSMPTPassword.Password","pos":[29770,29799]},{"content":"No","pos":[29837,29839]},{"content":"SysOAuthUserTokens.EncryptedAccessToken","pos":[29866,29905]},{"content":"No","pos":[29933,29935]},{"content":"SysOAuthUserTokens.EncryptedRefreshToken","pos":[29962,30002]},{"content":"No","pos":[30029,30031]},{"pos":[30059,30067],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[30078,30198],"content":"<bpt id=\"p1\">[</bpt>Overview of moving to the latest update of Microsoft Dynamics 365 for Finance and Operations<ept id=\"p1\">](upgrade-latest-update.md)</ept>","source":"[Overview of moving to the latest update of Microsoft Dynamics 365 for Finance and Operations](upgrade-latest-update.md)"}]}