{"content":"---\n# required metadata\n\ntitle: Lookup controls\ndescription: This article discusses how to enable lookup behavior on controls. It also discusses how to create multi-select lookups and outlines lookup scenarios that are no longer supported.\nauthor: jasongre\nmanager: AnnBe\nms.date: 06/20/2017\nms.topic: article\nms.prod: \nms.service: dynamics-ax-platform\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \nms.reviewer: robinr\nms.search.scope: AX 7.0.0, Operations, UnifiedOperations\n# ms.tgt_pltfrm: \nms.custom: 17464\nms.assetid: 1c71ebac-47c3-4c7e-bb48-a1c45619c95e\nms.search.region: Global\n# ms.search.industry: \nms.author: jasongre\nms.search.validFrom: 2016-02-28\nms.dyn365.ops.version: AX 7.0.0\n\n---\n\n# Lookup controls\n\n[!include[banner](../includes/banner.md)]\n\n\nThis article discusses how to enable lookup behavior on controls. It also discusses how to create multi-select lookups and outlines lookup scenarios that are no longer supported.\n\nEnabling lookup behavior in controls\n------------------------------------\n\n### Controls bound to an Extended Data Type\n\nControls with their Extended Data Type property set (no FormDataSource in play) will have a lookup under the following conditions:\n\n1.  If the EDT has its Table Relations or Table References node populated.\n2.  If the FormHelp property is set (custom lookup); doesn’t require rule \\#1 to be true.\n3.  If the control has lookup or lookupReference overridden. Note, this rule also applies to fully unbound controls (no EDT, field, or data method). This includes overrides via registerOverrideMethod and others.\n\n### Controls bound to a form data source\n\nControls that are bound to a data source will have a lookup under the following conditions: **Field bound**\n\n1.  “lookup” or “lookupReference” (Reference Controls) methods are overridden.\n    1.  If the FormDataSource field has lookup or lookupReference overridden.\n    2.  If the control has lookup or lookupReference overridden.\n        -   This includes overrides via registerOverrideMethod and others.\n\n2.  If the field has an EDT, then rule \\#2 from the \"Controls bound to an Extended Data Type\" section applies.\n3.  If the bound field maps to a relation per DBFGetRef rules.\n    1.  High level rules:\n        1.  If there is an EDT relation backing the field, with the Table Relations node populated and Ignore EDT Relations is false on the field, the relation is used (has a lookup).\n        2.  If there is a relation mapping to the field and any fixed field link conditions are satisfied, the relation is used (has a lookup).\n            1.  Validate must be “Yes”.\n\n        3.  Note the special case of migrated EDT relations which occur when:\n            1.  Field is backed by an EDT with the Relations node populated.\n            2.  Field is backed by a TABLE relation with the “EDTRelation” set to Yes.\n            3.  The table relation link has the SourceEDT set to the appropriate EDT.\n\n        4.  You can also have cases where IgnoreEDTRelation is set to true on a field, in which case a lookup will occur only if rule \\#3.1.2 of this section is true.\n\n**Data method bound**\n\n1.  If the return type of the data method is an EDT, then rules \\#1 and \\#2 from the \"Controls bound to an Extended Data Type\" section apply.\n2.  If the control has lookup or lookupReference overridden.\n    -   This includes overrides by using registerOverrideMethod.\n\n## Multiselect lookups\n### Available system forms for building multi-select lookups\n\nThere are currently two system forms for creating multi-select lookups:\n\n-   SysLookup – Multiselect based on an Enum.\n-   SysLookupMultiselectGrid – Multiselect based on a collection of data.\n\n### What happened to the SysLookupMultiselect form?\n\nSysLookupMultiselect was marked for deprecation in Microsoft Dynamics AX 2012 and has been removed. Any use of this form for multiselect lookup scenarios should be migrated to use SysLookupMultiselectGrid. For an example, see the form tutorial\\_LookupMultiSelectGrid.\n\n## Unsupported lookup scenarios\n### Creating multiple lookup forms when the lookup button is used\n\nAn error may occur if you create multiple lookup forms when the lookup button is used. For example, overriding the ‘lookup’ method and creating a new lookup form, but also calling ‘super’ (which will create another lookup form).\n\n### Using SelectedControl() to determine which control is hosting a lookup\n\nUsing SelectedControl() to determine which control is hosting a lookup is unsupported. While it may work in some cases, it will fail in others. For example, in disambiguation lookups, no control is selected on the parent form since the act of leaving the control is what triggers a disambiguation lookup. As an alternative to using SelectedControl(), there are a few other ways to retrieve the control that is hosting the lookup:\n-   Check the ‘selectTarget’ of the lookup form.\n\n        FormStringControl selectTarget = formRun.selectTarget();\n\n-   Check the ‘callerFormControl’ on the lookup form args. Note that SysTableLookup::getCallerControl(Args args) encapsulates that call.\n\n        FormStringControl argsCallerFormControl = args.callerFormControl();\n\nNote that the selectTarget and callerFormControl will be set automatically if the lookup form instance is spun up automatically by the kernel. If the form instance is created in app code, these can be set manually as shown below.\n    public void lookup()\n    {\n        Args args = new Args(formStr(<formName>));\n        args.caller(element);\n        args.callerFormControl(this);\n        FormRun formRun = classfactory.formRunClass(args);\n        formRun.init();\n        this.performFormLookup(formRun);\n    }\n\n### Creating a slider dialog (instead of a lookup form) when the lookup button is used\n\nLookup controls should open lookup forms when the lookup button is used (not slider dialogs or other kinds of forms).  The first reason for this is product consistency. The second and more important reason is that opening a slider dialog from a lookup is incompatible with the new type-ahead feature in lookups.\n\n\n\n","nodes":[{"pos":[4,749],"embed":true,"restype":"x-metadata","content":"# required metadata\n\ntitle: Lookup controls\ndescription: This article discusses how to enable lookup behavior on controls. It also discusses how to create multi-select lookups and outlines lookup scenarios that are no longer supported.\nauthor: jasongre\nmanager: AnnBe\nms.date: 06/20/2017\nms.topic: article\nms.prod: \nms.service: dynamics-ax-platform\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \nms.reviewer: robinr\nms.search.scope: AX 7.0.0, Operations, UnifiedOperations\n# ms.tgt_pltfrm: \nms.custom: 17464\nms.assetid: 1c71ebac-47c3-4c7e-bb48-a1c45619c95e\nms.search.region: Global\n# ms.search.industry: \nms.author: jasongre\nms.search.validFrom: 2016-02-28\nms.dyn365.ops.version: AX 7.0.0\n","nodes":[{"content":"Lookup controls","nodes":[{"pos":[0,15],"content":"Lookup controls","nodes":[{"content":"Lookup controls","pos":[0,15]}]}],"path":["title"],"extradata":"MT"},{"content":"This article discusses how to enable lookup behavior on controls. It also discusses how to create multi-select lookups and outlines lookup scenarios that are no longer supported.","nodes":[{"pos":[0,178],"content":"This article discusses how to enable lookup behavior on controls. It also discusses how to create multi-select lookups and outlines lookup scenarios that are no longer supported.","nodes":[{"content":"This article discusses how to enable lookup behavior on controls. It also discusses how to create multi-select lookups and outlines lookup scenarios that are no longer supported.","pos":[0,178],"nodes":[{"content":"This article discusses how to enable lookup behavior on controls.","pos":[0,65]},{"content":"It also discusses how to create multi-select lookups and outlines lookup scenarios that are no longer supported.","pos":[66,178]}]}]}],"path":["description"],"extradata":"MT"}],"header":"# required metadata\n","yml":true},{"pos":[757,772],"content":"Lookup controls","linkify":"Lookup controls","nodes":[{"content":"Lookup controls","pos":[0,15]}]},{"content":"This article discusses how to enable lookup behavior on controls.","pos":[818,883]},{"content":"It also discusses how to create multi-select lookups and outlines lookup scenarios that are no longer supported.","pos":[884,996]},{"pos":[998,1034],"content":"Enabling lookup behavior in controls","linkify":"Enabling lookup behavior in controls","nodes":[{"content":"Enabling lookup behavior in controls","pos":[0,36]}]},{"pos":[1077,1116],"content":"Controls bound to an Extended Data Type","linkify":"Controls bound to an Extended Data Type","nodes":[{"content":"Controls bound to an Extended Data Type","pos":[0,39]}]},{"content":"Controls with their Extended Data Type property set (no FormDataSource in play) will have a lookup under the following conditions:","pos":[1118,1248]},{"content":"If the EDT has its Table Relations or Table References node populated.","pos":[1254,1324]},{"content":"If the FormHelp property is set (custom lookup); doesn’t require rule <ph id=\"ph1\">\\#</ph>1 to be true.","pos":[1329,1414],"source":"If the FormHelp property is set (custom lookup); doesn’t require rule \\#1 to be true."},{"content":"If the control has lookup or lookupReference overridden.","pos":[1419,1475]},{"content":"Note, this rule also applies to fully unbound controls (no EDT, field, or data method).","pos":[1476,1563]},{"content":"This includes overrides via registerOverrideMethod and others.","pos":[1564,1626]},{"pos":[1632,1668],"content":"Controls bound to a form data source","linkify":"Controls bound to a form data source","nodes":[{"content":"Controls bound to a form data source","pos":[0,36]}]},{"pos":[1670,1777],"content":"Controls that are bound to a data source will have a lookup under the following conditions: <bpt id=\"p1\">**</bpt>Field bound<ept id=\"p1\">**</ept>","source":"Controls that are bound to a data source will have a lookup under the following conditions: **Field bound**"},{"content":"“lookup” or “lookupReference” (Reference Controls) methods are overridden.","pos":[1783,1857]},{"content":"If the FormDataSource field has lookup or lookupReference overridden.","pos":[1866,1935]},{"content":"If the control has lookup or lookupReference overridden.","pos":[1944,2000]},{"content":"This includes overrides via registerOverrideMethod and others.","pos":[2013,2075]},{"content":"If the field has an EDT, then rule <ph id=\"ph1\">\\#</ph>2 from the \"Controls bound to an Extended Data Type\" section applies.","pos":[2081,2187],"source":"If the field has an EDT, then rule \\#2 from the \"Controls bound to an Extended Data Type\" section applies."},{"content":"If the bound field maps to a relation per DBFGetRef rules.","pos":[2192,2250]},{"content":"High level rules:","pos":[2259,2276]},{"content":"If there is an EDT relation backing the field, with the Table Relations node populated and Ignore EDT Relations is false on the field, the relation is used (has a lookup).","pos":[2289,2460]},{"content":"If there is a relation mapping to the field and any fixed field link conditions are satisfied, the relation is used (has a lookup).","pos":[2473,2604]},{"content":"Validate must be “Yes”.","pos":[2621,2644]},{"content":"Note the special case of migrated EDT relations which occur when:","pos":[2658,2723]},{"content":"Field is backed by an EDT with the Relations node populated.","pos":[2740,2800]},{"content":"Field is backed by a TABLE relation with the “EDTRelation” set to Yes.","pos":[2817,2887]},{"content":"The table relation link has the SourceEDT set to the appropriate EDT.","pos":[2904,2973]},{"content":"You can also have cases where IgnoreEDTRelation is set to true on a field, in which case a lookup will occur only if rule <ph id=\"ph1\">\\#</ph>3.1.2 of this section is true.","pos":[2987,3141],"source":"You can also have cases where IgnoreEDTRelation is set to true on a field, in which case a lookup will occur only if rule \\#3.1.2 of this section is true."},{"pos":[3143,3164],"content":"<bpt id=\"p1\">**</bpt>Data method bound<ept id=\"p1\">**</ept>","source":"**Data method bound**"},{"content":"If the return type of the data method is an EDT, then rules <ph id=\"ph1\">\\#</ph>1 and <ph id=\"ph2\">\\#</ph>2 from the \"Controls bound to an Extended Data Type\" section apply.","pos":[3170,3307],"source":"If the return type of the data method is an EDT, then rules \\#1 and \\#2 from the \"Controls bound to an Extended Data Type\" section apply."},{"content":"If the control has lookup or lookupReference overridden.","pos":[3312,3368]},{"content":"This includes overrides by using registerOverrideMethod.","pos":[3377,3433]},{"pos":[3438,3457],"content":"Multiselect lookups","linkify":"Multiselect lookups","nodes":[{"content":"Multiselect lookups","pos":[0,19]}]},{"pos":[3462,3518],"content":"Available system forms for building multi-select lookups","linkify":"Available system forms for building multi-select lookups","nodes":[{"content":"Available system forms for building multi-select lookups","pos":[0,56]}]},{"content":"There are currently two system forms for creating multi-select lookups:","pos":[3520,3591]},{"content":"SysLookup – Multiselect based on an Enum.","pos":[3597,3638]},{"content":"SysLookupMultiselectGrid – Multiselect based on a collection of data.","pos":[3643,3712]},{"pos":[3718,3765],"content":"What happened to the SysLookupMultiselect form?","linkify":"What happened to the SysLookupMultiselect form?","nodes":[{"content":"What happened to the SysLookupMultiselect form?","pos":[0,47]}]},{"content":"SysLookupMultiselect was marked for deprecation in Microsoft Dynamics AX 2012 and has been removed.","pos":[3767,3866]},{"content":"Any use of this form for multiselect lookup scenarios should be migrated to use SysLookupMultiselectGrid.","pos":[3867,3972]},{"content":"For an example, see the form tutorial<ph id=\"ph1\">\\_</ph>LookupMultiSelectGrid.","pos":[3973,4034],"source":" For an example, see the form tutorial\\_LookupMultiSelectGrid."},{"pos":[4039,4067],"content":"Unsupported lookup scenarios","linkify":"Unsupported lookup scenarios","nodes":[{"content":"Unsupported lookup scenarios","pos":[0,28]}]},{"pos":[4072,4133],"content":"Creating multiple lookup forms when the lookup button is used","linkify":"Creating multiple lookup forms when the lookup button is used","nodes":[{"content":"Creating multiple lookup forms when the lookup button is used","pos":[0,61]}]},{"content":"An error may occur if you create multiple lookup forms when the lookup button is used.","pos":[4135,4221]},{"content":"For example, overriding the ‘lookup’ method and creating a new lookup form, but also calling ‘super’ (which will create another lookup form).","pos":[4222,4363]},{"pos":[4369,4439],"content":"Using SelectedControl() to determine which control is hosting a lookup","linkify":"Using SelectedControl() to determine which control is hosting a lookup","nodes":[{"content":"Using SelectedControl() to determine which control is hosting a lookup","pos":[0,70]}]},{"content":"Using SelectedControl() to determine which control is hosting a lookup is unsupported.","pos":[4441,4527]},{"content":"While it may work in some cases, it will fail in others.","pos":[4528,4584]},{"content":"For example, in disambiguation lookups, no control is selected on the parent form since the act of leaving the control is what triggers a disambiguation lookup.","pos":[4585,4745]},{"content":"As an alternative to using SelectedControl(), there are a few other ways to retrieve the control that is hosting the lookup:","pos":[4746,4870]},{"content":"Check the ‘selectTarget’ of the lookup form.","pos":[4875,4919]},{"content":"Check the ‘callerFormControl’ on the lookup form args.","pos":[4991,5045]},{"content":"Note that SysTableLookup::getCallerControl(Args args) encapsulates that call.","pos":[5046,5123]},{"content":"Note that the selectTarget and callerFormControl will be set automatically if the lookup form instance is spun up automatically by the kernel.","pos":[5202,5344]},{"content":"If the form instance is created in app code, these can be set manually as shown below.","pos":[5345,5431]},{"content":"public void lookup() { Args args = new Args(formStr(<ph id=\"ph1\">&lt;formName&gt;</ph>)); args.caller(element); args.callerFormControl(this); FormRun formRun = classfactory.formRunClass(args); formRun.init(); this.performFormLookup(formRun); }","pos":[5432,5711],"source":"\n    public void lookup()\n    {\n        Args args = new Args(formStr(<formName>));\n        args.caller(element);\n        args.callerFormControl(this);\n        FormRun formRun = classfactory.formRunClass(args);\n        formRun.init();\n        this.performFormLookup(formRun);\n    }"},{"pos":[5717,5799],"content":"Creating a slider dialog (instead of a lookup form) when the lookup button is used","linkify":"Creating a slider dialog (instead of a lookup form) when the lookup button is used","nodes":[{"content":"Creating a slider dialog (instead of a lookup form) when the lookup button is used","pos":[0,82]}]},{"content":"Lookup controls should open lookup forms when the lookup button is used (not slider dialogs or other kinds of forms).","pos":[5801,5918]},{"content":"The first reason for this is product consistency.","pos":[5920,5969]},{"content":"The second and more important reason is that opening a slider dialog from a lookup is incompatible with the new type-ahead feature in lookups.","pos":[5970,6112]}]}