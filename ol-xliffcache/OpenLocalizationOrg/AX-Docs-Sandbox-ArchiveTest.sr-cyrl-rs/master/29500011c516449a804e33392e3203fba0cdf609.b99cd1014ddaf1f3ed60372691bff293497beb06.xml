{"content":"---\n# required metadata\n\ntitle: Service authentication troubleshooting\ndescription: This topic provides some tips for troubleshooting issues that involve service authentication.  \nauthor: nimakms\nmanager: AnnBe\nms.date: 06/20/2017\nms.topic: article\nms.prod: \nms.service: dynamics-ax-platform\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \nms.reviewer: robinr\nms.search.scope: AX 7.0.0, Operations, UnifiedOperations\n# ms.tgt_pltfrm: \nms.custom: 195943\nms.assetid: 0c22fad3-be0a-4111-97c0-2f3fadfd5f6b\nms.search.region: Global\n# ms.search.industry: \nms.author: nimak\nms.search.validFrom: 2016-02-28\nms.dyn365.ops.version: AX 7.0.0\n\n---\n\n# Service authentication troubleshooting\n\n[!include[banner](../includes/banner.md)]\n\n\nThis topic provides some tips for troubleshooting issues that involve service authentication.  \n\nWhen you troubleshoot service authentication issues, there are a few basic and common procedures that can help resolve the issues that are most often encountered. These procedures also provide a hands-on demonstration of how the authentication mechanism works. This topic includes instructions and also lists a few common issues that users have encountered so far.\n\n## Inspect the JWT\n### Capture the JWT from an HTTP request\n\n1.  Download Fiddler from <http://www.telerik.com/fiddler>.\n2.  Set up HTTPS capture to watch the HTTPS traffic from the client.\n3.  Find the Open Authorization (OAuth) JSON Web Token (JWT). It's the value of the HTTP \"Authorization\" header without the \"bearer\" segment.\n\n### Use a deserializer tool to look at the token contents\n\n1.  Go to <http://jwt.io>, and paste the JWT into the input panel.\n2.  View the contents in the form of name-value pairs. See the example that follows.\n3.  Verify that the following information is correct:\n    -   **\"aud\"** – The value corresponds to the Microsoft Azure Active Directory (Azure AD) resource concept. Here are some typical issues that involve \"aud\":\n        -   The **\"aud\"** segment of the JWT contains a URI that has a trailing slash.\n        -   The **\"aud\"** segment of the JWT contains a URI that uses an incorrect capitalization style. The URI must be all lowercase.\n    -   **\"appid\"** – The value corresponds to the Azure AD Native Client App ID (or Service App ID).\n    -   **\"upn\"** – The value corresponds to the user who is being authenticated through a Native Client App.\n\nThe following illustration shows an example of the contents of the JWT. [![Example of a JWT](./media/serviceauthenticationtroubleshooting01.png)](./media/serviceauthenticationtroubleshooting01.png)\n\n## Review the event logs\nYou can also look at the event logs of the instance machine, if you have access to the virtual machine (VM).\n\n1.  Start Event Viewer by running the **eventvwr** command from the **Run** window.\n2.  Go to the following channels:\n    -   Application and Services Logs &gt; Microsoft &gt; Dynamics &gt; AX-IntegrationServices &gt; Channel:Operational (Microsoft-Dynamics-AX-IntegrationServices/Operational)\n    -   Application and Services Logs &gt; Microsoft &gt; Dynamics &gt; AX-SystemRuntime &gt; Channel:Operational (Microsoft-Dynamics-AX-SystemRuntime/Operational)\n\n## Other approaches\n-   For more information about how OAuth is configured, see [Service endpoints](services-home-page.md).\n-   You can also try to call the service in parallel by using your own client code. The sample code that we published is available at <https://github.com/Microsoft/Dynamics-AX-Integration>.\n-   If the second method works, you can compare the JWTs from each method.\n\n## Known issues\n### AADSTS65001: The user or administrator hasn't consented to use the application\n\n-   The **\"aud\"** segment of the JWT might contain a URI that has a trailing slash. The slash must be removed.\n-   The **\"aud\"** segment of the JWT might contain a URI that uses an incorrect capitalization style. The URI must be all lowercase.\n\n\n\n\n","nodes":[{"pos":[4,686],"embed":true,"restype":"x-metadata","content":"# required metadata\n\ntitle: Service authentication troubleshooting\ndescription: This topic provides some tips for troubleshooting issues that involve service authentication.  \nauthor: nimakms\nmanager: AnnBe\nms.date: 06/20/2017\nms.topic: article\nms.prod: \nms.service: dynamics-ax-platform\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \nms.reviewer: robinr\nms.search.scope: AX 7.0.0, Operations, UnifiedOperations\n# ms.tgt_pltfrm: \nms.custom: 195943\nms.assetid: 0c22fad3-be0a-4111-97c0-2f3fadfd5f6b\nms.search.region: Global\n# ms.search.industry: \nms.author: nimak\nms.search.validFrom: 2016-02-28\nms.dyn365.ops.version: AX 7.0.0\n","nodes":[{"content":"Service authentication troubleshooting","nodes":[{"pos":[0,38],"content":"Service authentication troubleshooting","nodes":[{"content":"Service authentication troubleshooting","pos":[0,38]}]}],"path":["title"],"extradata":"MT"},{"content":"This topic provides some tips for troubleshooting issues that involve service authentication.","nodes":[{"pos":[0,93],"content":"This topic provides some tips for troubleshooting issues that involve service authentication.","nodes":[{"content":"This topic provides some tips for troubleshooting issues that involve service authentication.","pos":[0,93]}]}],"path":["description"],"extradata":"MT"}],"header":"# required metadata\n","yml":true},{"pos":[694,732],"content":"Service authentication troubleshooting","linkify":"Service authentication troubleshooting","nodes":[{"content":"Service authentication troubleshooting","pos":[0,38]}]},{"content":"This topic provides some tips for troubleshooting issues that involve service authentication.","pos":[778,871]},{"content":"When you troubleshoot service authentication issues, there are a few basic and common procedures that can help resolve the issues that are most often encountered.","pos":[875,1037]},{"content":"These procedures also provide a hands-on demonstration of how the authentication mechanism works.","pos":[1038,1135]},{"content":"This topic includes instructions and also lists a few common issues that users have encountered so far.","pos":[1136,1239]},{"pos":[1244,1259],"content":"Inspect the JWT","linkify":"Inspect the JWT","nodes":[{"content":"Inspect the JWT","pos":[0,15]}]},{"pos":[1264,1300],"content":"Capture the JWT from an HTTP request","linkify":"Capture the JWT from an HTTP request","nodes":[{"content":"Capture the JWT from an HTTP request","pos":[0,36]}]},{"pos":[1306,1361],"content":"Download Fiddler from <bpt id=\"p1\">&lt;</bpt>http://www.telerik.com/fiddler<ept id=\"p1\">&gt;</ept>.","source":"Download Fiddler from <http://www.telerik.com/fiddler>."},{"content":"Set up HTTPS capture to watch the HTTPS traffic from the client.","pos":[1366,1430]},{"content":"Find the Open Authorization (OAuth) JSON Web Token (JWT).","pos":[1435,1492]},{"content":"It's the value of the HTTP \"Authorization\" header without the \"bearer\" segment.","pos":[1493,1572]},{"pos":[1578,1631],"content":"Use a deserializer tool to look at the token contents","linkify":"Use a deserializer tool to look at the token contents","nodes":[{"content":"Use a deserializer tool to look at the token contents","pos":[0,53]}]},{"pos":[1637,1699],"content":"Go to <bpt id=\"p1\">&lt;</bpt>http://jwt.io<ept id=\"p1\">&gt;</ept>, and paste the JWT into the input panel.","source":"Go to <http://jwt.io>, and paste the JWT into the input panel."},{"content":"View the contents in the form of name-value pairs.","pos":[1704,1754]},{"content":"See the example that follows.","pos":[1755,1784]},{"content":"Verify that the following information is correct:","pos":[1789,1838]},{"content":"<bpt id=\"p1\">**</bpt>\"aud\"<ept id=\"p1\">**</ept> – The value corresponds to the Microsoft Azure Active Directory (Azure AD) resource concept.","pos":[1847,1949],"source":"**\"aud\"** – The value corresponds to the Microsoft Azure Active Directory (Azure AD) resource concept."},{"content":"Here are some typical issues that involve \"aud\":","pos":[1950,1998]},{"pos":[2011,2085],"content":"The <bpt id=\"p1\">**</bpt>\"aud\"<ept id=\"p1\">**</ept> segment of the JWT contains a URI that has a trailing slash.","source":"The **\"aud\"** segment of the JWT contains a URI that has a trailing slash."},{"content":"The <bpt id=\"p1\">**</bpt>\"aud\"<ept id=\"p1\">**</ept> segment of the JWT contains a URI that uses an incorrect capitalization style.","pos":[2098,2190],"source":"The **\"aud\"** segment of the JWT contains a URI that uses an incorrect capitalization style."},{"content":"The URI must be all lowercase.","pos":[2191,2221]},{"pos":[2230,2323],"content":"<bpt id=\"p1\">**</bpt>\"appid\"<ept id=\"p1\">**</ept> – The value corresponds to the Azure AD Native Client App ID (or Service App ID).","source":"**\"appid\"** – The value corresponds to the Azure AD Native Client App ID (or Service App ID)."},{"pos":[2332,2433],"content":"<bpt id=\"p1\">**</bpt>\"upn\"<ept id=\"p1\">**</ept> – The value corresponds to the user who is being authenticated through a Native Client App.","source":"**\"upn\"** – The value corresponds to the user who is being authenticated through a Native Client App."},{"content":"The following illustration shows an example of the contents of the JWT.","pos":[2435,2506]},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Example of a JWT<ept id=\"p1\">](./media/serviceauthenticationtroubleshooting01.png)](./media/serviceauthenticationtroubleshooting01.png)</ept>","pos":[2507,2632],"source":"[![Example of a JWT](./media/serviceauthenticationtroubleshooting01.png)](./media/serviceauthenticationtroubleshooting01.png)"},{"pos":[2637,2658],"content":"Review the event logs","linkify":"Review the event logs","nodes":[{"content":"Review the event logs","pos":[0,21]}]},{"content":"You can also look at the event logs of the instance machine, if you have access to the virtual machine (VM).","pos":[2659,2767]},{"pos":[2773,2852],"content":"Start Event Viewer by running the <bpt id=\"p1\">**</bpt>eventvwr<ept id=\"p1\">**</ept> command from the <bpt id=\"p2\">**</bpt>Run<ept id=\"p2\">**</ept> window.","source":"Start Event Viewer by running the **eventvwr** command from the **Run** window."},{"content":"Go to the following channels:","pos":[2857,2886]},{"content":"Application and Services Logs <ph id=\"ph1\">&amp;gt;</ph> Microsoft <ph id=\"ph2\">&amp;gt;</ph> Dynamics <ph id=\"ph3\">&amp;gt;</ph> AX-IntegrationServices <ph id=\"ph4\">&amp;gt;</ph> Channel:Operational (Microsoft-Dynamics-AX-IntegrationServices/Operational)","pos":[2895,3062],"source":"Application and Services Logs &gt; Microsoft &gt; Dynamics &gt; AX-IntegrationServices &gt; Channel:Operational (Microsoft-Dynamics-AX-IntegrationServices/Operational)"},{"content":"Application and Services Logs <ph id=\"ph1\">&amp;gt;</ph> Microsoft <ph id=\"ph2\">&amp;gt;</ph> Dynamics <ph id=\"ph3\">&amp;gt;</ph> AX-SystemRuntime <ph id=\"ph4\">&amp;gt;</ph> Channel:Operational (Microsoft-Dynamics-AX-SystemRuntime/Operational)","pos":[3071,3226],"source":"Application and Services Logs &gt; Microsoft &gt; Dynamics &gt; AX-SystemRuntime &gt; Channel:Operational (Microsoft-Dynamics-AX-SystemRuntime/Operational)"},{"pos":[3231,3247],"content":"Other approaches","linkify":"Other approaches","nodes":[{"content":"Other approaches","pos":[0,16]}]},{"pos":[3252,3351],"content":"For more information about how OAuth is configured, see <bpt id=\"p1\">[</bpt>Service endpoints<ept id=\"p1\">](services-home-page.md)</ept>.","source":"For more information about how OAuth is configured, see [Service endpoints](services-home-page.md)."},{"content":"You can also try to call the service in parallel by using your own client code.","pos":[3356,3435]},{"content":"The sample code that we published is available at <bpt id=\"p1\">&lt;</bpt>https://github.com/Microsoft/Dynamics-AX-Integration<ept id=\"p1\">&gt;</ept>.","pos":[3436,3541],"source":" The sample code that we published is available at <https://github.com/Microsoft/Dynamics-AX-Integration>."},{"content":"If the second method works, you can compare the JWTs from each method.","pos":[3546,3616]},{"pos":[3621,3633],"content":"Known issues","linkify":"Known issues","nodes":[{"content":"Known issues","pos":[0,12]}]},{"pos":[3638,3716],"content":"AADSTS65001: The user or administrator hasn't consented to use the application","linkify":"AADSTS65001: The user or administrator hasn't consented to use the application","nodes":[{"content":"AADSTS65001: The user or administrator hasn't consented to use the application","pos":[0,78]}]},{"content":"The <bpt id=\"p1\">**</bpt>\"aud\"<ept id=\"p1\">**</ept> segment of the JWT might contain a URI that has a trailing slash.","pos":[3722,3801],"source":"The **\"aud\"** segment of the JWT might contain a URI that has a trailing slash."},{"content":"The slash must be removed.","pos":[3802,3828]},{"content":"The <bpt id=\"p1\">**</bpt>\"aud\"<ept id=\"p1\">**</ept> segment of the JWT might contain a URI that uses an incorrect capitalization style.","pos":[3833,3930],"source":"The **\"aud\"** segment of the JWT might contain a URI that uses an incorrect capitalization style."},{"content":"The URI must be all lowercase.","pos":[3931,3961]}]}