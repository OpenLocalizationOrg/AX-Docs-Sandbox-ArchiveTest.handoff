{"content":"---\n# required metadata\n\ntitle: Use delegates to solve dependencies between models when migrating code\ndescription: This topic explains how delegate methods serve as a means for defining a contract between the delegate instance and the delegate handler.\nauthor: maertenm\nmanager: AnnBe\nms.date: 06/20/2017\nms.topic: article\nms.prod: \nms.service: dynamics-ax-platform\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \nms.reviewer: robinr\nms.search.scope: AX 7.0.0, Operations, UnifiedOperations\n# ms.tgt_pltfrm: \nms.custom: 27001\nms.assetid: 6640ae38-58f0-4a29-abca-5acd9489d45d\nms.search.region: Global\n# ms.search.industry: \nms.author: maertenm\nms.search.validFrom: 2016-02-28\nms.dyn365.ops.version: AX 7.0.0\n\n---\n\n# Use delegates to solve dependencies between models when migrating code\n\n[!include[banner](../includes/banner.md)]\n\n\nThis topic explains how delegate methods serve as a means for defining a contract between the delegate instance and the delegate handler.\n\nOverview\n--------\n\nMicrosoft Dynamics 365 for Finance and Operations is split into more several models, with each model in separate package. The principal 3 models are Application Platform, Application Foundation, and Application Suite (See [Models](..\\dev-tools\\models.md) to learn about models and packages). With the model split, a hierarchy has been created where a higher model can take dependencies and access elements in the models below, but not in models above. In this setup, Application Suite has full access to its elements, Application Foundation’s elements, and Application Platform’s elements. Application Foundation can access its own elements and those of Application Platform. Finally, Application Platform can only access its own elements. \n\n[![Del1](./media/del1.jpg)](./media/del1.jpg) \n\nWhile the model split provides many benefits, it creates a problem when trying to access elements defined in higher models. Delegates are the recommended method for accessing elements in higher models from a lower model. Delegates are very similar to events in that when a delegate instance is invoked, a handler with compatible signature code is executed. This permits higher layer code, the handler, to be called by lower layer code, the delegate instance.\n\n## Create delegates and handlers\nA delegate declaration must have three things:\n\n-   The delegate keyword\n-   Type void\n-   Empty method\n\nDelegate methods serve as a means for defining a contract between the delegate instance and the delegate handler. A delegate takes no action itself. This is enforced by having a void type and having no code in the method. \n\n[![1](./media/12.png)](./media/12.png) \n\nAdding the SubscribesTo keyword to a method will create a static delegate handler. SubscribesTo requires the class name of the delegate, and the string name of the delegate method. \n\n[![2](./media/21.png)](./media/21.png) \n\nIn order for a delegate to be properly handled, the delegate method declaration, the delegate instance, and the delegate handler must have the *same* method signature. For example, the delegate instance below takes two inputs, a real number and an EventHandlerResult, matching the delegate declaration and handler signatures above. \n\n[![3](./media/32.png)](./media/32.png) \n\nDue to the fact that delegates do not have a return value, an EventHandlerResult is passed as a parameter to provide access to the needed result value after the delegate has returned. This topic focuses on static delegate handlers using the SubscribesTo. The delegate functionality from Dynamics AX 2012 remains. [How to use X++ Delegates in Dynamics AX 2012](http://blogs.msdn.com/b/x/archive/2011/08/02/how-to-use-x-delegates-in-dynamics-ax-2012.aspx) is a great blog post on MSDN by Microsoft developer Marcos Calderon on delegate concepts in Dynamics AX 2012. These concepts still apply.\n\n## Example scenarios\n### Overlaying an existing delegate\n\nIn many cases where delegates are needed, the code that was formerly overlayed has already been moved to a delegate handler by Microsoft. In these instances, Microsoft created delegates that can be leveraged and the code can be overlayed in a similar manner in the delegate handler. In this scenario, an Independent Software Vendor (ISV) is migrating code from Dynamics  AX 2012 R3 where they have overlayed the showSalesTax() method in the LogisticsEntityPostalAddressFormHandler class. After migration, the CodeUpgrade project will contain the LogisticsEntityPostalAddressFormHandler with the *Your Solution*, *Microsoft AX 2012,* and *Microsoft AX* sections to resolve for the showSalesTax() method. The commented Your Solution section shows that the showSalesTax() method was overlayed by adding an additional table to approve showing sales tax from. This overlay is shown between the &lt;isv&gt; tags circled in red below. \n\n[![4](./media/41.png)](./media/41.png)\n\nWhen comparing this overlay with the code from Dynamics AX 2012, this is a simple change. The overlay has added an additional table to the switch statement. \n\n[![5](./media/51.png)](./media/51.png) \n\nHowever, the Finance and Operations section does not appear to resemble either of the Dynamics AX 2012 code snippets. \n\n[![6](./media/61.png)](./media/61.png) \n\nUpon deeper inspection, the code is calling a delegate method, showSalesTax\\_delegate(). \n\n[![this.showSalesTax\\_delegate(this.getCallerRecord().TableId, result);](./media/showsalestax_delegate.png)](./media/showsalestax_delegate.png) \n\nThe use of a delegate implies that code has been moved to another location. The showSalesTax\\_delegate() has been declared in the Application Foundation and handled in the Application Suite. To view the code that has been moved, find the delegate handler. The **Finding Delegates and Handlers** section contains methods to locate delegates and handlers. After finding the delegate handler method in the Application Suite, we see the code that has been moved from the showSalesTax() method. The same overlayered changes applied in Dynamics AX 2012 can be applied in the delegate handler. \n\n[![Finding delegates and handlers code sample](./media/findingdelegatesandhandles.png)](./media/findingdelegatesandhandles.png) \n\nAfter adding the new table to the switch statement in the delegate handler, the code will function as it did in Dynamics AX 2012. \n\n[![ShowSalesTax method code](./media/showsalestaxmethod.png)](./media/showsalestaxmethod.png)\n\n### Adding a new delegate\n\nIn this scenario, we will modify an existing tax calculation method that resides in the Application Foundation to account for discounts created in the Application Suite. The following class in the Foundation layer calculates the tax based on the gross total. \n\n[![10](./media/101.png)](./media/101.png) \n\nIn the Application Suite, we have introduced the notion of discounts by adding a ProductDiscount class that contains the current discount. \n\n[![11](./media/112.png)](./media/112.png) \n\nThe TaxCalculator class, in the lower Foundation layer, does not have access to the DiscountRate in the Suite layer and must use a delegate to update receipt total to use in the tax calculation. In the SimpleTax class, we create a delegate method, applyDiscountDelegate, with the state information that is needed by the handler in the signature. A delegate method is always empty because its only purpose is to define the contract between the delegate instance and the handler. \n\n[![12](./media/121.png)](./media/121.png) \n\n**Note:** The signature for the delegate declaration, the delegate instance, and the delegate handler must match. We now have to create an instance of the delegate at the point in the code where we would like the delegate handler to be run. The changes in between the &lt;isv&gt; tags represent the added code. \n\n[![13](./media/131.png)](./media/131.png) \n\nWith the delegate in place, we now add a handler method in the Application Suite layer that has access to the discount information. \n\n[![14](./media/14.png)](./media/14.png) \n\nUsing the SubscribesTo keyword, we tie the applyDiscountDelegateHandler method as a handler to the applyDiscountDelegate delegate. **Note:** There can be more than one handler per delegate. There is **not** a defined order in the processing of handler methods. If order is important, delegate handler pairs should be chained together. With the final classes below, when the calculateTotalTax() method is run, the applyDiscountDelegate is fired and handled, updating the receiptTotal to provide an accurate tax calculation.\n\n#### Full Code\n\n##### SimpleTax class in the Application Foundation Layer\n\n[![15](./media/15.png)](./media/15.png)\n\n##### ProductDiscount class in the Application Suite layer\n\n[![16](./media/16.png)](./media/16.png)\n\n## Find delegates and handlers\nThere are three key ways to find delegates and handlers\n\n-   Metadata search\n-   Class references\n-   SubscribesTo references\n\nThe Metadata search tool, described on the [Metadata search in Visual Studio](..\\dev-tools\\metadata-search-visual-studio.md) page, is the best way to find either delegates or their handlers. In Visual Studio, go to **Dynamics 365 **&gt; **Metadata Search** to open the metadata search tool. \n\n[![Del15](./media/del15.png)](./media/del15.png) \n\nIn the search field, type “code:&lt;delegate name&gt;” which will restrict the search to code and find any use of the delegate name, returning both the delegate and handler. Metadata search will search the entire code base and may take some time to complete, but will return any use of the search term in code. \n\n[![Del16](./media/del16.png)](./media/del16.png) \n\nMethods two and three can be used in parallel to the metadata search. The class where a delegate is defined can also serve as a means to narrow down the search for a delegate or handler. The SubscribesTo keyword requires the class name where the delegate was defined. Visual Studio’s find references (right-click the class name &gt; find references) will return a list of files that reference the class. This list will include both the class definition where the delegate is declared and the handler referencing the class. Finding class references is not a perfect method and will require some manual searching through class references. However, it produces a smaller subset of files and can be faster than a metadata search. \n\n[![Del17](./media/del17-1024x300.png)](./media/del17.png) \n\nSimilar to finding class references, finding all references can be done on the SubscribesTo keyword. The resulting list will include all static delegate handlers. Manually going through this list provides another means for finding static delegate handlers. This will not return dynamically declared delegate handlers that do not use the SubscribesTo keyword. \n\n[![Del18](./media/del18-1024x328.png)](./media/del18.png)\n\n\n\n","nodes":[{"pos":[4,763],"embed":true,"restype":"x-metadata","content":"# required metadata\n\ntitle: Use delegates to solve dependencies between models when migrating code\ndescription: This topic explains how delegate methods serve as a means for defining a contract between the delegate instance and the delegate handler.\nauthor: maertenm\nmanager: AnnBe\nms.date: 06/20/2017\nms.topic: article\nms.prod: \nms.service: dynamics-ax-platform\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \nms.reviewer: robinr\nms.search.scope: AX 7.0.0, Operations, UnifiedOperations\n# ms.tgt_pltfrm: \nms.custom: 27001\nms.assetid: 6640ae38-58f0-4a29-abca-5acd9489d45d\nms.search.region: Global\n# ms.search.industry: \nms.author: maertenm\nms.search.validFrom: 2016-02-28\nms.dyn365.ops.version: AX 7.0.0\n","nodes":[{"content":"Use delegates to solve dependencies between models when migrating code","nodes":[{"pos":[0,70],"content":"Use delegates to solve dependencies between models when migrating code","nodes":[{"content":"Use delegates to solve dependencies between models when migrating code","pos":[0,70]}]}],"path":["title"],"extradata":"MT"},{"content":"This topic explains how delegate methods serve as a means for defining a contract between the delegate instance and the delegate handler.","nodes":[{"pos":[0,137],"content":"This topic explains how delegate methods serve as a means for defining a contract between the delegate instance and the delegate handler.","nodes":[{"content":"This topic explains how delegate methods serve as a means for defining a contract between the delegate instance and the delegate handler.","pos":[0,137]}]}],"path":["description"],"extradata":"MT"}],"header":"# required metadata\n","yml":true},{"pos":[771,841],"content":"Use delegates to solve dependencies between models when migrating code","linkify":"Use delegates to solve dependencies between models when migrating code","nodes":[{"content":"Use delegates to solve dependencies between models when migrating code","pos":[0,70]}]},{"content":"This topic explains how delegate methods serve as a means for defining a contract between the delegate instance and the delegate handler.","pos":[887,1024]},{"pos":[1026,1034],"content":"Overview","linkify":"Overview","nodes":[{"content":"Overview","pos":[0,8]}]},{"content":"Microsoft Dynamics 365 for Finance and Operations is split into more several models, with each model in separate package.","pos":[1045,1166]},{"content":"The principal 3 models are Application Platform, Application Foundation, and Application Suite (See <bpt id=\"p1\">[</bpt>Models<ept id=\"p1\">](..\\dev-tools\\models.md)</ept> to learn about models and packages).","pos":[1167,1336],"source":" The principal 3 models are Application Platform, Application Foundation, and Application Suite (See [Models](..\\dev-tools\\models.md) to learn about models and packages)."},{"content":"With the model split, a hierarchy has been created where a higher model can take dependencies and access elements in the models below, but not in models above.","pos":[1337,1496]},{"content":"In this setup, Application Suite has full access to its elements, Application Foundation’s elements, and Application Platform’s elements.","pos":[1497,1634]},{"content":"Application Foundation can access its own elements and those of Application Platform.","pos":[1635,1720]},{"content":"Finally, Application Platform can only access its own elements.","pos":[1721,1784]},{"pos":[1787,1832],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Del1<ept id=\"p1\">](./media/del1.jpg)](./media/del1.jpg)</ept>","source":"[![Del1](./media/del1.jpg)](./media/del1.jpg)"},{"content":"While the model split provides many benefits, it creates a problem when trying to access elements defined in higher models.","pos":[1835,1958]},{"content":"Delegates are the recommended method for accessing elements in higher models from a lower model.","pos":[1959,2055]},{"content":"Delegates are very similar to events in that when a delegate instance is invoked, a handler with compatible signature code is executed.","pos":[2056,2191]},{"content":"This permits higher layer code, the handler, to be called by lower layer code, the delegate instance.","pos":[2192,2293]},{"pos":[2298,2327],"content":"Create delegates and handlers","linkify":"Create delegates and handlers","nodes":[{"content":"Create delegates and handlers","pos":[0,29]}]},{"content":"A delegate declaration must have three things:","pos":[2328,2374]},{"content":"The delegate keyword","pos":[2380,2400]},{"content":"Type void","pos":[2405,2414]},{"content":"Empty method","pos":[2419,2431]},{"content":"Delegate methods serve as a means for defining a contract between the delegate instance and the delegate handler.","pos":[2433,2546]},{"content":"A delegate takes no action itself.","pos":[2547,2581]},{"content":"This is enforced by having a void type and having no code in the method.","pos":[2582,2654]},{"pos":[2657,2695],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>1<ept id=\"p1\">](./media/12.png)](./media/12.png)</ept>","source":"[![1](./media/12.png)](./media/12.png)"},{"content":"Adding the SubscribesTo keyword to a method will create a static delegate handler.","pos":[2698,2780]},{"content":"SubscribesTo requires the class name of the delegate, and the string name of the delegate method.","pos":[2781,2878]},{"pos":[2881,2919],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>2<ept id=\"p1\">](./media/21.png)](./media/21.png)</ept>","source":"[![2](./media/21.png)](./media/21.png)"},{"content":"In order for a delegate to be properly handled, the delegate method declaration, the delegate instance, and the delegate handler must have the <bpt id=\"p1\">*</bpt>same<ept id=\"p1\">*</ept> method signature.","pos":[2922,3089],"source":"In order for a delegate to be properly handled, the delegate method declaration, the delegate instance, and the delegate handler must have the *same* method signature."},{"content":"For example, the delegate instance below takes two inputs, a real number and an EventHandlerResult, matching the delegate declaration and handler signatures above.","pos":[3090,3253]},{"pos":[3256,3294],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>3<ept id=\"p1\">](./media/32.png)](./media/32.png)</ept>","source":"[![3](./media/32.png)](./media/32.png)"},{"content":"Due to the fact that delegates do not have a return value, an EventHandlerResult is passed as a parameter to provide access to the needed result value after the delegate has returned.","pos":[3297,3480]},{"content":"This topic focuses on static delegate handlers using the SubscribesTo.","pos":[3481,3551]},{"content":"The delegate functionality from Dynamics AX 2012 remains.","pos":[3552,3609]},{"content":"<bpt id=\"p1\">[</bpt>How to use X++ Delegates in Dynamics AX 2012<ept id=\"p1\">](http://blogs.msdn.com/b/x/archive/2011/08/02/how-to-use-x-delegates-in-dynamics-ax-2012.aspx)</ept> is a great blog post on MSDN by Microsoft developer Marcos Calderon on delegate concepts in Dynamics AX 2012.","pos":[3610,3860],"source":"[How to use X++ Delegates in Dynamics AX 2012](http://blogs.msdn.com/b/x/archive/2011/08/02/how-to-use-x-delegates-in-dynamics-ax-2012.aspx) is a great blog post on MSDN by Microsoft developer Marcos Calderon on delegate concepts in Dynamics AX 2012."},{"content":"These concepts still apply.","pos":[3861,3888]},{"pos":[3893,3910],"content":"Example scenarios","linkify":"Example scenarios","nodes":[{"content":"Example scenarios","pos":[0,17]}]},{"pos":[3915,3946],"content":"Overlaying an existing delegate","linkify":"Overlaying an existing delegate","nodes":[{"content":"Overlaying an existing delegate","pos":[0,31]}]},{"content":"In many cases where delegates are needed, the code that was formerly overlayed has already been moved to a delegate handler by Microsoft.","pos":[3948,4085]},{"content":"In these instances, Microsoft created delegates that can be leveraged and the code can be overlayed in a similar manner in the delegate handler.","pos":[4086,4230]},{"content":"In this scenario, an Independent Software Vendor (ISV) is migrating code from Dynamics  AX 2012 R3 where they have overlayed the showSalesTax() method in the LogisticsEntityPostalAddressFormHandler class.","pos":[4231,4435]},{"content":"After migration, the CodeUpgrade project will contain the LogisticsEntityPostalAddressFormHandler with the <bpt id=\"p1\">*</bpt>Your Solution<ept id=\"p1\">*</ept>, <bpt id=\"p2\">*</bpt>Microsoft AX 2012,<ept id=\"p2\">*</ept> and <bpt id=\"p3\">*</bpt>Microsoft AX<ept id=\"p3\">*</ept> sections to resolve for the showSalesTax() method.","pos":[4436,4650],"source":" After migration, the CodeUpgrade project will contain the LogisticsEntityPostalAddressFormHandler with the *Your Solution*, *Microsoft AX 2012,* and *Microsoft AX* sections to resolve for the showSalesTax() method."},{"content":"The commented Your Solution section shows that the showSalesTax() method was overlayed by adding an additional table to approve showing sales tax from.","pos":[4651,4802]},{"content":"This overlay is shown between the <ph id=\"ph1\">&amp;lt;</ph>isv<ph id=\"ph2\">&amp;gt;</ph> tags circled in red below.","pos":[4803,4875],"source":" This overlay is shown between the &lt;isv&gt; tags circled in red below."},{"pos":[4878,4916],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>4<ept id=\"p1\">](./media/41.png)](./media/41.png)</ept>","source":"[![4](./media/41.png)](./media/41.png)"},{"content":"When comparing this overlay with the code from Dynamics AX 2012, this is a simple change.","pos":[4918,5007]},{"content":"The overlay has added an additional table to the switch statement.","pos":[5008,5074]},{"pos":[5077,5115],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>5<ept id=\"p1\">](./media/51.png)](./media/51.png)</ept>","source":"[![5](./media/51.png)](./media/51.png)"},{"content":"However, the Finance and Operations section does not appear to resemble either of the Dynamics AX 2012 code snippets.","pos":[5118,5235]},{"pos":[5238,5276],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>6<ept id=\"p1\">](./media/61.png)](./media/61.png)</ept>","source":"[![6](./media/61.png)](./media/61.png)"},{"content":"Upon deeper inspection, the code is calling a delegate method, showSalesTax<ph id=\"ph1\">\\_</ph>delegate().","pos":[5279,5367],"source":"Upon deeper inspection, the code is calling a delegate method, showSalesTax\\_delegate()."},{"pos":[5370,5513],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>this.showSalesTax<ph id=\"ph2\">\\_</ph>delegate(this.getCallerRecord().TableId, result);<ept id=\"p1\">](./media/showsalestax_delegate.png)](./media/showsalestax_delegate.png)</ept>","source":"[![this.showSalesTax\\_delegate(this.getCallerRecord().TableId, result);](./media/showsalestax_delegate.png)](./media/showsalestax_delegate.png)"},{"content":"The use of a delegate implies that code has been moved to another location.","pos":[5516,5591]},{"content":"The showSalesTax<ph id=\"ph1\">\\_</ph>delegate() has been declared in the Application Foundation and handled in the Application Suite.","pos":[5592,5706],"source":" The showSalesTax\\_delegate() has been declared in the Application Foundation and handled in the Application Suite."},{"content":"To view the code that has been moved, find the delegate handler.","pos":[5707,5771]},{"content":"The <bpt id=\"p1\">**</bpt>Finding Delegates and Handlers<ept id=\"p1\">**</ept> section contains methods to locate delegates and handlers.","pos":[5772,5869],"source":" The **Finding Delegates and Handlers** section contains methods to locate delegates and handlers."},{"content":"After finding the delegate handler method in the Application Suite, we see the code that has been moved from the showSalesTax() method.","pos":[5870,6005]},{"content":"The same overlayered changes applied in Dynamics AX 2012 can be applied in the delegate handler.","pos":[6006,6102]},{"pos":[6105,6232],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Finding delegates and handlers code sample<ept id=\"p1\">](./media/findingdelegatesandhandles.png)](./media/findingdelegatesandhandles.png)</ept>","source":"[![Finding delegates and handlers code sample](./media/findingdelegatesandhandles.png)](./media/findingdelegatesandhandles.png)"},{"content":"After adding the new table to the switch statement in the delegate handler, the code will function as it did in Dynamics AX 2012.","pos":[6235,6364]},{"pos":[6367,6460],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>ShowSalesTax method code<ept id=\"p1\">](./media/showsalestaxmethod.png)](./media/showsalestaxmethod.png)</ept>","source":"[![ShowSalesTax method code](./media/showsalestaxmethod.png)](./media/showsalestaxmethod.png)"},{"pos":[6466,6487],"content":"Adding a new delegate","linkify":"Adding a new delegate","nodes":[{"content":"Adding a new delegate","pos":[0,21]}]},{"content":"In this scenario, we will modify an existing tax calculation method that resides in the Application Foundation to account for discounts created in the Application Suite.","pos":[6489,6658]},{"content":"The following class in the Foundation layer calculates the tax based on the gross total.","pos":[6659,6747]},{"pos":[6750,6791],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>10<ept id=\"p1\">](./media/101.png)](./media/101.png)</ept>","source":"[![10](./media/101.png)](./media/101.png)"},{"content":"In the Application Suite, we have introduced the notion of discounts by adding a ProductDiscount class that contains the current discount.","pos":[6794,6932]},{"pos":[6935,6976],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>11<ept id=\"p1\">](./media/112.png)](./media/112.png)</ept>","source":"[![11](./media/112.png)](./media/112.png)"},{"content":"The TaxCalculator class, in the lower Foundation layer, does not have access to the DiscountRate in the Suite layer and must use a delegate to update receipt total to use in the tax calculation.","pos":[6979,7173]},{"content":"In the SimpleTax class, we create a delegate method, applyDiscountDelegate, with the state information that is needed by the handler in the signature.","pos":[7174,7324]},{"content":"A delegate method is always empty because its only purpose is to define the contract between the delegate instance and the handler.","pos":[7325,7456]},{"pos":[7459,7500],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>12<ept id=\"p1\">](./media/121.png)](./media/121.png)</ept>","source":"[![12](./media/121.png)](./media/121.png)"},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> The signature for the delegate declaration, the delegate instance, and the delegate handler must match.","pos":[7503,7616],"source":"**Note:** The signature for the delegate declaration, the delegate instance, and the delegate handler must match."},{"content":"We now have to create an instance of the delegate at the point in the code where we would like the delegate handler to be run.","pos":[7617,7743]},{"content":"The changes in between the <ph id=\"ph1\">&amp;lt;</ph>isv<ph id=\"ph2\">&amp;gt;</ph> tags represent the added code.","pos":[7744,7813],"source":" The changes in between the &lt;isv&gt; tags represent the added code."},{"pos":[7816,7857],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>13<ept id=\"p1\">](./media/131.png)](./media/131.png)</ept>","source":"[![13](./media/131.png)](./media/131.png)"},{"content":"With the delegate in place, we now add a handler method in the Application Suite layer that has access to the discount information.","pos":[7860,7991]},{"pos":[7994,8033],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>14<ept id=\"p1\">](./media/14.png)](./media/14.png)</ept>","source":"[![14](./media/14.png)](./media/14.png)"},{"content":"Using the SubscribesTo keyword, we tie the applyDiscountDelegateHandler method as a handler to the applyDiscountDelegate delegate.","pos":[8036,8166]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> There can be more than one handler per delegate.","pos":[8167,8225],"source":"**Note:** There can be more than one handler per delegate."},{"content":"There is <bpt id=\"p1\">**</bpt>not<ept id=\"p1\">**</ept> a defined order in the processing of handler methods.","pos":[8226,8296],"source":" There is **not** a defined order in the processing of handler methods."},{"content":"If order is important, delegate handler pairs should be chained together.","pos":[8297,8370]},{"content":"With the final classes below, when the calculateTotalTax() method is run, the applyDiscountDelegate is fired and handled, updating the receiptTotal to provide an accurate tax calculation.","pos":[8371,8558]},{"pos":[8565,8574],"content":"Full Code","linkify":"Full Code","nodes":[{"content":"Full Code","pos":[0,9]}]},{"pos":[8582,8633],"content":"SimpleTax class in the Application Foundation Layer","linkify":"SimpleTax class in the Application Foundation Layer","nodes":[{"content":"SimpleTax class in the Application Foundation Layer","pos":[0,51]}]},{"pos":[8635,8674],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>15<ept id=\"p1\">](./media/15.png)](./media/15.png)</ept>","source":"[![15](./media/15.png)](./media/15.png)"},{"pos":[8682,8734],"content":"ProductDiscount class in the Application Suite layer","linkify":"ProductDiscount class in the Application Suite layer","nodes":[{"content":"ProductDiscount class in the Application Suite layer","pos":[0,52]}]},{"pos":[8736,8775],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>16<ept id=\"p1\">](./media/16.png)](./media/16.png)</ept>","source":"[![16](./media/16.png)](./media/16.png)"},{"pos":[8780,8807],"content":"Find delegates and handlers","linkify":"Find delegates and handlers","nodes":[{"content":"Find delegates and handlers","pos":[0,27]}]},{"content":"There are three key ways to find delegates and handlers","pos":[8808,8863]},{"content":"Metadata search","pos":[8869,8884]},{"content":"Class references","pos":[8889,8905]},{"content":"SubscribesTo references","pos":[8910,8933]},{"content":"The Metadata search tool, described on the <bpt id=\"p1\">[</bpt>Metadata search in Visual Studio<ept id=\"p1\">](..\\dev-tools\\metadata-search-visual-studio.md)</ept> page, is the best way to find either delegates or their handlers.","pos":[8935,9125],"source":"The Metadata search tool, described on the [Metadata search in Visual Studio](..\\dev-tools\\metadata-search-visual-studio.md) page, is the best way to find either delegates or their handlers."},{"content":"In Visual Studio, go to **Dynamics 365 **<ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p1\">**</bpt>Metadata Search<ept id=\"p1\">**</ept> to open the metadata search tool.","pos":[9126,9225],"source":" In Visual Studio, go to **Dynamics 365 **&gt; **Metadata Search** to open the metadata search tool."},{"pos":[9228,9276],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Del15<ept id=\"p1\">](./media/del15.png)](./media/del15.png)</ept>","source":"[![Del15](./media/del15.png)](./media/del15.png)"},{"content":"In the search field, type “code:<ph id=\"ph1\">&amp;lt;</ph>delegate name<ph id=\"ph2\">&amp;gt;</ph>” which will restrict the search to code and find any use of the delegate name, returning both the delegate and handler.","pos":[9279,9452],"source":"In the search field, type “code:&lt;delegate name&gt;” which will restrict the search to code and find any use of the delegate name, returning both the delegate and handler."},{"content":"Metadata search will search the entire code base and may take some time to complete, but will return any use of the search term in code.","pos":[9453,9589]},{"pos":[9592,9640],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Del16<ept id=\"p1\">](./media/del16.png)](./media/del16.png)</ept>","source":"[![Del16](./media/del16.png)](./media/del16.png)"},{"content":"Methods two and three can be used in parallel to the metadata search.","pos":[9643,9712]},{"content":"The class where a delegate is defined can also serve as a means to narrow down the search for a delegate or handler.","pos":[9713,9829]},{"content":"The SubscribesTo keyword requires the class name where the delegate was defined.","pos":[9830,9910]},{"content":"Visual Studio’s find references (right-click the class name <ph id=\"ph1\">&amp;gt;</ph> find references) will return a list of files that reference the class.","pos":[9911,10046],"source":" Visual Studio’s find references (right-click the class name &gt; find references) will return a list of files that reference the class."},{"content":"This list will include both the class definition where the delegate is declared and the handler referencing the class.","pos":[10047,10165]},{"content":"Finding class references is not a perfect method and will require some manual searching through class references.","pos":[10166,10279]},{"content":"However, it produces a smaller subset of files and can be faster than a metadata search.","pos":[10280,10368]},{"pos":[10371,10428],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Del17<ept id=\"p1\">](./media/del17-1024x300.png)](./media/del17.png)</ept>","source":"[![Del17](./media/del17-1024x300.png)](./media/del17.png)"},{"content":"Similar to finding class references, finding all references can be done on the SubscribesTo keyword.","pos":[10431,10531]},{"content":"The resulting list will include all static delegate handlers.","pos":[10532,10593]},{"content":"Manually going through this list provides another means for finding static delegate handlers.","pos":[10594,10687]},{"content":"This will not return dynamically declared delegate handlers that do not use the SubscribesTo keyword.","pos":[10688,10789]},{"pos":[10792,10849],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Del18<ept id=\"p1\">](./media/del18-1024x328.png)](./media/del18.png)</ept>","source":"[![Del18](./media/del18-1024x328.png)](./media/del18.png)"}]}