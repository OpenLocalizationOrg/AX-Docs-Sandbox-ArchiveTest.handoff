{"content":"---\n# required metadata\n\ntitle: Code migration - Context menus\ndescription: A new programming model is required for context menus (shortcut menus). This article outlines the process for migrating context menu code from Microsoft Dynamics AX 2012 to Microsoft Dynamics 365 for Finance and Operations. It also includes UX guidelines for context menus.\nauthor: jasongre\nmanager: AnnBe\nms.date: 06/20/2017\nms.topic: article\nms.prod: \nms.service: dynamics-ax-platform\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \nms.reviewer: robinr\nms.search.scope: AX 7.0.0, Operations, UnifiedOperations\n# ms.tgt_pltfrm: \nms.custom: 16301\nms.assetid: 8f3b62f2-4de6-4ea3-b3e6-1101d0fe308e\nms.search.region: Global\n# ms.search.industry: \nms.author: jasongre\nms.search.validFrom: 2016-02-28\nms.dyn365.ops.version: AX 7.0.0\n\n---\n\n# Code migration - Context menus\n\n[!include[banner](../includes/banner.md)]\n\n\nA new programming model is required for context menus (shortcut menus). This article outlines the process for migrating context menu code from Microsoft Dynamics AX 2012 to Microsoft Dynamics 365 for Finance and Operations. It also includes UX guidelines for context menus.\n\nIn Microsoft Dynamics AX 2012 and earlier versions, developers modified right-click context menus (shortcut menus) by using the **PopupMenu** class. This class relied on Microsoft Windows application programming interfaces (APIs) that aren't available on the web. In Finance and Operations, the **ContextMenu** APIs have been created as replacements to provide similar functionality. Previously, the **context()** and **showContextMenu()** method overrides were the entry points for modifying context menus for specific controls. These overrides typically contained code to add options to the context menu, and also to process the user’s selection. The code for processing the user's selection used a wait model. In Finance and Operations, these overrides are being removed, and the wait model is being eliminated. Instead, developers must create two overrides: **getContextMenuOptions()** to add options to the context menu and **selectedMenuOption()** to process the user’s selection.\n\n## Migrate context menu code in Finance and Operations\nMigration from the **PopupMenu** APIs to the **ContextMenu** APIs can be broken down into three main steps.\n\n### Step 1. Add a constant for each menu option that must be added\n\nThe old **insertItem()** method in the **PopupMenu** class returned an identifier for the menu option that was being added. This identifier was saved into a variable for future reference. Because developers will define the menu identifier for themselves in Finance and Operations, it's a good idea to define constants for each option to help with code readability.\n\n-   At the form level, add a constant for each menu option that is being added to the context menu. The value must be unique within each context menu. Note that you must modify the old variable name if it conflicts with another variable on the form or control.\n\n#### Before\n\n    public void context()\n    {\n        ...\n        int listCreateRoot = listMenu.insertItem(\"@SYS5480\");\n        ...\n\n#### After\n\n    [Form]\n    public class MainAccount extends FormRun\n    {\n        ...\n        public const int listCreateRoot = 1;\n        ...\n\n### Step 2. Build the context menu\n\nConstruct the list of submenus and menu options, and add it to the control’s context menu.\n\n1.  Add the **getContextMenuOptions()** method override on the control.\n2.  Create a new context menu and a list to hold the options that you will add to the menu:\n    -   ContextMenu menu = new ContextMenu();\n    -   List menuOptions = new List(Types::Class);\n\n3.  Add menu options to the list:\n    -   ContextMenuOption option = ContextMenuOption::Create(label,identifier);\n    -   menuOptions.addEnd(option);\n\n4.  Add the list of options to the menu.\n    -   menu.ContextMenuOptions(menuOptions);\n\n5.  Modify the **return** statement.\n    -   return menu.Serialize();\n\n### Step 3. Process the user selection from the context menu\n\n1.  Add the **selectedMenuOption()** method override on the control.\n2.  Move the **switch()** statement for processing options into this override.\n\n## Code example\nThis section illustrates the migration of a context menu from Dynamics AX 2012 to Finance and Operations. The **MainAccount** form is used as an example.\n\n### Original code\n\n    public void context()\n    {       \n        PopupMenu  listMenu        = new PopupMenu(element.hWnd());\n        int        listCreateRoot  = listMenu.insertItem(\"@SYS5480\");\n        int        selectedMenu;\n        selectedMenu = listMenu.draw();\n        switch (selectedMenu)\n        {\n            case -1:\n                break;\n            case listCreateRoot:\n                mainAccount_ds.create();\n                break;\n            default:\n                break;\n        }\n    }\n\n### Migrated code\n\n    // Define new form-level constant for each context menu option\n    public const int listCreateRoot = 1;\n    // Define new override on the control for building the context menu\n    public str getContextMenuOptions()\n    {\n        str ret;\n        ContextMenu menu = new ContextMenu(); \n        ContextMenuOption option = ContextMenuOption::Create(\"@SYS5480\", listCreateRoot);\n        List menuOptions = new List(Types::Class); \n        // Add label and ID of menu option\n        menuOptions.addEnd(option); \n        menu.ContextMenuOptions(menuOptions);\n        return menu.Serialize();\n    }\n    // Define new override on the control for processing the user selection\n    public void selectedMenuOption(int selectedOption)\n    {\n        switch (selectedOption)\n        {\n            case -1:\n                break;\n            case listCreateRoot:\n                mainAccount_ds.create();\n                break;\n            default:\n                break;\n        }\n    }\n\n## UX guidelines for context menus\nAs you migrate context menus, consider the following guidelines:\n\n-   The most important commands should be at the top of the menu.\n-   Remove commands that don't apply to the current state of the element that is the target of the right-click.\n-   Right-click is a shortcut. Therefore, the commands on the context menu should **always** be available in other places on the page.\n-   Don't create submenus of context menus. Submenus are hard to use and aren't touch-friendly.\n-   Limit the number of menu items to five.\n\n\n\n\n","nodes":[{"pos":[4,859],"embed":true,"restype":"x-metadata","content":"# required metadata\n\ntitle: Code migration - Context menus\ndescription: A new programming model is required for context menus (shortcut menus). This article outlines the process for migrating context menu code from Microsoft Dynamics AX 2012 to Microsoft Dynamics 365 for Finance and Operations. It also includes UX guidelines for context menus.\nauthor: jasongre\nmanager: AnnBe\nms.date: 06/20/2017\nms.topic: article\nms.prod: \nms.service: dynamics-ax-platform\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \nms.reviewer: robinr\nms.search.scope: AX 7.0.0, Operations, UnifiedOperations\n# ms.tgt_pltfrm: \nms.custom: 16301\nms.assetid: 8f3b62f2-4de6-4ea3-b3e6-1101d0fe308e\nms.search.region: Global\n# ms.search.industry: \nms.author: jasongre\nms.search.validFrom: 2016-02-28\nms.dyn365.ops.version: AX 7.0.0\n","nodes":[{"content":"Code migration - Context menus","nodes":[{"pos":[0,30],"content":"Code migration - Context menus","nodes":[{"content":"Code migration - Context menus","pos":[0,30]}]}],"path":["title"],"extradata":"MT"},{"content":"A new programming model is required for context menus (shortcut menus). This article outlines the process for migrating context menu code from Microsoft Dynamics AX 2012 to Microsoft Dynamics 365 for Finance and Operations. It also includes UX guidelines for context menus.","nodes":[{"pos":[0,273],"content":"A new programming model is required for context menus (shortcut menus). This article outlines the process for migrating context menu code from Microsoft Dynamics AX 2012 to Microsoft Dynamics 365 for Finance and Operations. It also includes UX guidelines for context menus.","nodes":[{"content":"A new programming model is required for context menus (shortcut menus). This article outlines the process for migrating context menu code from Microsoft Dynamics AX 2012 to Microsoft Dynamics 365 for Finance and Operations. It also includes UX guidelines for context menus.","pos":[0,273],"nodes":[{"content":"A new programming model is required for context menus (shortcut menus).","pos":[0,71]},{"content":"This article outlines the process for migrating context menu code from Microsoft Dynamics AX 2012 to Microsoft Dynamics 365 for Finance and Operations.","pos":[72,223]},{"content":"It also includes UX guidelines for context menus.","pos":[224,273]}]}]}],"path":["description"],"extradata":"MT"}],"header":"# required metadata\n","yml":true},{"pos":[867,897],"content":"Code migration - Context menus","linkify":"Code migration - Context menus","nodes":[{"content":"Code migration - Context menus","pos":[0,30]}]},{"content":"A new programming model is required for context menus (shortcut menus).","pos":[943,1014]},{"content":"This article outlines the process for migrating context menu code from Microsoft Dynamics AX 2012 to Microsoft Dynamics 365 for Finance and Operations.","pos":[1015,1166]},{"content":"It also includes UX guidelines for context menus.","pos":[1167,1216]},{"content":"In Microsoft Dynamics AX 2012 and earlier versions, developers modified right-click context menus (shortcut menus) by using the <bpt id=\"p1\">**</bpt>PopupMenu<ept id=\"p1\">**</ept> class.","pos":[1218,1366],"source":"In Microsoft Dynamics AX 2012 and earlier versions, developers modified right-click context menus (shortcut menus) by using the **PopupMenu** class."},{"content":"This class relied on Microsoft Windows application programming interfaces (APIs) that aren't available on the web.","pos":[1367,1481]},{"content":"In Finance and Operations, the <bpt id=\"p1\">**</bpt>ContextMenu<ept id=\"p1\">**</ept> APIs have been created as replacements to provide similar functionality.","pos":[1482,1601],"source":" In Finance and Operations, the **ContextMenu** APIs have been created as replacements to provide similar functionality."},{"content":"Previously, the <bpt id=\"p1\">**</bpt>context()<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>showContextMenu()<ept id=\"p2\">**</ept> method overrides were the entry points for modifying context menus for specific controls.","pos":[1602,1747],"source":" Previously, the **context()** and **showContextMenu()** method overrides were the entry points for modifying context menus for specific controls."},{"content":"These overrides typically contained code to add options to the context menu, and also to process the user’s selection.","pos":[1748,1866]},{"content":"The code for processing the user's selection used a wait model.","pos":[1867,1930]},{"content":"In Finance and Operations, these overrides are being removed, and the wait model is being eliminated.","pos":[1931,2032]},{"content":"Instead, developers must create two overrides: <bpt id=\"p1\">**</bpt>getContextMenuOptions()<ept id=\"p1\">**</ept> to add options to the context menu and <bpt id=\"p2\">**</bpt>selectedMenuOption()<ept id=\"p2\">**</ept> to process the user’s selection.","pos":[2033,2204],"source":" Instead, developers must create two overrides: **getContextMenuOptions()** to add options to the context menu and **selectedMenuOption()** to process the user’s selection."},{"pos":[2209,2260],"content":"Migrate context menu code in Finance and Operations","linkify":"Migrate context menu code in Finance and Operations","nodes":[{"content":"Migrate context menu code in Finance and Operations","pos":[0,51]}]},{"pos":[2261,2368],"content":"Migration from the <bpt id=\"p1\">**</bpt>PopupMenu<ept id=\"p1\">**</ept> APIs to the <bpt id=\"p2\">**</bpt>ContextMenu<ept id=\"p2\">**</ept> APIs can be broken down into three main steps.","source":"Migration from the **PopupMenu** APIs to the **ContextMenu** APIs can be broken down into three main steps."},{"pos":[2374,2436],"content":"Step 1. Add a constant for each menu option that must be added","linkify":"Step 1. Add a constant for each menu option that must be added","nodes":[{"content":"Step 1. Add a constant for each menu option that must be added","pos":[0,62],"nodes":[{"content":"Step 1.","pos":[0,7]},{"content":"Add a constant for each menu option that must be added","pos":[8,62]}]}]},{"content":"The old <bpt id=\"p1\">**</bpt>insertItem()<ept id=\"p1\">**</ept> method in the <bpt id=\"p2\">**</bpt>PopupMenu<ept id=\"p2\">**</ept> class returned an identifier for the menu option that was being added.","pos":[2438,2561],"source":"The old **insertItem()** method in the **PopupMenu** class returned an identifier for the menu option that was being added."},{"content":"This identifier was saved into a variable for future reference.","pos":[2562,2625]},{"content":"Because developers will define the menu identifier for themselves in Finance and Operations, it's a good idea to define constants for each option to help with code readability.","pos":[2626,2802]},{"content":"At the form level, add a constant for each menu option that is being added to the context menu.","pos":[2808,2903]},{"content":"The value must be unique within each context menu.","pos":[2904,2954]},{"content":"Note that you must modify the old variable name if it conflicts with another variable on the form or control.","pos":[2955,3064]},{"pos":[3071,3077],"content":"Before","linkify":"Before","nodes":[{"content":"Before","pos":[0,6]}]},{"pos":[3203,3208],"content":"After","linkify":"After","nodes":[{"content":"After","pos":[0,5]}]},{"pos":[3346,3376],"content":"Step 2. Build the context menu","linkify":"Step 2. Build the context menu","nodes":[{"content":"Step 2. Build the context menu","pos":[0,30],"nodes":[{"content":"Step 2.","pos":[0,7]},{"content":"Build the context menu","pos":[8,30]}]}]},{"content":"Construct the list of submenus and menu options, and add it to the control’s context menu.","pos":[3378,3468]},{"pos":[3474,3541],"content":"Add the <bpt id=\"p1\">**</bpt>getContextMenuOptions()<ept id=\"p1\">**</ept> method override on the control.","source":"Add the **getContextMenuOptions()** method override on the control."},{"content":"Create a new context menu and a list to hold the options that you will add to the menu:","pos":[3546,3633]},{"content":"ContextMenu menu = new ContextMenu();","pos":[3642,3679]},{"content":"List menuOptions = new List(Types::Class);","pos":[3688,3730]},{"content":"Add menu options to the list:","pos":[3736,3765]},{"content":"ContextMenuOption option = ContextMenuOption::Create(label,identifier);","pos":[3774,3845]},{"content":"menuOptions.addEnd(option);","pos":[3854,3881]},{"content":"Add the list of options to the menu.","pos":[3887,3923]},{"content":"menu.ContextMenuOptions(menuOptions);","pos":[3932,3969]},{"pos":[3975,4007],"content":"Modify the <bpt id=\"p1\">**</bpt>return<ept id=\"p1\">**</ept> statement.","source":"Modify the **return** statement."},{"content":"return menu.Serialize();","pos":[4016,4040]},{"pos":[4046,4102],"content":"Step 3. Process the user selection from the context menu","linkify":"Step 3. Process the user selection from the context menu","nodes":[{"content":"Step 3. Process the user selection from the context menu","pos":[0,56],"nodes":[{"content":"Step 3.","pos":[0,7]},{"content":"Process the user selection from the context menu","pos":[8,56]}]}]},{"pos":[4108,4172],"content":"Add the <bpt id=\"p1\">**</bpt>selectedMenuOption()<ept id=\"p1\">**</ept> method override on the control.","source":"Add the **selectedMenuOption()** method override on the control."},{"pos":[4177,4251],"content":"Move the <bpt id=\"p1\">**</bpt>switch()<ept id=\"p1\">**</ept> statement for processing options into this override.","source":"Move the **switch()** statement for processing options into this override."},{"pos":[4256,4268],"content":"Code example","linkify":"Code example","nodes":[{"content":"Code example","pos":[0,12]}]},{"content":"This section illustrates the migration of a context menu from Dynamics AX 2012 to Finance and Operations.","pos":[4269,4374]},{"content":"The <bpt id=\"p1\">**</bpt>MainAccount<ept id=\"p1\">**</ept> form is used as an example.","pos":[4375,4422],"source":" The **MainAccount** form is used as an example."},{"pos":[4428,4441],"content":"Original code","linkify":"Original code","nodes":[{"content":"Original code","pos":[0,13]}]},{"pos":[4939,4952],"content":"Migrated code","linkify":"Migrated code","nodes":[{"content":"Migrated code","pos":[0,13]}]},{"pos":[5934,5965],"content":"UX guidelines for context menus","linkify":"UX guidelines for context menus","nodes":[{"content":"UX guidelines for context menus","pos":[0,31]}]},{"content":"As you migrate context menus, consider the following guidelines:","pos":[5966,6030]},{"content":"The most important commands should be at the top of the menu.","pos":[6036,6097]},{"content":"Remove commands that don't apply to the current state of the element that is the target of the right-click.","pos":[6102,6209]},{"content":"Right-click is a shortcut.","pos":[6214,6240]},{"content":"Therefore, the commands on the context menu should <bpt id=\"p1\">**</bpt>always<ept id=\"p1\">**</ept> be available in other places on the page.","pos":[6241,6344],"source":" Therefore, the commands on the context menu should **always** be available in other places on the page."},{"content":"Don't create submenus of context menus.","pos":[6349,6388]},{"content":"Submenus are hard to use and aren't touch-friendly.","pos":[6389,6440]},{"content":"Limit the number of menu items to five.","pos":[6445,6484]}]}