{"content":"---\n# required metadata\n\ntitle: Call CRT service in offline mode\ndescription: This topic describes how provide offline support for point of sale (POS).\nauthor: josaw1\nmanager: AnnBe\nms.date: 06/20/2017\nms.topic: article\nms.prod: \nms.service: dynamics-365-retail\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \nms.reviewer: robinr\nms.search.scope: AX 7.0.0, Operations, Retail, UnifiedOperations\n# ms.tgt_pltfrm: \nms.custom: 69834\nms.assetid: 4f4dbdd3-e48c-417c-b8bb-f7fd6628bd9b\nms.search.region: Global\n# ms.search.industry: \nms.author: mumani\nms.search.validFrom: 2016-02-28\nms.dyn365.ops.version: AX 7.0.0, Retail July 2017 update\n\n---\n\n# Call CRT service in offline mode\n\n[!include[banner](../includes/banner.md)]\n\n\nThis topic describes how provide offline support for point of sale (POS).\n\nWhen a point of sale (POS) device goes offline (in other words, when it isn't connected to Retail Server), the POS automatically switches to the local commerce runtime (CRT). The POS client communicates with the local CRT by using the Retail proxy. To enable the proxy to understand your custom service, you must extend the Retail proxy project to support your request type.\n\n1.  In Microsoft Visual Studio, from the Retail SDK\\\\Proxies folder, open Proxies.RetailProxy.csproj.\n2.  Update RetailSDK\\\\Proxies\\\\RetailProxy\\\\Adapters\\\\UsingStatements.Extensions with the new namespace that you defined for the new entity/complex types that were introduced in CRT extension projects. These projects or dynamics-link libraries (DLLs) must first be referenced by Proxies.RetailProxy.csproj.\n3.  Compile the Proxies.RetailProxy project. During compilation, Adapters\\\\Interfaces.g.cs is updated with your new entity and interface information. Don't modify this automatically generated class.\n4.  Add your new manager class to the Adapters folder, and call your CRT service from that manager. The standard entity manager classes, such as **SalesOrderManager** and **PurchaseOrderManager**, are available in the Adapters folder. **Note:** All the libraries that are used in the project must be portable and signed. (Any custom CRT service that is referenced must be a portable library.)\n5.  Update the public key in the CRT configuration file, because a new public key is generated after compilation.\n6.  Build and replace the new proxy DLL in the Microsoft Dynamics AX\\\\70\\\\Retail Modern POS\\\\ClientBroker folder. Additionally, drop the custom CRT extension library into the Microsoft Dynamics AX\\\\70\\\\Retail Modern POS\\\\ClientBroker folder. (All libraries that are referenced should be dropped into this folder.)\n7.  In the DllHost.exe.config file, update **RetailProxyAssemblyName** and **AdaptorCallerFullTypeName** with the new proxy DLL and adapter name.\n\n        <add key=\"RetailProxyAssemblyName\" value=\"Contoso.Commerce.RetailProxy\" />\n        <add key=\"AdaptorCallerFullTypeName\" value=\"Contoso.Commerce.RetailProxy.Adapters.AdaptorCaller\" />\n\n8.  In the CommerceRuntime.MPOSOffline.config file, in the **&lt;composition&gt;** element, update the new CRT DLL information as for the commerceRuntime.config file.\n\n        <add source=\"assembly\" value=\"Contoso.Commerce.Runtime.Services\" />\n\n9.  Restart dllhost.exe. (You should restart the dllhost.exe for MPOS to read the new config file, this will be required even when you do any upgrade if it has config file changes.)\n\n\n\n\n","nodes":[{"pos":[4,689],"embed":true,"restype":"x-metadata","content":"# required metadata\n\ntitle: Call CRT service in offline mode\ndescription: This topic describes how provide offline support for point of sale (POS).\nauthor: josaw1\nmanager: AnnBe\nms.date: 06/20/2017\nms.topic: article\nms.prod: \nms.service: dynamics-365-retail\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \nms.reviewer: robinr\nms.search.scope: AX 7.0.0, Operations, Retail, UnifiedOperations\n# ms.tgt_pltfrm: \nms.custom: 69834\nms.assetid: 4f4dbdd3-e48c-417c-b8bb-f7fd6628bd9b\nms.search.region: Global\n# ms.search.industry: \nms.author: mumani\nms.search.validFrom: 2016-02-28\nms.dyn365.ops.version: AX 7.0.0, Retail July 2017 update\n","nodes":[{"content":"Call CRT service in offline mode","nodes":[{"pos":[0,32],"content":"Call CRT service in offline mode","nodes":[{"content":"Call CRT service in offline mode","pos":[0,32]}]}],"path":["title"],"extradata":"MT"},{"content":"This topic describes how provide offline support for point of sale (POS).","nodes":[{"pos":[0,73],"content":"This topic describes how provide offline support for point of sale (POS).","nodes":[{"content":"This topic describes how provide offline support for point of sale (POS).","pos":[0,73]}]}],"path":["description"],"extradata":"MT"}],"header":"# required metadata\n","yml":true},{"pos":[697,729],"content":"Call CRT service in offline mode","linkify":"Call CRT service in offline mode","nodes":[{"content":"Call CRT service in offline mode","pos":[0,32]}]},{"content":"This topic describes how provide offline support for point of sale (POS).","pos":[775,848]},{"content":"When a point of sale (POS) device goes offline (in other words, when it isn't connected to Retail Server), the POS automatically switches to the local commerce runtime (CRT).","pos":[850,1024]},{"content":"The POS client communicates with the local CRT by using the Retail proxy.","pos":[1025,1098]},{"content":"To enable the proxy to understand your custom service, you must extend the Retail proxy project to support your request type.","pos":[1099,1224]},{"content":"In Microsoft Visual Studio, from the Retail SDK<ph id=\"ph1\">\\\\</ph>Proxies folder, open Proxies.RetailProxy.csproj.","pos":[1230,1327],"source":"In Microsoft Visual Studio, from the Retail SDK\\\\Proxies folder, open Proxies.RetailProxy.csproj."},{"content":"Update RetailSDK<ph id=\"ph1\">\\\\</ph>Proxies<ph id=\"ph2\">\\\\</ph>RetailProxy<ph id=\"ph3\">\\\\</ph>Adapters<ph id=\"ph4\">\\\\</ph>UsingStatements.Extensions with the new namespace that you defined for the new entity/complex types that were introduced in CRT extension projects.","pos":[1332,1529],"source":"Update RetailSDK\\\\Proxies\\\\RetailProxy\\\\Adapters\\\\UsingStatements.Extensions with the new namespace that you defined for the new entity/complex types that were introduced in CRT extension projects."},{"content":"These projects or dynamics-link libraries (DLLs) must first be referenced by Proxies.RetailProxy.csproj.","pos":[1530,1634]},{"content":"Compile the Proxies.RetailProxy project.","pos":[1639,1679]},{"content":"During compilation, Adapters<ph id=\"ph1\">\\\\</ph>Interfaces.g.cs is updated with your new entity and interface information.","pos":[1680,1784],"source":" During compilation, Adapters\\\\Interfaces.g.cs is updated with your new entity and interface information."},{"content":"Don't modify this automatically generated class.","pos":[1785,1833]},{"content":"Add your new manager class to the Adapters folder, and call your CRT service from that manager.","pos":[1838,1933]},{"content":"The standard entity manager classes, such as <bpt id=\"p1\">**</bpt>SalesOrderManager<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>PurchaseOrderManager<ept id=\"p2\">**</ept>, are available in the Adapters folder.","pos":[1934,2068],"source":" The standard entity manager classes, such as **SalesOrderManager** and **PurchaseOrderManager**, are available in the Adapters folder."},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> All the libraries that are used in the project must be portable and signed.","pos":[2069,2154],"source":"**Note:** All the libraries that are used in the project must be portable and signed."},{"content":"(Any custom CRT service that is referenced must be a portable library.)","pos":[2155,2226]},{"content":"Update the public key in the CRT configuration file, because a new public key is generated after compilation.","pos":[2231,2340]},{"content":"Build and replace the new proxy DLL in the Microsoft Dynamics AX<ph id=\"ph1\">\\\\</ph>70<ph id=\"ph2\">\\\\</ph>Retail Modern POS<ph id=\"ph3\">\\\\</ph>ClientBroker folder.","pos":[2345,2454],"source":"Build and replace the new proxy DLL in the Microsoft Dynamics AX\\\\70\\\\Retail Modern POS\\\\ClientBroker folder."},{"content":"Additionally, drop the custom CRT extension library into the Microsoft Dynamics AX<ph id=\"ph1\">\\\\</ph>70<ph id=\"ph2\">\\\\</ph>Retail Modern POS<ph id=\"ph3\">\\\\</ph>ClientBroker folder.","pos":[2455,2582],"source":" Additionally, drop the custom CRT extension library into the Microsoft Dynamics AX\\\\70\\\\Retail Modern POS\\\\ClientBroker folder."},{"content":"(All libraries that are referenced should be dropped into this folder.)","pos":[2583,2654]},{"pos":[2659,2800],"content":"In the DllHost.exe.config file, update <bpt id=\"p1\">**</bpt>RetailProxyAssemblyName<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>AdaptorCallerFullTypeName<ept id=\"p2\">**</ept> with the new proxy DLL and adapter name.","source":"In the DllHost.exe.config file, update **RetailProxyAssemblyName** and **AdaptorCallerFullTypeName** with the new proxy DLL and adapter name."},{"pos":[2998,3160],"content":"In the CommerceRuntime.MPOSOffline.config file, in the <bpt id=\"p1\">**</bpt><ph id=\"ph1\">&amp;lt;</ph>composition<ph id=\"ph2\">&amp;gt;</ph><ept id=\"p1\">**</ept> element, update the new CRT DLL information as for the commerceRuntime.config file.","source":"In the CommerceRuntime.MPOSOffline.config file, in the **&lt;composition&gt;** element, update the new CRT DLL information as for the commerceRuntime.config file."},{"content":"Restart dllhost.exe.","pos":[3243,3263]},{"content":"(You should restart the dllhost.exe for MPOS to read the new config file, this will be required even when you do any upgrade if it has config file changes.)","pos":[3264,3420]}]}