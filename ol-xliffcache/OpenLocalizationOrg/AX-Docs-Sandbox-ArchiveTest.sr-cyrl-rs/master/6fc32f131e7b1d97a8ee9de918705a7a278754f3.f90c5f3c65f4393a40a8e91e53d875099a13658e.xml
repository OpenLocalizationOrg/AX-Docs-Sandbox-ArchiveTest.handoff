{"content":"---\n# required metadata\n\ntitle: Extend the RunBase class\ndescription: This topic contains an example that shows how a RunBase class can be augmented end to end.\nauthor: MichaelFruergaardPontoppidan\nmanager: AnnBe\nms.date: 06/20/2017\nms.topic: article\nms.prod: \nms.service: dynamics-ax-platform\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \nms.reviewer: robinr\nms.search.scope: Operations, Platform, UnifiedOperations, AX Platform\n# ms.tgt_pltfrm: \nms.custom: 89563\nms.assetid: 8DA4DA85-0C2D-4CAF-B350-DAC9C1BE4DF9\nms.search.region: Global\n# ms.search.industry: \nms.author: mfp\nms.search.validFrom: 2016-05-31\nms.dyn365.ops.version: Platform update 1\n\n---\n\n# Extend the RunBase class\n\n[!include[banner](../includes/banner.md)]\n\n\nWhen you extend functionality of the application suite, you will encounter classes that extend the **RunBase** class. This topic shows how a **RunBase** class can be augmented end to end.\n\nFor example, you want to extend the SysUserLogCleanup class. Out of the box, this class can delete records from the SysUserLog table. However, you want to archive these records to a different table before they are deleted.\n\nThe SysUserLogCleanup class is a **RunBase** class. The **RunBase** class has a dialog box, where the user is prompted for parameters before the class is run. For this example, we will add a toggle button control to the dialog box, get the value of the control, act on the value in the run method, and make sure that the value is serialized via the pack and unpack methods. Serialization helps guarantee that the user’s last selection is presented again if the dialog box is reopened. It also helps guarantee that the settings are applied if the class is run in the background.\n\nTo avoid collisions with other eventual extensions, we followed these best practices:\n\n- **Prefix members and methods**. In the example, the prefix “my” is used. This practice is important, because it helps prevent name clashes with other extensions and future versions of the augmented class.\n\n- **Use RunBase.packExtension() and RunBase.unpackExtension()**. These methods provide serialization in a nonintrusive manner. They enable serialization of multiple extensions of the same class. The methods are available starting in Platform Update 5.\n\nThe following example shows how to implement this scenario.\n\n```\n[ExtensionOf(classStr(SysUserLogCleanup))]\nfinal class MySysUserLogCleanup_Extension\n{\n    // static members\n    static private SysUserLogCleanup myRunningInstance;\n\n    // Extending class state...\n    private boolean myArchive;\n    private DialogField myDialogArchive;\n    #define.CurrentVersion(1)\n    #localmacro.CurrentList\n        myArchive\n    #endmacro\n\n    // Adding new instance methods\n    private void myDialog(Dialog _dialog)\n    {\n        myDialogArchive = _dialog.addField(extendedtypestr(NoYesId), \"Archive\");\n        myDialogArchive.value(myArchive);\n    }\n    private void myGetFromDialog()\n    {\n        myArchive = myDialogArchive.value();\n    }\n    private boolean myUnpack(container packedClass)\n    {\n        Integer version = RunBase::getVersion(packedClass);\n        switch (version)\n        {\n            case #CurrentVersion:\n                [version, #currentList] = packedClass;\n                break;\n            default:\n                return false;\n        }\n        return true;\n    }\n    private container myPack()\n    {\n        return [#CurrentVersion, #CurrentList];\n    }\n    private void myInitParmDefault()\n    {\n        myArchive = true;\n    }\n    private void myArchiveUserLog(SysUserLog _userLog)\n    {\n        if (myArchive)\n        {\n            //...\n        }\n    }\n\n    // Wiring up event handlers...\n    [PostHandlerFor(classStr(SysUserLogCleanup), methodStr(SysUserLogCleanup, dialog))]\n    public static void SysUserLogCleanup_Post_Dialog(XppPrePostArgs _args)\n    {\n        Dialog dialog = _args.getReturnValue();\n        SysUserLogCleanup instance = _args.getThis() as SysUserLogCleanup;\n        instance.myDialog(dialog);\n    }\n    [PostHandlerFor(classStr(SysUserLogCleanup), methodStr(SysUserLogCleanup, getFromDialog))]\n    public static void SysUserLogCleanup_Post_GetFromDialog(XppPrePostArgs _args)\n    {\n        SysUserLogCleanup instance = _args.getThis() as SysUserLogCleanup;\n        instance.myGetFromDialog();\n    }\n    [PostHandlerFor(classStr(SysUserLogCleanup), methodStr(SysUserLogCleanup, pack))]\n    public static void SysUserLogCleanup_Post_pack(XppPrePostArgs _args)\n    {\n        SysUserLogCleanup instance = _args.getThis() as SysUserLogCleanup;\n        //Also pack the extension\n        instance.packExtension(_args, classStr(MySysUserLogCleanup_Extension), instance.myPack());\n    }\n    [PostHandlerFor(classStr(SysUserLogCleanup), methodStr(SysUserLogCleanup, unpack))]\n    public static void SysUserLogCleanup_Post_unpack(XppPrePostArgs _args)\n    {\n        SysUserLogCleanup instance = _args.getThis() as SysUserLogCleanup;\n        container myState = instance.unpackExtension(_args, classStr(MySysUserLogCleanup_Extension));\n        //Also unpack the extension\n        if (!instance.myUnpack(myState))\n        {\n            //Extension couldn't be unpacked - return false to trigger initParmDefault() gets called\n            _args.setReturnValue(false);\n        }\n    }\n    [PostHandlerFor(classStr(SysUserLogCleanup), methodStr(SysUserLogCleanup, initParmDefault))]\n    public static void SysUserLogCleanup_Post_initParmDefault(XppPrePostArgs _args)\n    {\n        SysUserLogCleanup instance = _args.getThis() as SysUserLogCleanup;\n        instance.myInitParmDefault();\n    }\n    [PreHandlerFor(classStr(SysUserLogCleanup), methodStr(SysUserLogCleanup, run))]\n    public static void SysUserLogCleanup_Pre_run(XppPrePostArgs _args)\n    {\n        //Store a static reference, so we can call it from SysUserLog_onDeleting.\n        myRunningInstance = _args.getThis() as SysUserLogCleanup;\n    }\n    [PostHandlerFor(classStr(SysUserLogCleanup), methodStr(SysUserLogCleanup, run))]\n    public static void SysUserLogCleanup_Post_run(XppPrePostArgs _args)\n    {\n        //Running complete \n        myRunningInstance = null;\n    }\n\n    // Wiring up event handler for deletion of the record\n    [DataEventHandler(tableStr(SysUserLog), DataEventType::Deleting)]\n    static public void SysUserLog_onDeleting(Common _sender, DataEventArgs _e)\n    {\n        if (runningInstance)\n        {\n            myRunningInstance.myArchiveUserLog(_sender as SysUserLog);\n        }\n    }\n}\n```\n\n\n","nodes":[{"pos":[4,707],"embed":true,"restype":"x-metadata","content":"# required metadata\n\ntitle: Extend the RunBase class\ndescription: This topic contains an example that shows how a RunBase class can be augmented end to end.\nauthor: MichaelFruergaardPontoppidan\nmanager: AnnBe\nms.date: 06/20/2017\nms.topic: article\nms.prod: \nms.service: dynamics-ax-platform\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \nms.reviewer: robinr\nms.search.scope: Operations, Platform, UnifiedOperations, AX Platform\n# ms.tgt_pltfrm: \nms.custom: 89563\nms.assetid: 8DA4DA85-0C2D-4CAF-B350-DAC9C1BE4DF9\nms.search.region: Global\n# ms.search.industry: \nms.author: mfp\nms.search.validFrom: 2016-05-31\nms.dyn365.ops.version: Platform update 1\n","nodes":[{"content":"Extend the RunBase class","nodes":[{"pos":[0,24],"content":"Extend the RunBase class","nodes":[{"content":"Extend the RunBase class","pos":[0,24]}]}],"path":["title"],"extradata":"MT"},{"content":"This topic contains an example that shows how a RunBase class can be augmented end to end.","nodes":[{"pos":[0,90],"content":"This topic contains an example that shows how a RunBase class can be augmented end to end.","nodes":[{"content":"This topic contains an example that shows how a RunBase class can be augmented end to end.","pos":[0,90]}]}],"path":["description"],"extradata":"MT"}],"header":"# required metadata\n","yml":true},{"pos":[715,739],"content":"Extend the RunBase class","linkify":"Extend the RunBase class","nodes":[{"content":"Extend the RunBase class","pos":[0,24]}]},{"content":"When you extend functionality of the application suite, you will encounter classes that extend the <bpt id=\"p1\">**</bpt>RunBase<ept id=\"p1\">**</ept> class.","pos":[785,902],"source":"When you extend functionality of the application suite, you will encounter classes that extend the **RunBase** class."},{"content":"This topic shows how a <bpt id=\"p1\">**</bpt>RunBase<ept id=\"p1\">**</ept> class can be augmented end to end.","pos":[903,972],"source":" This topic shows how a **RunBase** class can be augmented end to end."},{"content":"For example, you want to extend the SysUserLogCleanup class.","pos":[974,1034]},{"content":"Out of the box, this class can delete records from the SysUserLog table.","pos":[1035,1107]},{"content":"However, you want to archive these records to a different table before they are deleted.","pos":[1108,1196]},{"content":"The SysUserLogCleanup class is a <bpt id=\"p1\">**</bpt>RunBase<ept id=\"p1\">**</ept> class.","pos":[1198,1249],"source":"The SysUserLogCleanup class is a **RunBase** class."},{"content":"The <bpt id=\"p1\">**</bpt>RunBase<ept id=\"p1\">**</ept> class has a dialog box, where the user is prompted for parameters before the class is run.","pos":[1250,1356],"source":" The **RunBase** class has a dialog box, where the user is prompted for parameters before the class is run."},{"content":"For this example, we will add a toggle button control to the dialog box, get the value of the control, act on the value in the run method, and make sure that the value is serialized via the pack and unpack methods.","pos":[1357,1571]},{"content":"Serialization helps guarantee that the user’s last selection is presented again if the dialog box is reopened.","pos":[1572,1682]},{"content":"It also helps guarantee that the settings are applied if the class is run in the background.","pos":[1683,1775]},{"content":"To avoid collisions with other eventual extensions, we followed these best practices:","pos":[1777,1862]},{"content":"<bpt id=\"p1\">**</bpt>Prefix members and methods<ept id=\"p1\">**</ept>.","pos":[1866,1897],"source":"**Prefix members and methods**."},{"content":"In the example, the prefix “my” is used.","pos":[1898,1938]},{"content":"This practice is important, because it helps prevent name clashes with other extensions and future versions of the augmented class.","pos":[1939,2070]},{"content":"<bpt id=\"p1\">**</bpt>Use RunBase.packExtension() and RunBase.unpackExtension()<ept id=\"p1\">**</ept>.","pos":[2074,2136],"source":"**Use RunBase.packExtension() and RunBase.unpackExtension()**."},{"content":"These methods provide serialization in a nonintrusive manner.","pos":[2137,2198]},{"content":"They enable serialization of multiple extensions of the same class.","pos":[2199,2266]},{"content":"The methods are available starting in Platform Update 5.","pos":[2267,2323]},{"content":"The following example shows how to implement this scenario.","pos":[2325,2384]}]}