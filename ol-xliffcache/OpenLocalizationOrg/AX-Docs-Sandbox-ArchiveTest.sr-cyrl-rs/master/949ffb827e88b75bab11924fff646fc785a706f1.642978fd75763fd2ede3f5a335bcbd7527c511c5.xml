{"content":"---\n# required metadata\n\ntitle: Add customer preference data to a channel database\ndescription: This tutorial shows how to add the RetailCustPreferences table to the commerce runtime (CRT) for the retail channel, and how to create a subjob to move the data in the new table to the channel database.\nauthor: kfend\nmanager: AnnBe\nms.date: 06/20/2017\nms.topic: article\nms.prod: \nms.service: dynamics-365-retail\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \nms.reviewer: robinr\nms.search.scope: AX 7.0.0, Operations, Retail, UnifiedOperations\n# ms.tgt_pltfrm: \nms.custom: 18081\nms.assetid: 3c13fe1d-2078-4539-b865-e266b6f56e60\nms.search.region: Global\nms.search.industry: Retail\nms.author: meeram\nms.search.validFrom: 2016-02-28\nms.dyn365.ops.version: AX 7.0.0, Retail July 2017 update\n\n---\n\n# Add customer preference data to a channel database\n\n[!include[banner](../includes/banner.md)]\n\n\nThis tutorial shows how to add the RetailCustPreferences table to the commerce runtime (CRT) for the retail channel, and how to create a subjob to move the data in the new table to the channel database.\n\nAdd the RetailCustPreferences table in the data distribution to the CRT for the retail channel\n----------------------------------------------------------------------------------------------\n\nThe channel schema is the XML description of the data that is sent to the channel database.\n\n1.  Click **Retail** &gt; **Headquarters setup** &gt; **Retail scheduler** &gt; **Retail channel schema**.\n2.  Select the schema name that corresponds to the channel. Then click **Channel tables**.\n3.  Click **New**, and then, in the **Table name** field, enter **ax.RetailCustPreference** as the name of the new table.\n4.  On the **Channel table fields** tab, click **New**, and then enter the field names **ACCOUNTNUM**, **EMAILOPTIN**, and **RECID**.\n5.  Close the **Channel tables** page.\n\n## Create a subjob\nNext, you create a subjob of the CustTable job to move data in the new table to the channel database.\n\n1.  In Retail Headquarters, click **Retail** &gt; **Headquarters setup** &gt; **Retail scheduler** &gt; **Scheduler subjobs**, and then click **New**.\n2.  In the **Subjob number** and **Description** fields, enter **RetailCustPreference**.\n3.  In the **Retail channel schema** field, select **Dynamics 365 for Retail.**\n4.  In the **Channel table name** field, select **ax.RetailCustPreference**.\n5.  In the **table name** field, select **RetailCustPreference**.\n6.  On the **Channel field mapping** tab, click **Match fields**. The **From** field and **To** field columns are filled in. **Alternative approach, instead of using the UI in the steps above this can also accomplished in code:**\n    1.  Start Microsoft Visual Studio, and then, in the Application Object Tree (AOT) find the **RetailCDXSeedData\\_AX7** class.\n    2.  Add the following method.\n\n            private void C_RetailCustPreference()\n            {\n                jobIDContainer = ['1010'];\n                subjobID = 'RetailCustPreference';\n                axTableName = tableStr(RetailCustPreference);\n                axFieldNames = [\n                fieldStr(RetailCustPreference, AccountNum),\n                fieldStr(RetailCustPreference, EmailOptIn),\n                fieldStr(RetailCustPreference, RecId)\n                ];\n            }\n\n    3.  Compile the class.\n    4.  Reset Internet Information Services (IIS).\n    5.  Switch to the client.\n    6.  Click **Retail** &gt; **Headquarters setup** &gt; **Retail scheduler** &gt; **Initialize retail scheduler**. The required scheduler subjob definition is generated, and the subjob is added to the scheduler job.\n\n7.  Click **Retail** &gt; **Headquarters setup** &gt; **Retail scheduler** &gt; **Retail channel schema**.\n8.  On the **Retail channel schema** page, in the left navigation pane, click **Dynamics 365 for Retail.**\n9.  On the **Retail data distribution** tab, click **Export**.\n10. Follow one of these steps, depending on the browser that you're using:\n    -   If you're using Google Chrome, you should be prompted to download an XML file. Save the file to a path.\n    -   If you're using Internet Explorer, a webpage will open. Right-click in the page, and then click **View source**. Then save the contents of the page source to a file path.\n\n11. In a text editor such as Notepad++, open the XML file that you just saved, and follow these steps.\n    1.  Search for the following line: **&lt;Table name=“RetailCustTable”&gt;**. There are two instances, at approximately line 29 and line 744.\n    2.  Add the following code after the last line in both **&lt;Table name=“RetailCustTable”&gt;** code blocks. You add the code after the **&lt;/Table&gt;** tag.\n\n            <Table name=\"RetailCustPreference\">\n                <LinkGroup>\n                    <Link type=\"FieldMatch\" fieldName=\"accountNum\" parentFieldName=\"AccountNum\" />\n                </LinkGroup>\n            </Table>\n\n12. After you've finished editing the file, go back to client and the **Retail channel schema** page. In the left navigation pane, click **Dynamics 365 for Retail.**\n13. On the **Retail data distribution** tab, click **Import**.\n14. In the dialog box that opens, click **Browse**, select the XML file that you just edited, and then click **OK** to import the file.\n15. Close the **Retail channel schema** page.\n16. Click **Retail** &gt; **Headquarters setup** &gt; **Retail scheduler** &gt; **Scheduler job**.\n17. On the **Scheduler job** page, click **1010** to select the “Customers” job.\n18. On the **Subjobs** tab, click **New**, and then enter **RetailCustPreference** as the subjob number. Click **Save**.\n19. On the **Retail channel schema** page, select **Dynamics 365 for Retail **as the schema name, and then click **Generate queries**.\n\n\n\n\n","nodes":[{"pos":[4,839],"embed":true,"restype":"x-metadata","content":"# required metadata\n\ntitle: Add customer preference data to a channel database\ndescription: This tutorial shows how to add the RetailCustPreferences table to the commerce runtime (CRT) for the retail channel, and how to create a subjob to move the data in the new table to the channel database.\nauthor: kfend\nmanager: AnnBe\nms.date: 06/20/2017\nms.topic: article\nms.prod: \nms.service: dynamics-365-retail\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \nms.reviewer: robinr\nms.search.scope: AX 7.0.0, Operations, Retail, UnifiedOperations\n# ms.tgt_pltfrm: \nms.custom: 18081\nms.assetid: 3c13fe1d-2078-4539-b865-e266b6f56e60\nms.search.region: Global\nms.search.industry: Retail\nms.author: meeram\nms.search.validFrom: 2016-02-28\nms.dyn365.ops.version: AX 7.0.0, Retail July 2017 update\n","nodes":[{"content":"Add customer preference data to a channel database","nodes":[{"pos":[0,50],"content":"Add customer preference data to a channel database","nodes":[{"content":"Add customer preference data to a channel database","pos":[0,50]}]}],"path":["title"],"extradata":"MT"},{"content":"This tutorial shows how to add the RetailCustPreferences table to the commerce runtime (CRT) for the retail channel, and how to create a subjob to move the data in the new table to the channel database.","nodes":[{"pos":[0,202],"content":"This tutorial shows how to add the RetailCustPreferences table to the commerce runtime (CRT) for the retail channel, and how to create a subjob to move the data in the new table to the channel database.","nodes":[{"content":"This tutorial shows how to add the RetailCustPreferences table to the commerce runtime (CRT) for the retail channel, and how to create a subjob to move the data in the new table to the channel database.","pos":[0,202]}]}],"path":["description"],"extradata":"MT"}],"header":"# required metadata\n","yml":true},{"pos":[847,897],"content":"Add customer preference data to a channel database","linkify":"Add customer preference data to a channel database","nodes":[{"content":"Add customer preference data to a channel database","pos":[0,50]}]},{"content":"This tutorial shows how to add the RetailCustPreferences table to the commerce runtime (CRT) for the retail channel, and how to create a subjob to move the data in the new table to the channel database.","pos":[943,1145]},{"pos":[1147,1241],"content":"Add the RetailCustPreferences table in the data distribution to the CRT for the retail channel","linkify":"Add the RetailCustPreferences table in the data distribution to the CRT for the retail channel","nodes":[{"content":"Add the RetailCustPreferences table in the data distribution to the CRT for the retail channel","pos":[0,94]}]},{"content":"The channel schema is the XML description of the data that is sent to the channel database.","pos":[1338,1429]},{"pos":[1435,1537],"content":"Click <bpt id=\"p1\">**</bpt>Retail<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Headquarters setup<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Retail scheduler<ept id=\"p3\">**</ept> <ph id=\"ph3\">&amp;gt;</ph> <bpt id=\"p4\">**</bpt>Retail channel schema<ept id=\"p4\">**</ept>.","source":"Click **Retail** &gt; **Headquarters setup** &gt; **Retail scheduler** &gt; **Retail channel schema**."},{"content":"Select the schema name that corresponds to the channel.","pos":[1542,1597]},{"content":"Then click <bpt id=\"p1\">**</bpt>Channel tables<ept id=\"p1\">**</ept>.","pos":[1598,1628],"source":" Then click **Channel tables**."},{"pos":[1633,1750],"content":"Click <bpt id=\"p1\">**</bpt>New<ept id=\"p1\">**</ept>, and then, in the <bpt id=\"p2\">**</bpt>Table name<ept id=\"p2\">**</ept> field, enter <bpt id=\"p3\">**</bpt>ax.RetailCustPreference<ept id=\"p3\">**</ept> as the name of the new table.","source":"Click **New**, and then, in the **Table name** field, enter **ax.RetailCustPreference** as the name of the new table."},{"pos":[1755,1884],"content":"On the <bpt id=\"p1\">**</bpt>Channel table fields<ept id=\"p1\">**</ept> tab, click <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept>, and then enter the field names <bpt id=\"p3\">**</bpt>ACCOUNTNUM<ept id=\"p3\">**</ept>, <bpt id=\"p4\">**</bpt>EMAILOPTIN<ept id=\"p4\">**</ept>, and <bpt id=\"p5\">**</bpt>RECID<ept id=\"p5\">**</ept>.","source":"On the **Channel table fields** tab, click **New**, and then enter the field names **ACCOUNTNUM**, **EMAILOPTIN**, and **RECID**."},{"pos":[1889,1923],"content":"Close the <bpt id=\"p1\">**</bpt>Channel tables<ept id=\"p1\">**</ept> page.","source":"Close the **Channel tables** page."},{"pos":[1928,1943],"content":"Create a subjob","linkify":"Create a subjob","nodes":[{"content":"Create a subjob","pos":[0,15]}]},{"content":"Next, you create a subjob of the CustTable job to move data in the new table to the channel database.","pos":[1944,2045]},{"pos":[2051,2197],"content":"In Retail Headquarters, click <bpt id=\"p1\">**</bpt>Retail<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Headquarters setup<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Retail scheduler<ept id=\"p3\">**</ept> <ph id=\"ph3\">&amp;gt;</ph> <bpt id=\"p4\">**</bpt>Scheduler subjobs<ept id=\"p4\">**</ept>, and then click <bpt id=\"p5\">**</bpt>New<ept id=\"p5\">**</ept>.","source":"In Retail Headquarters, click **Retail** &gt; **Headquarters setup** &gt; **Retail scheduler** &gt; **Scheduler subjobs**, and then click **New**."},{"pos":[2202,2286],"content":"In the <bpt id=\"p1\">**</bpt>Subjob number<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Description<ept id=\"p2\">**</ept> fields, enter <bpt id=\"p3\">**</bpt>RetailCustPreference<ept id=\"p3\">**</ept>.","source":"In the **Subjob number** and **Description** fields, enter **RetailCustPreference**."},{"pos":[2291,2366],"content":"In the <bpt id=\"p1\">**</bpt>Retail channel schema<ept id=\"p1\">**</ept> field, select <bpt id=\"p2\">**</bpt>Dynamics 365 for Retail.<ept id=\"p2\">**</ept>","source":"In the **Retail channel schema** field, select **Dynamics 365 for Retail.**"},{"pos":[2371,2443],"content":"In the <bpt id=\"p1\">**</bpt>Channel table name<ept id=\"p1\">**</ept> field, select <bpt id=\"p2\">**</bpt>ax.RetailCustPreference<ept id=\"p2\">**</ept>.","source":"In the **Channel table name** field, select **ax.RetailCustPreference**."},{"pos":[2448,2509],"content":"In the <bpt id=\"p1\">**</bpt>table name<ept id=\"p1\">**</ept> field, select <bpt id=\"p2\">**</bpt>RetailCustPreference<ept id=\"p2\">**</ept>.","source":"In the **table name** field, select **RetailCustPreference**."},{"content":"On the <bpt id=\"p1\">**</bpt>Channel field mapping<ept id=\"p1\">**</ept> tab, click <bpt id=\"p2\">**</bpt>Match fields<ept id=\"p2\">**</ept>.","pos":[2514,2575],"source":"On the **Channel field mapping** tab, click **Match fields**."},{"content":"The <bpt id=\"p1\">**</bpt>From<ept id=\"p1\">**</ept> field and <bpt id=\"p2\">**</bpt>To<ept id=\"p2\">**</ept> field columns are filled in.","pos":[2576,2634],"source":" The **From** field and **To** field columns are filled in."},{"content":"<bpt id=\"p1\">**</bpt>Alternative approach, instead of using the UI in the steps above this can also accomplished in code:<ept id=\"p1\">**</ept>","pos":[2635,2739],"source":"**Alternative approach, instead of using the UI in the steps above this can also accomplished in code:**"},{"pos":[2748,2868],"content":"Start Microsoft Visual Studio, and then, in the Application Object Tree (AOT) find the <bpt id=\"p1\">**</bpt>RetailCDXSeedData<ph id=\"ph1\">\\_</ph>AX7<ept id=\"p1\">**</ept> class.","source":"Start Microsoft Visual Studio, and then, in the Application Object Tree (AOT) find the **RetailCDXSeedData\\_AX7** class."},{"content":"Add the following method.","pos":[2877,2902]},{"content":"Compile the class.","pos":[3373,3391]},{"content":"Reset Internet Information Services (IIS).","pos":[3400,3442]},{"content":"Switch to the client.","pos":[3451,3472]},{"content":"Click <bpt id=\"p1\">**</bpt>Retail<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Headquarters setup<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Retail scheduler<ept id=\"p3\">**</ept> <ph id=\"ph3\">&amp;gt;</ph> <bpt id=\"p4\">**</bpt>Initialize retail scheduler<ept id=\"p4\">**</ept>.","pos":[3481,3589],"source":"Click **Retail** &gt; **Headquarters setup** &gt; **Retail scheduler** &gt; **Initialize retail scheduler**."},{"content":"The required scheduler subjob definition is generated, and the subjob is added to the scheduler job.","pos":[3590,3690]},{"pos":[3696,3798],"content":"Click <bpt id=\"p1\">**</bpt>Retail<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Headquarters setup<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Retail scheduler<ept id=\"p3\">**</ept> <ph id=\"ph3\">&amp;gt;</ph> <bpt id=\"p4\">**</bpt>Retail channel schema<ept id=\"p4\">**</ept>.","source":"Click **Retail** &gt; **Headquarters setup** &gt; **Retail scheduler** &gt; **Retail channel schema**."},{"pos":[3803,3905],"content":"On the <bpt id=\"p1\">**</bpt>Retail channel schema<ept id=\"p1\">**</ept> page, in the left navigation pane, click <bpt id=\"p2\">**</bpt>Dynamics 365 for Retail.<ept id=\"p2\">**</ept>","source":"On the **Retail channel schema** page, in the left navigation pane, click **Dynamics 365 for Retail.**"},{"pos":[3910,3968],"content":"On the <bpt id=\"p1\">**</bpt>Retail data distribution<ept id=\"p1\">**</ept> tab, click <bpt id=\"p2\">**</bpt>Export<ept id=\"p2\">**</ept>.","source":"On the **Retail data distribution** tab, click **Export**."},{"content":"Follow one of these steps, depending on the browser that you're using:","pos":[3973,4043]},{"content":"If you're using Google Chrome, you should be prompted to download an XML file.","pos":[4052,4130]},{"content":"Save the file to a path.","pos":[4131,4155]},{"content":"If you're using Internet Explorer, a webpage will open.","pos":[4164,4219]},{"content":"Right-click in the page, and then click <bpt id=\"p1\">**</bpt>View source<ept id=\"p1\">**</ept>.","pos":[4220,4276],"source":" Right-click in the page, and then click **View source**."},{"content":"Then save the contents of the page source to a file path.","pos":[4277,4334]},{"content":"In a text editor such as Notepad++, open the XML file that you just saved, and follow these steps.","pos":[4340,4438]},{"content":"Search for the following line: <bpt id=\"p1\">**</bpt><ph id=\"ph1\">&amp;lt;</ph>Table name=“RetailCustTable”<ph id=\"ph2\">&amp;gt;</ph><ept id=\"p1\">**</ept>.","pos":[4447,4519],"source":"Search for the following line: **&lt;Table name=“RetailCustTable”&gt;**."},{"content":"There are two instances, at approximately line 29 and line 744.","pos":[4520,4583]},{"content":"Add the following code after the last line in both <bpt id=\"p1\">**</bpt><ph id=\"ph1\">&amp;lt;</ph>Table name=“RetailCustTable”<ph id=\"ph2\">&amp;gt;</ph><ept id=\"p1\">**</ept> code blocks.","pos":[4592,4696],"source":"Add the following code after the last line in both **&lt;Table name=“RetailCustTable”&gt;** code blocks."},{"content":"You add the code after the <bpt id=\"p1\">**</bpt><ph id=\"ph1\">&amp;lt;</ph>/Table<ph id=\"ph2\">&amp;gt;</ph><ept id=\"p1\">**</ept> tag.","pos":[4697,4747],"source":" You add the code after the **&lt;/Table&gt;** tag."},{"content":"After you've finished editing the file, go back to client and the <bpt id=\"p1\">**</bpt>Retail channel schema<ept id=\"p1\">**</ept> page.","pos":[4979,5076],"source":"After you've finished editing the file, go back to client and the **Retail channel schema** page."},{"content":"In the left navigation pane, click <bpt id=\"p1\">**</bpt>Dynamics 365 for Retail.<ept id=\"p1\">**</ept>","pos":[5077,5140],"source":" In the left navigation pane, click **Dynamics 365 for Retail.**"},{"pos":[5145,5203],"content":"On the <bpt id=\"p1\">**</bpt>Retail data distribution<ept id=\"p1\">**</ept> tab, click <bpt id=\"p2\">**</bpt>Import<ept id=\"p2\">**</ept>.","source":"On the **Retail data distribution** tab, click **Import**."},{"pos":[5208,5339],"content":"In the dialog box that opens, click <bpt id=\"p1\">**</bpt>Browse<ept id=\"p1\">**</ept>, select the XML file that you just edited, and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept> to import the file.","source":"In the dialog box that opens, click **Browse**, select the XML file that you just edited, and then click **OK** to import the file."},{"pos":[5344,5385],"content":"Close the <bpt id=\"p1\">**</bpt>Retail channel schema<ept id=\"p1\">**</ept> page.","source":"Close the **Retail channel schema** page."},{"pos":[5390,5484],"content":"Click <bpt id=\"p1\">**</bpt>Retail<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Headquarters setup<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Retail scheduler<ept id=\"p3\">**</ept> <ph id=\"ph3\">&amp;gt;</ph> <bpt id=\"p4\">**</bpt>Scheduler job<ept id=\"p4\">**</ept>.","source":"Click **Retail** &gt; **Headquarters setup** &gt; **Retail scheduler** &gt; **Scheduler job**."},{"pos":[5489,5565],"content":"On the <bpt id=\"p1\">**</bpt>Scheduler job<ept id=\"p1\">**</ept> page, click <bpt id=\"p2\">**</bpt>1010<ept id=\"p2\">**</ept> to select the “Customers” job.","source":"On the **Scheduler job** page, click **1010** to select the “Customers” job."},{"content":"On the <bpt id=\"p1\">**</bpt>Subjobs<ept id=\"p1\">**</ept> tab, click <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept>, and then enter <bpt id=\"p3\">**</bpt>RetailCustPreference<ept id=\"p3\">**</ept> as the subjob number.","pos":[5570,5670],"source":"On the **Subjobs** tab, click **New**, and then enter **RetailCustPreference** as the subjob number."},{"content":"Click <bpt id=\"p1\">**</bpt>Save<ept id=\"p1\">**</ept>.","pos":[5671,5686],"source":" Click **Save**."},{"pos":[5691,5821],"content":"On the <bpt id=\"p1\">**</bpt>Retail channel schema<ept id=\"p1\">**</ept> page, select **Dynamics 365 for Retail **as the schema name, and then click <bpt id=\"p2\">**</bpt>Generate queries<ept id=\"p2\">**</ept>.","source":"On the **Retail channel schema** page, select **Dynamics 365 for Retail **as the schema name, and then click **Generate queries**."}]}